import{r as c,a as Rs,R as $s}from"./vendor-869113fd.js";import{c as Us}from"./supabase-37aa0cd6.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(a){if(a.ep)return;a.ep=!0;const i=t(a);fetch(a.href,i)}})();var ps={exports:{}},vt={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Hs=c,Bs=Symbol.for("react.element"),Vs=Symbol.for("react.fragment"),Ks=Object.prototype.hasOwnProperty,Ws=Hs.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Js={key:!0,ref:!0,__self:!0,__source:!0};function fs(n,r,t){var s,a={},i=null,o=null;t!==void 0&&(i=""+t),r.key!==void 0&&(i=""+r.key),r.ref!==void 0&&(o=r.ref);for(s in r)Ks.call(r,s)&&!Js.hasOwnProperty(s)&&(a[s]=r[s]);if(n&&n.defaultProps)for(s in r=n.defaultProps,r)a[s]===void 0&&(a[s]=r[s]);return{$$typeof:Bs,type:n,key:i,ref:o,props:a,_owner:Ws.current}}vt.Fragment=Vs;vt.jsx=fs;vt.jsxs=fs;ps.exports=vt;var e=ps.exports,_t={},Lt=Rs;_t.createRoot=Lt.createRoot,_t.hydrateRoot=Lt.hydrateRoot;const Gs="https://esmkltjylinzamjaoulf.supabase.co",Ys="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVzbWtsdGp5bGluemFtamFvdWxmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkyMTMzOTAsImV4cCI6MjA3NDc4OTM5MH0.ao7bW1UDfKZed29oD1nuGKcZm30-NF8cP81-kt6xw0E",N=Us(Gs,Ys,{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0}}),Zs=(n,r,t,s)=>{var i,o,l,d;const a=[t,{code:r,...s||{}}];if((o=(i=n==null?void 0:n.services)==null?void 0:i.logger)!=null&&o.forward)return n.services.logger.forward(a,"warn","react-i18next::",!0);Ue(a[0])&&(a[0]=`react-i18next:: ${a[0]}`),(d=(l=n==null?void 0:n.services)==null?void 0:l.logger)!=null&&d.warn?n.services.logger.warn(...a):console!=null&&console.warn&&console.warn(...a)},It={},kt=(n,r,t,s)=>{Ue(t)&&It[t]||(Ue(t)&&(It[t]=new Date),Zs(n,r,t,s))},bs=(n,r)=>()=>{if(n.isInitialized)r();else{const t=()=>{setTimeout(()=>{n.off("initialized",t)},0),r()};n.on("initialized",t)}},qt=(n,r,t)=>{n.loadNamespaces(r,bs(n,t))},Mt=(n,r,t,s)=>{if(Ue(t)&&(t=[t]),n.options.preload&&n.options.preload.indexOf(r)>-1)return qt(n,t,s);t.forEach(a=>{n.options.ns.indexOf(a)<0&&n.options.ns.push(a)}),n.loadLanguages(r,bs(n,s))},Xs=(n,r,t={})=>!r.languages||!r.languages.length?(kt(r,"NO_LANGUAGES","i18n.languages were undefined or empty",{languages:r.languages}),!0):r.hasLoadedNamespace(n,{lng:t.lng,precheck:(s,a)=>{if(t.bindI18n&&t.bindI18n.indexOf("languageChanging")>-1&&s.services.backendConnector.backend&&s.isLanguageChangingTo&&!a(s.isLanguageChangingTo,n))return!1}}),Ue=n=>typeof n=="string",er=n=>typeof n=="object"&&n!==null,tr=/&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34|nbsp|#160|copy|#169|reg|#174|hellip|#8230|#x2F|#47);/g,sr={"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&apos;":"'","&#39;":"'","&quot;":'"',"&#34;":'"',"&nbsp;":" ","&#160;":" ","&copy;":"©","&#169;":"©","&reg;":"®","&#174;":"®","&hellip;":"…","&#8230;":"…","&#x2F;":"/","&#47;":"/"},rr=n=>sr[n],ar=n=>n.replace(tr,rr);let Pt={bindI18n:"languageChanged",bindI18nStore:"",transEmptyNodeValue:"",transSupportBasicHtmlNodes:!0,transWrapTextNodes:"",transKeepBasicHtmlNodesFor:["br","strong","i","p"],useSuspense:!0,unescape:ar};const nr=(n={})=>{Pt={...Pt,...n}},ir=()=>Pt;let ys;const or=n=>{ys=n},lr=()=>ys,cr={type:"3rdParty",init(n){nr(n.options.react),or(n)}},dr=c.createContext();class ur{constructor(){this.usedNamespaces={}}addUsedNamespaces(r){r.forEach(t=>{this.usedNamespaces[t]||(this.usedNamespaces[t]=!0)})}getUsedNamespaces(){return Object.keys(this.usedNamespaces)}}const mr=(n,r)=>{const t=c.useRef();return c.useEffect(()=>{t.current=r?t.current:n},[n,r]),t.current},vs=(n,r,t,s)=>n.getFixedT(r,t,s),hr=(n,r,t,s)=>c.useCallback(vs(n,r,t,s),[n,r,t,s]),qe=(n,r={})=>{var A,C,Q,M;const{i18n:t}=r,{i18n:s,defaultNS:a}=c.useContext(dr)||{},i=t||s||lr();if(i&&!i.reportNamespaces&&(i.reportNamespaces=new ur),!i){kt(i,"NO_I18NEXT_INSTANCE","useTranslation: You will need to pass in an i18next instance by using initReactI18next");const R=(E,v)=>Ue(v)?v:er(v)&&Ue(v.defaultValue)?v.defaultValue:Array.isArray(E)?E[E.length-1]:E,$=[R,{},!1];return $.t=R,$.i18n={},$.ready=!1,$}(A=i.options.react)!=null&&A.wait&&kt(i,"DEPRECATED_OPTION","useTranslation: It seems you are still using the old wait option, you may migrate to the new useSuspense behaviour.");const o={...ir(),...i.options.react,...r},{useSuspense:l,keyPrefix:d}=o;let u=n||a||((C=i.options)==null?void 0:C.defaultNS);u=Ue(u)?[u]:u||["translation"],(M=(Q=i.reportNamespaces).addUsedNamespaces)==null||M.call(Q,u);const g=(i.isInitialized||i.initializedStoreOnce)&&u.every(R=>Xs(R,i,o)),m=hr(i,r.lng||null,o.nsMode==="fallback"?u:u[0],d),h=()=>m,b=()=>vs(i,r.lng||null,o.nsMode==="fallback"?u:u[0],d),[z,k]=c.useState(h);let f=u.join();r.lng&&(f=`${r.lng}${f}`);const S=mr(f),w=c.useRef(!0);c.useEffect(()=>{const{bindI18n:R,bindI18nStore:$}=o;w.current=!0,!g&&!l&&(r.lng?Mt(i,r.lng,u,()=>{w.current&&k(b)}):qt(i,u,()=>{w.current&&k(b)})),g&&S&&S!==f&&w.current&&k(b);const E=()=>{w.current&&k(b)};return R&&(i==null||i.on(R,E)),$&&(i==null||i.store.on($,E)),()=>{w.current=!1,i&&R&&(R==null||R.split(" ").forEach(v=>i.off(v,E))),$&&i&&$.split(" ").forEach(v=>i.store.off(v,E))}},[i,f]),c.useEffect(()=>{w.current&&g&&k(h)},[i,d,g]);const O=[z,i,g];if(O.t=z,O.i18n=i,O.ready=g,g||!g&&!l)return O;throw new Promise(R=>{r.lng?Mt(i,r.lng,u,()=>R()):qt(i,u,()=>R())})};var gr={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const xr=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),pr=(n,r)=>{const t=c.forwardRef(({color:s="currentColor",size:a=24,strokeWidth:i=2,absoluteStrokeWidth:o,children:l,...d},u)=>c.createElement("svg",{ref:u,...gr,width:a,height:a,stroke:s,strokeWidth:o?Number(i)*24/Number(a):i,className:`lucide lucide-${xr(n)}`,...d},[...r.map(([g,m])=>c.createElement(g,m)),...(Array.isArray(l)?l:[l])||[]]));return t.displayName=`${n}`,t};var ae=pr;const fr=ae("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),br=ae("Archive",[["rect",{width:"20",height:"5",x:"2",y:"4",rx:"2",key:"uhwcea"}],["path",{d:"M4 9v9a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9",key:"shkvi4"}],["path",{d:"M10 13h4",key:"ytezjc"}]]),We=ae("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),it=ae("Award",[["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}],["path",{d:"M15.477 12.89 17 22l-5-3-5 3 1.523-9.11",key:"em7aur"}]]),jt=ae("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]),js=ae("BookOpen",[["path",{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z",key:"vv98re"}],["path",{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z",key:"1cyq3y"}]]),ws=ae("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]),yr=ae("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]),ut=ae("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["polyline",{points:"22 4 12 14.01 9 11.01",key:"6xbx8j"}]]),vr=ae("CheckSquare",[["polyline",{points:"9 11 12 14 22 4",key:"19ybtz"}],["path",{d:"M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11",key:"1jnkn4"}]]),wt=ae("Check",[["polyline",{points:"20 6 9 17 4 12",key:"10jjfj"}]]),et=ae("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),jr=ae("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),ct=ae("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]),Ze=ae("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),mt=ae("Club",[["path",{d:"M17.28 9.05a5.5 5.5 0 1 0-10.56 0A5.5 5.5 0 1 0 12 17.66a5.5 5.5 0 1 0 5.28-8.6Z",key:"27yuqz"}],["path",{d:"M12 17.66L12 22",key:"ogfahf"}]]),ot=ae("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),ht=ae("Diamond",[["path",{d:"M2.7 10.3a2.41 2.41 0 0 0 0 3.41l7.59 7.59a2.41 2.41 0 0 0 3.41 0l7.59-7.59a2.41 2.41 0 0 0 0-3.41l-7.59-7.59a2.41 2.41 0 0 0-3.41 0Z",key:"1f1r0c"}]]),wr=ae("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),Ft=ae("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),Nr=ae("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]]),dt=ae("FolderOpen",[["path",{d:"m6 14 1.45-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.55 6a2 2 0 0 1-1.94 1.5H4a2 2 0 0 1-2-2V5c0-1.1.9-2 2-2h3.93a2 2 0 0 1 1.66.9l.82 1.2a2 2 0 0 0 1.66.9H18a2 2 0 0 1 2 2v2",key:"1nmvlm"}]]),Rt=ae("FolderPlus",[["path",{d:"M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13c0 1.1.9 2 2 2Z",key:"1fr9dc"}],["line",{x1:"12",x2:"12",y1:"10",y2:"16",key:"3c25pp"}],["line",{x1:"9",x2:"15",y1:"13",y2:"13",key:"10hoct"}]]),$t=ae("Folder",[["path",{d:"M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13c0 1.1.9 2 2 2Z",key:"1fr9dc"}]]),tt=ae("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"2",x2:"22",y1:"12",y2:"12",key:"1dnqot"}],["path",{d:"M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z",key:"nb9nel"}]]),Ns=ae("GripVertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]),zr=ae("Hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]),gt=ae("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]),Sr=ae("ImagePlus",[["path",{d:"M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7",key:"31hg93"}],["line",{x1:"16",x2:"22",y1:"5",y2:"5",key:"ez7e4s"}],["line",{x1:"19",x2:"19",y1:"2",y2:"8",key:"1gkr8c"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),Cr=ae("Key",[["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["path",{d:"m15.5 7.5 3 3L22 7l-3-3",key:"1rn1fs"}]]),Ut=ae("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]),Ht=ae("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),Bt=ae("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]),_r=ae("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]),kr=ae("MoreVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]),Vt=ae("Move",[["polyline",{points:"5 9 2 12 5 15",key:"1r5uj5"}],["polyline",{points:"9 5 12 2 15 5",key:"5v383o"}],["polyline",{points:"15 19 12 22 9 19",key:"g7qi8m"}],["polyline",{points:"19 9 22 12 19 15",key:"tpp73q"}],["line",{x1:"2",x2:"22",y1:"12",y2:"12",key:"1dnqot"}],["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}]]),qr=ae("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",key:"1xcu5"}],["circle",{cx:"17.5",cy:"10.5",r:".5",key:"736e4u"}],["circle",{cx:"8.5",cy:"7.5",r:".5",key:"clrty"}],["circle",{cx:"6.5",cy:"12.5",r:".5",key:"1s4xz9"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]),rt=ae("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]),zs=ae("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]),Re=ae("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),Kt=ae("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),Me=ae("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]),Ge=ae("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),Wt=ae("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),Pr=ae("ShieldAlert",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z",key:"3xmgem"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]]),Tr=ae("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z",key:"3xmgem"}]]),Ss=ae("SkipForward",[["polygon",{points:"5 4 15 12 5 20 5 4",key:"16p6eg"}],["line",{x1:"19",x2:"19",y1:"5",y2:"19",key:"futhcm"}]]),xt=ae("Spade",[["path",{d:"M5 9c-1.5 1.5-3 3.2-3 5.5A5.5 5.5 0 0 0 7.5 20c1.8 0 3-.5 4.5-2 1.5 1.5 2.7 2 4.5 2a5.5 5.5 0 0 0 5.5-5.5c0-2.3-1.5-4-3-5.5l-7-7-7 7Z",key:"40bo9n"}],["path",{d:"M12 18v4",key:"jadmvz"}]]),Qr=ae("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]),Cs=ae("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]),He=ae("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),_s=ae("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]),$e=ae("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]),Je=ae("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),Tt=ae("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]),ks=ae("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),Ar=ae("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]),qs=ae("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),Oe=ae("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),Er=ae("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),Te=ae("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);function Ye({compact:n=!1}){const{i18n:r}=qe();return n?e.jsx("div",{className:"bg-blue-500/20 rounded-lg p-1",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>r.changeLanguage("en"),className:`flex-1 px-3 py-2 rounded-md text-xs font-bold transition-all ${r.language==="en"?"bg-white text-blue-800 shadow-md":"text-blue-50 hover:text-white"}`,children:"EN"}),e.jsx("button",{onClick:()=>r.changeLanguage("ja"),className:`flex-1 px-3 py-2 rounded-md text-xs font-bold transition-all ${r.language==="ja"?"bg-white text-blue-800 shadow-md":"text-blue-50 hover:text-white"}`,children:"日本語"})]})}):e.jsxs("div",{className:"flex items-center gap-2 bg-white rounded-lg shadow-md border-2 border-blue-100 p-1.5",children:[e.jsx(tt,{size:18,className:"text-blue-700 ml-1"}),e.jsx("button",{onClick:()=>r.changeLanguage("en"),className:`px-4 py-2 rounded-md text-sm font-bold transition-all ${r.language==="en"?"bg-blue-700 text-white shadow-md":"text-gray-600 hover:bg-gray-100"}`,children:"English"}),e.jsx("button",{onClick:()=>r.changeLanguage("ja"),className:`px-4 py-2 rounded-md text-sm font-bold transition-all ${r.language==="ja"?"bg-blue-700 text-white shadow-md":"text-gray-600 hover:bg-gray-100"}`,children:"日本語"})]})}function Jt({setView:n,appState:r,setAppState:t,setError:s,setSuccess:a}){const{t:i}=qe(),[o,l]=c.useState(""),[d,u]=c.useState(""),[g,m]=c.useState(!1),[h,b]=c.useState(null);c.useEffect(()=>{(async()=>{console.log("Login: Checking for existing session...");const{data:{session:S},error:w}=await N.auth.getSession();if(w){console.error("Login: Session check error:",w),b(`Authentication error: ${w.message}`);return}if(S){console.log("Login: Active session found for:",S.user.email),m(!0);const{data:O,error:A}=await N.from("users").select("id, email, name, role, approved, verified, teacher_code, teacher_id").eq("id",S.user.id).maybeSingle();if(A){console.error("Login: Profile fetch error:",A),b(`Failed to load profile: ${A.message}`),m(!1);return}if(!O){console.log("Login: No profile found, waiting for profile creation..."),m(!1);return}if(O.role!=="superadmin"){if(!O.approved){console.log("Login: Account pending approval"),b("Your account is awaiting approval."),m(!1);return}if(!O.verified){console.log("Login: Email not verified"),b("Please verify your email to continue."),m(!1);return}}console.log("Login: Redirecting to dashboard for role:",O.role),t==null||t({...r,currentUser:O}),O.role==="teacher"?n==null||n("teacher-dashboard"):O.role==="superadmin"?n==null||n("superadmin-dashboard"):n==null||n("student-dashboard")}else console.log("Login: No active session found")})()},[]);const z=async f=>{var S;f.preventDefault(),b(null),s==null||s(null),a==null||a(null),m(!0);try{const{data:w,error:O}=await N.auth.signInWithPassword({email:o.trim().toLowerCase(),password:d});if(O){b(/invalid/i.test(O.message)?i("auth.invalidCredentials"):O.message);return}const A=(S=w.user)==null?void 0:S.id;if(!A){b("No session returned from Supabase.");return}const{data:C,error:Q}=await N.from("users").select("id, email, name, role, approved, verified, teacher_code, teacher_id").eq("id",A).maybeSingle();if(Q){b(Q.message);return}if((C==null?void 0:C.role)!=="superadmin"){if(!(C!=null&&C.approved))return b("Your account is awaiting approval.");if(!(C!=null&&C.verified))return b("Please verify your email to continue.")}t==null||t({...r,currentUser:C}),(C==null?void 0:C.role)==="teacher"?n==null||n("teacher-dashboard"):(C==null?void 0:C.role)==="superadmin"?n==null||n("superadmin-dashboard"):n==null||n("student-dashboard")}finally{m(!1)}},k=async()=>{b(null),s==null||s(null),a==null||a(null),m(!0);try{const f=`${window.location.origin}/`;console.log("Initiating Google OAuth with redirect URL:",f);const{data:S,error:w}=await N.auth.signInWithOAuth({provider:"google",options:{redirectTo:f}});w&&(console.error("OAuth initiation error:",w),b(`Google sign-in failed: ${w.message}`),m(!1))}catch(f){console.error("OAuth exception:",f),b("Failed to initiate Google sign-in. Please try again."),m(!1)}};return e.jsx("div",{className:"min-h-screen flex items-center justify-center",style:{background:"linear-gradient(to bottom, #4a7c7e, #3d6668)"},children:e.jsxs("div",{className:"max-w-sm w-full p-8 rounded-xl shadow-2xl bg-white/95 backdrop-blur-sm",children:[e.jsx("div",{className:"flex justify-center mb-6",children:e.jsx(Ye,{})}),e.jsx("h1",{className:"text-2xl font-bold text-center mb-2",style:{color:"#2c5aa0"},children:i("auth.loginToQuizMaster")}),e.jsx("p",{className:"text-center text-sm text-gray-600 mb-6",children:i("auth.welcomeBack")}),h&&e.jsx("div",{className:"mb-4 rounded-md bg-red-50 p-3 text-sm text-red-700 border border-red-200",children:h}),e.jsxs("form",{onSubmit:z,className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"#1f3a52"},children:i("auth.email")}),e.jsx("input",{type:"email",autoComplete:"username",value:o,onChange:f=>l(f.target.value),className:"w-full border-2 rounded-lg px-4 py-2.5 focus:outline-none transition-colors",style:{borderColor:"#e0e0e0"},onFocus:f=>f.target.style.borderColor="#4db8d8",onBlur:f=>f.target.style.borderColor="#e0e0e0",placeholder:i("auth.emailPlaceholder"),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"#1f3a52"},children:i("auth.password")}),e.jsx("input",{type:"password",autoComplete:"current-password",value:d,onChange:f=>u(f.target.value),className:"w-full border-2 rounded-lg px-4 py-2.5 focus:outline-none transition-colors",style:{borderColor:"#e0e0e0"},onFocus:f=>f.target.style.borderColor="#4db8d8",onBlur:f=>f.target.style.borderColor="#e0e0e0",placeholder:"••••••••",required:!0})]}),e.jsx("button",{type:"submit",disabled:g,className:"w-full text-white font-semibold py-2.5 rounded-lg transition-all duration-200 disabled:opacity-50",style:{background:"linear-gradient(to right, #2c5aa0, #4db8d8)",backgroundSize:"200% 100%"},onHover:f=>f.target.style.backgroundPosition="100% 0",children:i(g?"auth.signingIn":"auth.login")})]}),e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full",style:{borderTop:"1px solid #e0e0e0"}})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-2 text-gray-500",style:{backgroundColor:"rgba(255, 255, 255, 0.95)"},children:i("auth.orContinueWith")})})]}),e.jsxs("button",{onClick:k,type:"button",className:"mt-4 w-full flex items-center justify-center gap-3 border-2 font-medium py-2.5 px-4 rounded-lg transition-all duration-200",style:{borderColor:"#4db8d8",color:"#2c5aa0"},onMouseEnter:f=>f.target.style.backgroundColor="rgba(77, 184, 216, 0.1)",onMouseLeave:f=>f.target.style.backgroundColor="transparent",children:[e.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",children:[e.jsx("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),e.jsx("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),e.jsx("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),e.jsx("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),i("auth.signInWithGoogle")]})]}),e.jsxs("p",{className:"text-center text-sm mt-6 text-gray-700",children:[i("auth.dontHaveAccount")," ",e.jsx("button",{onClick:()=>n("register"),className:"font-semibold transition-colors hover:opacity-80",style:{color:"#2c5aa0"},children:i("auth.register")})]})]})})}function Dt(){const n="ABCDEFGHJKLMNPQRSTUVWXYZ23456789";let r="";for(let t=0;t<8;t++)r+=n.charAt(Math.floor(Math.random()*n.length));return r}function Gt(n){return!n||n.length!==8?n:`${n.slice(0,4)}-${n.slice(4)}`}function Fr(n){return n.replace(/-/g,"").toUpperCase()}function Dr({setView:n,setAppState:r,error:t,setError:s,success:a,setSuccess:i}){const{t:o}=qe(),[l,d]=c.useState({name:"",email:"",password:"",role:"student",studentId:"",teacherCode:""}),u=h=>{d({...l,[h.target.name]:h.target.value})},g=async h=>{var b,z,k,f,S,w;if(h.preventDefault(),s(""),i(""),l.role==="superadmin"){s("Superadmin accounts must be created by the system administrator.");return}try{console.log("=== CHECKING IF EMAIL ALREADY EXISTS ===");const O=l.email.trim().toLowerCase();console.log("Checking email:",O);const{data:A,error:C}=await N.from("users").select("id, email, role, verified").eq("email",O).maybeSingle();if(console.log("Existing user check - data:",A),console.log("Existing user check - error:",C),C&&C.code!=="PGRST116"){console.error("Error checking existing user:",C),s("Unable to verify email availability. Please try again.");return}if(A){console.error("Email already registered:",A),s("This email is already registered. Please login instead or use a different email.");return}console.log("Email is available for registration");let Q=null,M=null,R=null;if(l.role==="student"){if(!l.teacherCode.trim()){s("Teacher code is required for students.");return}const F=l.teacherCode.replace(/-/g,"").toUpperCase();R=F,console.log("=== TEACHER CODE VALIDATION ==="),console.log("Original code entered:",l.teacherCode),console.log("Cleaned code for lookup:",F);const{data:G,error:J}=await N.from("users").select("id, name, teacher_code").eq("teacher_code",F).eq("role","teacher").maybeSingle();if(console.log("Database query result - teacher:",G),console.log("Database query result - error:",J),J){console.error("Teacher lookup error:",J),s(`Database error: ${J.message}`);return}if(!G){console.error("No teacher found with code:",F);const{data:X,error:ie}=await N.from("users").select("id, name, teacher_code, role").eq("role","teacher");console.log("All teachers in database:",X),console.log("Debug query error:",ie),s("Invalid teacher code. Please check the code and try again.");return}console.log("Teacher found! ID:",G.id,"Name:",G.name),Q=G.id}if(l.role==="teacher"){let F=!0;for(;F;){M=Dt();const{data:G}=await N.from("users").select("id").eq("teacher_code",M).maybeSingle();F=!!G}}console.log("=== CREATING AUTH USER ==="),console.log("Email:",l.email.trim().toLowerCase()),console.log("Role:",l.role),console.log("Teacher ID to assign:",Q);const{data:$,error:E}=await N.auth.signUp({email:l.email.trim().toLowerCase(),password:l.password,options:{data:{name:l.name,role:l.role}}});if(console.log("Auth signup result - data:",$),console.log("Auth signup result - error:",E),E){console.error("Supabase auth error:",E),(b=E.message)!=null&&b.includes("already registered")||(z=E.message)!=null&&z.includes("already exists")?s("This email is already registered. Please login instead."):(k=E.message)!=null&&k.includes("Invalid email")?s("Please enter a valid email address."):(f=E.message)!=null&&f.includes("Password")?s("Password must be at least 6 characters long."):s(E.message||"Registration failed. Try again.");return}if(!$.user){console.error("No user returned from auth signup"),s("Registration failed. Please try again.");return}console.log("Auth user created successfully! ID:",$.user.id);const v=$.user.identities&&$.user.identities.length>0;console.log("Is new user?",v),console.log("=== CREATING USER PROFILE ===");const _={id:$.user.id,name:l.name,email:l.email.trim().toLowerCase(),role:l.role,student_id:l.role==="student"?l.studentId:null,teacher_id:Q,teacher_invite_code:R,teacher_code:M,verified:!1,approved:!1};console.log("Profile data to insert:",_);const{error:D}=await N.from("users").insert([_]);if(console.log("Profile creation result - error:",D),D){console.error("Profile creation error:",D),D.code==="23505"||(S=D.message)!=null&&S.includes("duplicate key")?(console.error("Duplicate key error - email already exists in users table"),s("This email is already registered. Please login instead or contact support if you believe this is an error.")):(w=D.message)!=null&&w.includes("violates foreign key constraint")?(console.error("Foreign key constraint error:",D.message),s("Invalid teacher reference. Please try again or contact support.")):s(`Registration failed: ${D.message||"Unknown error occurred"}`),console.error("⚠️ IMPORTANT: Auth user created but profile failed. User ID:",$.user.id);return}console.log("✅ Profile created successfully!"),console.log("✅ Registration complete!"),l.role==="student"?i("Registration successful! Please verify your email, then your teacher will approve your account."):i("Registration successful! Please verify your email, then a superadmin will approve your account."),setTimeout(()=>{n("verify")},3e3)}catch(O){console.error("Unexpected error:",O),s("Something went wrong. Try again.")}},m=async()=>{s(""),i("");try{const h=`${window.location.origin}/`;console.log("Initiating Google OAuth with redirect URL:",h);const{data:b,error:z}=await N.auth.signInWithOAuth({provider:"google",options:{redirectTo:h}});z&&(console.error("OAuth initiation error:",z),s(`Google sign-in failed: ${z.message}`))}catch(h){console.error("OAuth exception:",h),s("Failed to initiate Google sign-in. Please try again.")}};return e.jsx("div",{className:"min-h-screen flex items-center justify-center",style:{background:"linear-gradient(to bottom, #4a7c7e, #3d6668)"},children:e.jsxs("div",{className:"bg-white/95 backdrop-blur-sm p-8 rounded-xl shadow-2xl w-96",children:[e.jsx("div",{className:"flex justify-center mb-6",children:e.jsx(Ye,{})}),e.jsx("h2",{className:"text-2xl font-bold mb-2 text-center",style:{color:"#2c5aa0"},children:o("auth.registerForQuizMaster")}),e.jsx("p",{className:"text-center text-sm text-gray-600 mb-6",children:o("auth.createAccount")}),t&&e.jsx("div",{className:"bg-red-50 text-red-700 p-3 mb-4 rounded-lg border border-red-200 text-sm",children:t}),a&&e.jsx("div",{className:"bg-green-50 text-green-700 p-3 mb-4 rounded-lg border border-green-200 text-sm",children:a}),e.jsxs("form",{onSubmit:g,className:"space-y-4",children:[e.jsx("input",{type:"text",name:"name",placeholder:o("auth.fullName"),value:l.name,onChange:u,className:"w-full px-4 py-2.5 border-2 rounded-lg focus:outline-none transition-colors",style:{borderColor:"#e0e0e0"},onFocus:h=>h.target.style.borderColor="#4db8d8",onBlur:h=>h.target.style.borderColor="#e0e0e0",required:!0}),e.jsx("input",{type:"email",name:"email",placeholder:o("auth.email"),value:l.email,onChange:u,className:"w-full px-4 py-2.5 border-2 rounded-lg focus:outline-none transition-colors",style:{borderColor:"#e0e0e0"},onFocus:h=>h.target.style.borderColor="#4db8d8",onBlur:h=>h.target.style.borderColor="#e0e0e0",required:!0}),e.jsx("input",{type:"password",name:"password",placeholder:o("auth.password"),value:l.password,onChange:u,className:"w-full px-4 py-2.5 border-2 rounded-lg focus:outline-none transition-colors",style:{borderColor:"#e0e0e0"},onFocus:h=>h.target.style.borderColor="#4db8d8",onBlur:h=>h.target.style.borderColor="#e0e0e0",required:!0}),e.jsxs("select",{name:"role",value:l.role,onChange:u,className:"w-full px-4 py-2.5 border-2 rounded-lg focus:outline-none transition-colors",style:{borderColor:"#e0e0e0",color:"#1f3a52"},onFocus:h=>h.target.style.borderColor="#4db8d8",onBlur:h=>h.target.style.borderColor="#e0e0e0",children:[e.jsx("option",{value:"student",children:o("auth.student")}),e.jsx("option",{value:"teacher",children:o("auth.teacher")})]}),l.role==="student"&&e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",name:"studentId",placeholder:o("auth.studentId"),value:l.studentId,onChange:u,className:"w-full px-4 py-2.5 border-2 rounded-lg focus:outline-none transition-colors",style:{borderColor:"#e0e0e0"},onFocus:h=>h.target.style.borderColor="#4db8d8",onBlur:h=>h.target.style.borderColor="#e0e0e0",required:!0}),e.jsx("input",{type:"text",name:"teacherCode",placeholder:o("auth.teacherCodePlaceholder"),value:l.teacherCode,onChange:u,className:"w-full px-4 py-2.5 border-2 rounded-lg focus:outline-none transition-colors uppercase",style:{borderColor:"#e0e0e0"},onFocus:h=>h.target.style.borderColor="#4db8d8",onBlur:h=>h.target.style.borderColor="#e0e0e0",maxLength:"9",required:!0}),e.jsx("p",{className:"text-xs text-gray-600 px-2",children:o("auth.teacherCodeHelp")})]}),e.jsx("button",{type:"submit",className:"w-full text-white font-semibold py-2.5 rounded-lg transition-all duration-200",style:{background:"linear-gradient(to right, #2c5aa0, #4db8d8)"},children:o("auth.register")})]}),e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full",style:{borderTop:"1px solid #e0e0e0"}})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-2 text-gray-500",style:{backgroundColor:"rgba(255, 255, 255, 0.95)"},children:o("auth.orContinueWith")})})]}),e.jsxs("button",{onClick:m,type:"button",className:"mt-4 w-full flex items-center justify-center gap-3 border-2 font-medium py-2.5 px-4 rounded-lg transition-all duration-200",style:{borderColor:"#4db8d8",color:"#2c5aa0"},onMouseEnter:h=>h.target.style.backgroundColor="rgba(77, 184, 216, 0.1)",onMouseLeave:h=>h.target.style.backgroundColor="transparent",children:[e.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",children:[e.jsx("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),e.jsx("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),e.jsx("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),e.jsx("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),o("auth.signInWithGoogle")]})]}),e.jsxs("p",{className:"mt-6 text-center text-sm text-gray-700",children:[o("auth.alreadyHaveAccount")," ",e.jsx("button",{onClick:()=>n("login"),className:"font-semibold transition-colors hover:opacity-80",style:{color:"#2c5aa0"},children:o("auth.login")})]})]})})}function Or({setView:n,setError:r,setSuccess:t}){const{t:s}=qe(),[a,i]=c.useState(!0),[o,l]=c.useState(!1);c.useEffect(()=>{(async()=>{const{data:{session:g}}=await N.auth.getSession();if(g!=null&&g.user){const{data:m}=await N.from("users").select("verified, role").eq("id",g.user.id).maybeSingle();if(m!=null&&m.verified){t("Email verified! Redirecting to login..."),setTimeout(()=>{n("login")},2e3);return}}i(!1)})()},[n,t]);const d=async()=>{var u;try{const{data:{session:g}}=await N.auth.getSession();if(!((u=g==null?void 0:g.user)!=null&&u.email)){r("No email found. Please register again.");return}const{error:m}=await N.auth.resend({type:"signup",email:g.user.email});m?r(`Failed to resend email: ${m.message}`):(l(!0),setTimeout(()=>l(!1),5e3))}catch(g){console.error("Resend error:",g),r("Failed to resend verification email.")}};return a?e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",style:{background:"linear-gradient(to bottom, #4a7c7e, #3d6668)"},children:e.jsxs("div",{className:"bg-white/95 backdrop-blur-sm rounded-2xl shadow-2xl p-8 w-full max-w-md text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 mx-auto mb-4",style:{borderColor:"#2c5aa0"}}),e.jsx("p",{className:"text-gray-600",children:s("auth.checkingVerification")})]})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",style:{background:"linear-gradient(to bottom, #4a7c7e, #3d6668)"},children:e.jsxs("div",{className:"bg-white/95 backdrop-blur-sm rounded-2xl shadow-2xl p-8 w-full max-w-md",children:[e.jsx("div",{className:"flex justify-center mb-6",children:e.jsx(Ye,{})}),e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"mx-auto w-16 h-16 rounded-full flex items-center justify-center mb-4",style:{backgroundColor:"rgba(77, 184, 216, 0.1)"},children:e.jsx("svg",{className:"w-8 h-8",style:{color:"#4db8d8"},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})})}),e.jsx("h1",{className:"text-3xl font-bold mb-2",style:{color:"#2c5aa0"},children:s("auth.checkYourEmail")}),e.jsx("p",{className:"text-gray-600",children:s("auth.verificationLinkSent")})]}),o&&e.jsx("div",{className:"bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-lg mb-4 text-sm",children:s("auth.verificationEmailResent")}),e.jsxs("div",{className:"rounded-lg p-4 mb-6",style:{backgroundColor:"rgba(77, 184, 216, 0.1)",borderColor:"#4db8d8",borderWidth:"1px"},children:[e.jsx("h3",{className:"font-semibold mb-2",style:{color:"#2c5aa0"},children:s("auth.whatToDoNext")}),e.jsxs("ol",{className:"list-decimal list-inside text-sm space-y-1",style:{color:"#1f3a52"},children:[e.jsx("li",{children:s("auth.checkEmailInbox")}),e.jsx("li",{children:s("auth.lookForEmail")}),e.jsx("li",{children:s("auth.clickVerificationLink")}),e.jsx("li",{children:s("auth.returnToLogin")})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:d,className:"w-full text-white p-3 rounded-lg transition-all duration-200 font-medium",style:{background:"linear-gradient(to right, #2c5aa0, #4db8d8)"},children:s("auth.resendVerificationEmail")}),e.jsx("button",{onClick:()=>n("login"),className:"w-full border-2 p-3 rounded-lg transition-all duration-200 font-medium",style:{borderColor:"#4db8d8",color:"#2c5aa0"},onMouseEnter:u=>u.target.style.backgroundColor="rgba(77, 184, 216, 0.1)",onMouseLeave:u=>u.target.style.backgroundColor="transparent",children:s("auth.backToLogin")})]}),e.jsx("p",{className:"text-xs text-gray-500 text-center mt-4",children:s("auth.didntReceiveEmail")})]})})}function Lr({user:n,setAppState:r,setView:t,setSuccess:s,setError:a}){const{t:i}=qe(),[o,l]=c.useState((n==null?void 0:n.teacher_invite_code)||""),[d,u]=c.useState((n==null?void 0:n.role)||""),[g,m]=c.useState(!1),[h,b]=c.useState(""),z=async k=>{if(k.preventDefault(),b(""),a==null||a(""),s==null||s(""),!d){b("Please select your role to continue.");return}const f=o==null?void 0:o.trim();if(d==="student"&&!f){b("Please enter your teacher invitation code.");return}m(!0);try{const S={role:d};let w=null;if(d==="student"){const C=Fr(f),{data:Q,error:M}=await N.from("users").select("id, teacher_code, name").eq("teacher_code",C).eq("role","teacher").maybeSingle();if(M)throw console.error("Failed to validate teacher code:",M),new Error("Unable to validate teacher invitation code. Please try again.");if(!Q){b("Invalid teacher invitation code. Please double-check the code you received."),m(!1);return}S.teacher_id=Q.id,S.teacher_invite_code=C,w=Q}else if(d==="teacher"){if(!(n==null?void 0:n.teacher_code)){let Q=null,M=0;for(;!Q&&M<10;){M+=1;const R=Dt(),{data:$,error:E}=await N.from("users").select("id").eq("teacher_code",R).maybeSingle();if(E)throw console.error("Failed to validate teacher code uniqueness:",E),new Error("Unable to generate teacher code. Please try again.");$||(Q=R)}if(!Q)throw new Error("Unable to generate a teacher code. Please try again later.");S.teacher_code=Q}S.teacher_id=null,S.teacher_invite_code=f||null}else S.teacher_id=null,S.teacher_invite_code=f||null;const{data:O,error:A}=await N.from("users").update(S).eq("id",n.id).select().single();if(A)throw console.error("Failed to update user profile:",A),new Error(A.message||"Profile update failed. Please try again.");r==null||r(C=>({...C,currentUser:O})),d==="student"?(s==null||s(w?`You're all set! You're now connected to ${w.name}.`:"Profile updated successfully."),t==null||t("student-dashboard")):d==="teacher"?(s==null||s("Welcome! Your teacher profile is ready."),t==null||t("teacher-dashboard")):d==="superadmin"?(s==null||s("Profile updated successfully."),t==null||t("superadmin-dashboard")):(s==null||s("Profile updated successfully."),t==null||t("student-dashboard"))}catch(S){console.error("Profile completion failed:",S),b(S.message||"Failed to complete profile. Please try again.")}finally{m(!1)}};return e.jsx("div",{className:"min-h-screen flex items-center justify-center px-4",style:{background:"linear-gradient(to bottom, #4a7c7e, #3d6668)"},children:e.jsxs("div",{className:"max-w-md w-full bg-white/95 backdrop-blur-sm shadow-2xl rounded-xl p-6 space-y-6",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx(Ye,{})}),e.jsxs("div",{className:"space-y-1 text-center",children:[e.jsx("h1",{className:"text-2xl font-semibold",style:{color:"#2c5aa0"},children:i("auth.almostDone")}),e.jsx("p",{className:"text-sm text-gray-600",children:i("auth.completeProfileBelow")})]}),(h||(n==null?void 0:n.approved)===!1)&&e.jsx("div",{className:"rounded-md border p-3 text-sm",style:{borderColor:"#ef4444",color:"#b91c1c",background:"#fef2f2"},children:h||i("auth.pendingApprovalMessage")}),e.jsxs("form",{onSubmit:z,className:"space-y-4",children:[d!=="teacher"&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"teacher-invite",className:"block text-sm font-medium text-gray-700",children:i("auth.enterTeacherCode")}),e.jsx("input",{id:"teacher-invite",type:"text",value:o,onChange:k=>l(k.target.value.toUpperCase()),className:"mt-1 w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-cyan-400 focus:outline-none focus:ring-1 focus:ring-cyan-500",placeholder:i("auth.teacherCodeExample")}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:i("auth.studentsMustEnterCode")})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"role",className:"block text-sm font-medium text-gray-700",children:i("auth.selectYourRole")}),e.jsxs("select",{id:"role",value:d||"",onChange:k=>{u(k.target.value),b("")},className:"mt-1 w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-cyan-400 focus:outline-none focus:ring-1 focus:ring-cyan-500",children:[e.jsx("option",{value:"",disabled:!0,children:i("auth.selectRole")}),e.jsx("option",{value:"student",children:i("auth.student")}),e.jsx("option",{value:"teacher",children:i("auth.teacher")})]}),d==="teacher"&&e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:i("auth.teachersNoCodeNeeded")})]}),e.jsx("button",{type:"submit",disabled:g,className:"w-full rounded-lg px-4 py-2.5 text-white font-medium transition-all duration-200 disabled:opacity-60",style:{background:"linear-gradient(to right, #2c5aa0, #4db8d8)"},children:i(g?"auth.saving":"common.submit")})]})]})})}function Le({isOpen:n,title:r,message:t,onConfirm:s,onCancel:a,confirmText:i="Confirm",cancelText:o="Cancel",confirmStyle:l="primary"}){if(c.useEffect(()=>(n?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[n]),c.useEffect(()=>{const u=g=>{g.key==="Escape"&&n&&a()};return document.addEventListener("keydown",u),()=>document.removeEventListener("keydown",u)},[n,a]),!n)return null;const d=l==="danger"?"bg-red-600 hover:bg-red-700 text-white":"bg-gradient-to-r from-blue-600 to-cyan-500 hover:from-blue-700 hover:to-cyan-600 text-white";return e.jsxs("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center p-4 animate-fadeIn",onClick:a,children:[e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50"}),e.jsxs("div",{className:"relative bg-white rounded-lg shadow-2xl max-w-md w-full animate-scaleIn",onClick:u=>u.stopPropagation(),children:[e.jsx("div",{className:"p-6 pb-4",children:e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:r})}),e.jsx("div",{className:"px-6 pb-6",children:e.jsx("p",{className:"text-gray-600 whitespace-pre-line",children:t})}),e.jsxs("div",{className:"flex gap-3 px-6 pb-6 justify-end",children:[e.jsx("button",{onClick:a,className:"px-4 py-2 rounded-lg font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 transition-colors",children:o}),e.jsx("button",{onClick:s,className:`px-4 py-2 rounded-lg font-medium transition-colors ${d}`,children:i})]})]})]})}function Ee({currentView:n,setView:r,appState:t}){var b,z,k,f,S,w,O,A,C,Q,M,R,$,E,v,_,D;const{t:s}=qe(),a=(b=t==null?void 0:t.currentUser)==null?void 0:b.role,[i,o]=c.useState(!1),[l,d]=c.useState(!1),u=async()=>{o(!1);try{await N.auth.signOut(),r("login")}catch(F){console.error("Logout error:",F)}},m=(()=>a==="teacher"?[{id:"teacher-dashboard",label:s("nav.dashboard"),icon:Ut},{id:"manage-quizzes",label:s("teacher.myQuizzes"),icon:dt},{id:"create-quiz",label:s("nav.createQuiz"),icon:Nr},{id:"manage-students",label:s("teacher.students"),icon:Oe},{id:"reports",label:s("nav.reports"),icon:jt},{id:"public-quizzes",label:s("nav.publicQuizzes"),icon:tt}]:a==="student"?[{id:"student-dashboard",label:s("nav.dashboard"),icon:Ut}]:a==="superadmin"?[{id:"superadmin-dashboard",label:s("nav.dashboard"),icon:Tr}]:[])(),h=F=>{r(F),d(!1)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"hidden md:flex w-64 text-white flex flex-col h-screen fixed left-0 top-0 shadow-xl z-40",style:{background:"linear-gradient(to bottom, #4a7c7e, #3d6668)"},children:[e.jsx("div",{className:"p-4 flex items-center justify-center border-b",style:{borderColor:"rgba(255, 255, 255, 0.1)"},children:e.jsx("img",{src:"http://pierenglishschool.com/quizapp/images/logo.png",alt:"QuizMaster Logo",className:"max-w-full h-auto",style:{maxHeight:"112px",width:"auto"},onError:F=>{F.target.style.display="none"}})}),e.jsxs("div",{className:"p-4 border-b",style:{borderColor:"rgba(255, 255, 255, 0.1)"},children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[(z=t==null?void 0:t.currentUser)!=null&&z.avatar_url?e.jsx("img",{src:t.currentUser.avatar_url,alt:t.currentUser.name,className:"w-10 h-10 rounded-full object-cover flex-shrink-0 border",style:{borderColor:"rgba(255, 255, 255, 0.2)"},onError:F=>{F.target.style.display="none"}}):e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0",style:{backgroundColor:"rgba(255, 255, 255, 0.2)"},children:e.jsx("span",{className:"text-sm font-bold",children:((f=(k=t==null?void 0:t.currentUser)==null?void 0:k.name)==null?void 0:f.charAt(0).toUpperCase())||((w=(S=t==null?void 0:t.currentUser)==null?void 0:S.email)==null?void 0:w.charAt(0).toUpperCase())})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold truncate",children:((O=t==null?void 0:t.currentUser)==null?void 0:O.name)||"User"}),e.jsx("p",{className:"text-xs text-blue-50 truncate",children:(A=t==null?void 0:t.currentUser)==null?void 0:A.email})]})]}),e.jsx(Ye,{compact:!0})]}),e.jsx("nav",{className:"flex-1 overflow-y-auto p-4",children:e.jsx("ul",{className:"space-y-1",children:m.map(F=>{const G=F.icon,J=n===F.id;return e.jsx("li",{children:e.jsxs("button",{onClick:()=>h(F.id),className:`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-all duration-200 ${J?"font-semibold shadow-md":"text-gray-200 hover:text-white"}`,style:J?{backgroundColor:"rgba(255, 255, 255, 0.15)"}:{backgroundColor:"transparent"},children:[e.jsx(G,{size:20,className:J?"":"text-gray-300"}),e.jsx("span",{className:"text-sm",children:F.label})]})},F.id)})})}),e.jsxs("div",{className:"p-4 border-t space-y-2",style:{borderColor:"rgba(255, 255, 255, 0.1)"},children:[e.jsxs("button",{onClick:()=>h("settings"),className:`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-all duration-200 ${n==="settings"?"font-semibold shadow-md":"text-gray-200 hover:text-white"}`,style:n==="settings"?{backgroundColor:"rgba(255, 255, 255, 0.15)"}:{backgroundColor:"transparent"},children:[e.jsx(Wt,{size:20,className:n==="settings"?"":"text-gray-300"}),e.jsx("span",{className:"text-sm",children:s("nav.settings")})]}),e.jsxs("button",{onClick:()=>o(!0),className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg text-gray-200 hover:text-white transition-all duration-200",style:{backgroundColor:"transparent"},onMouseEnter:F=>F.target.style.backgroundColor="rgba(220, 38, 38, 0.2)",onMouseLeave:F=>F.target.style.backgroundColor="transparent",children:[e.jsx(Bt,{size:20}),e.jsx("span",{className:"text-sm",children:s("nav.logout")})]})]})]}),e.jsxs("div",{className:"md:hidden fixed top-0 left-0 right-0 bg-white shadow-md z-50 px-4 py-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[(C=t==null?void 0:t.currentUser)!=null&&C.avatar_url?e.jsx("img",{src:t.currentUser.avatar_url,alt:t.currentUser.name,className:"w-8 h-8 rounded-full object-cover",onError:F=>{F.target.style.display="none"}}):e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center bg-blue-500 text-white text-sm font-bold",children:((M=(Q=t==null?void 0:t.currentUser)==null?void 0:Q.name)==null?void 0:M.charAt(0).toUpperCase())||"U"}),e.jsx("span",{className:"text-sm font-semibold text-gray-800 truncate",children:((R=t==null?void 0:t.currentUser)==null?void 0:R.name)||"User"})]}),e.jsx("button",{onClick:()=>d(!l),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:l?e.jsx(Te,{size:24,className:"text-gray-700"}):e.jsx(_r,{size:24,className:"text-gray-700"})})]}),l&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"md:hidden fixed inset-0 bg-black/50 z-40 animate-fadeIn",onClick:()=>d(!1)}),e.jsxs("div",{className:"md:hidden fixed top-0 left-0 bottom-0 w-64 bg-white shadow-2xl z-50 overflow-y-auto",style:{animation:"slideInLeft 0.3s ease-out"},children:[e.jsxs("div",{className:"p-4 border-b bg-gradient-to-r from-blue-600 to-cyan-500",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[($=t==null?void 0:t.currentUser)!=null&&$.avatar_url?e.jsx("img",{src:t.currentUser.avatar_url,alt:t.currentUser.name,className:"w-10 h-10 rounded-full object-cover border-2 border-white",onError:F=>{F.target.style.display="none"}}):e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center bg-white/20 border-2 border-white",children:e.jsx("span",{className:"text-sm font-bold text-white",children:((v=(E=t==null?void 0:t.currentUser)==null?void 0:E.name)==null?void 0:v.charAt(0).toUpperCase())||"U"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold text-white truncate",children:((_=t==null?void 0:t.currentUser)==null?void 0:_.name)||"User"}),e.jsx("p",{className:"text-xs text-blue-50 truncate",children:(D=t==null?void 0:t.currentUser)==null?void 0:D.email})]}),e.jsx("button",{onClick:()=>d(!1),className:"p-1 hover:bg-white/20 rounded-lg transition-colors","aria-label":"Close menu",children:e.jsx(Te,{size:20,className:"text-white"})})]}),e.jsx(Ye,{compact:!0})]}),e.jsxs("nav",{className:"p-4",children:[e.jsx("ul",{className:"space-y-2",children:m.map(F=>{const G=F.icon,J=n===F.id;return e.jsx("li",{children:e.jsxs("button",{onClick:()=>h(F.id),className:`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-all duration-200 ${J?"font-semibold bg-blue-100 text-blue-700":"text-gray-700 hover:bg-gray-100"}`,children:[e.jsx(G,{size:20}),e.jsx("span",{className:"text-sm",children:F.label})]})},F.id)})}),e.jsxs("div",{className:"border-t pt-4 mt-4 space-y-2",children:[e.jsxs("button",{onClick:()=>h("settings"),className:`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-all duration-200 ${n==="settings"?"font-semibold bg-blue-100 text-blue-700":"text-gray-700 hover:bg-gray-100"}`,children:[e.jsx(Wt,{size:20}),e.jsx("span",{className:"text-sm",children:s("nav.settings")})]}),e.jsxs("button",{onClick:()=>{o(!0),d(!1)},className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg text-red-600 hover:bg-red-50 transition-all duration-200",children:[e.jsx(Bt,{size:20}),e.jsx("span",{className:"text-sm",children:s("nav.logout")})]})]})]})]})]}),e.jsx(Le,{isOpen:i,title:s("nav.logout"),message:s("common.confirm"),onConfirm:u,onCancel:()=>o(!1),confirmText:s("nav.logout"),confirmStyle:"danger"})]})}function Ir({appState:n,setView:r,error:t,setError:s,onBack:a,isApproved:i}){var f,S;const{t:o}=qe(),[l,d]=c.useState(""),[u,g]=c.useState(!1),[m,h]=c.useState(null),b=async()=>{var w,O,A,C,Q,M;if(!i){s(o("student.accountAwaitingApproval"));return}if(!l||l.length!==6){s(o("student.enterValid6DigitPIN"));return}g(!0),s(null);try{console.log("Looking for quiz with PIN:",l),console.log("Current user:",(w=n.currentUser)==null?void 0:w.id,(O=n.currentUser)==null?void 0:O.email);const{data:R,error:$}=await N.from("quiz_sessions").select("*").eq("pin",l);if(console.log("Query result:",{sessions:R,sessionError:$}),$){if(console.error("Session query error details:",{message:$.message,code:$.code,details:$.details,hint:$.hint}),$.code==="42501"||(A=$.message)!=null&&A.includes("policy")){s(o("errors.permissionDeniedEnsureApproved")),g(!1);return}throw $}if(!R||R.length===0){console.warn("No quiz session found with PIN:",l),s(o("errors.invalidPinQuizNotFound")),g(!1);return}const E=R[0];if(console.log("Found session:",E),E.status==="completed"){s(o("errors.quizAlreadyEnded")),g(!1);return}if(E.mode==="team"){console.log("Session is in team mode, checking for existing team memberships...");const{data:D,error:F}=await N.from("team_members").select("team_id, teams(name, team_name)").eq("student_id",n.currentUser.id);if(F)console.error("Error fetching student teams:",F);else if(D&&D.length>0){const G=D.map(ie=>ie.team_id);console.log("Student belongs to teams:",G);const{data:J,error:X}=await N.from("session_participants").select("team_id, teams(name, team_name)").eq("session_id",E.id).in("team_id",G).maybeSingle();if(X)console.error("Error checking team participants:",X);else if(J){console.log("Found matching team in session:",J),h({...J,session_id:E.id}),g(!1);return}else{const ie=D[0],T=((C=ie.teams)==null?void 0:C.name)||((Q=ie.teams)==null?void 0:Q.team_name)||"Unknown Team";console.log("Team not in session yet, joining as first team member. Team:",T);const{data:B,error:se}=await N.from("session_participants").insert({session_id:E.id,user_id:n.currentUser.id,team_id:ie.team_id,is_team_entry:!0,score:0}).select().single();if(se)if(se.code==="23505")console.log("Already joined this session, proceeding...");else throw console.error("Failed to create team participant:",se),new Error(`${o("errors.failedToJoinQuiz")}: ${se.message}`);else console.log("Team participant created successfully:",B);r("student-quiz",E.id);return}}else{console.log("Student does not belong to any team"),s(o("errors.mustJoinTeamFirst")||"You must create or join a team before joining a Team Mode quiz."),g(!1);return}}console.log("Creating participant record for user:",(M=n.currentUser)==null?void 0:M.id);const{data:v,error:_}=await N.from("session_participants").insert({session_id:E.id,user_id:n.currentUser.id,score:0,is_team_entry:!1}).select().single();if(_)if(_.code==="23505")console.log("Student already joined this session, proceeding...");else throw console.error("Failed to create participant:",_),new Error(`${o("errors.failedToJoinQuiz")}: ${_.message}`);else console.log("Participant created successfully:",v);r("student-quiz",E.id)}catch(R){s(o("errors.errorJoiningQuiz")+": "+R.message),g(!1)}},z=async()=>{if(m){g(!0),s(null);try{const{error:w}=await N.from("session_participants").insert({session_id:m.session_id,user_id:n.currentUser.id,team_id:m.team_id,is_team_entry:!0,score:0});if(w)if(w.code==="23505")console.log("Already joined team session");else throw w;r("student-quiz",m.session_id)}catch(w){console.error("Error joining team:",w),s(o("errors.failedToJoinQuiz")+": "+w.message),h(null),g(!1)}}},k=()=>{h(null),g(!1)};return m?e.jsx("div",{className:"bg-gradient-to-br from-blue-500 to-cyan-500 min-h-screen flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md text-center",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:o("student.joinTeam")}),e.jsx("p",{className:"text-gray-600 mb-6",children:o("student.yourTeamIsAlreadyInSession",{teamName:(f=m.teams)==null?void 0:f.team_name})}),e.jsx("div",{className:"bg-blue-50 p-4 rounded-lg mb-6",children:e.jsx("h3",{className:"font-bold text-lg text-blue-800",children:(S=m.teams)==null?void 0:S.team_name})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:z,className:"w-full bg-blue-600 text-white p-3 rounded-lg hover:bg-blue-700 font-semibold",children:o("student.joinAsTeamMember")}),e.jsx("button",{onClick:k,className:"w-full bg-gray-200 text-gray-800 p-3 rounded-lg hover:bg-gray-300 font-semibold",children:o("common.cancel")})]})]})}):e.jsx("div",{className:"bg-gradient-to-br from-blue-500 to-cyan-500 min-h-screen flex items-center justify-center p-4 pt-20 md:pt-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-4 md:p-8 w-full max-w-sm md:max-w-md",children:[e.jsxs("button",{onClick:a,className:"flex items-center gap-2 text-gray-600 hover:text-gray-800 mb-3 md:mb-4 text-sm md:text-base",children:[e.jsx(We,{size:20}),o("student.backToDashboard")]}),e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-center mb-4 md:mb-6",children:o("student.joinQuiz")}),e.jsx("p",{className:"text-center text-gray-600 mb-4 md:mb-6 text-sm md:text-base",children:o("student.enterPinFromTeacher")}),t&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-3 py-2 md:px-4 md:py-3 rounded mb-3 md:mb-4 text-sm md:text-base",children:t}),e.jsx("input",{type:"text",placeholder:o("session.enterPin"),value:l,onChange:w=>d(w.target.value),className:"w-full p-3 md:p-4 border-2 rounded-lg text-center text-xl md:text-2xl mb-3 md:mb-4",maxLength:"6"}),e.jsx("button",{onClick:b,disabled:u||!i,className:"w-full bg-blue-700 text-white p-3 md:p-4 rounded-lg hover:bg-blue-800 text-base md:text-xl font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:o(u?"student.joining":"student.joinQuiz")}),!i&&e.jsx("p",{className:"mt-3 md:mt-4 text-xs md:text-sm text-gray-500 text-center",children:o("student.waitingForTeacherApprovalMessage")})]})})}function Mr({appState:n,setView:r,error:t,setError:s,onBack:a,isApproved:i}){const{t:o}=qe(),[l,d]=c.useState(""),[u,g]=c.useState([]),[m,h]=c.useState([]),[b,z]=c.useState(!1),[k,f]=c.useState(!0),[S,w]=c.useState(!1),[O,A]=c.useState(null),[C,Q]=c.useState("");c.useEffect(()=>{i?M():f(!1)},[i]);const M=async()=>{var v;try{const _=(v=n.currentUser)==null?void 0:v.teacher_id;if(!_){s(o("errors.couldNotFindTeacher")),f(!1);return}const{data:D,error:F}=await N.from("users").select("id, name, email").eq("teacher_id",_).eq("role","student").eq("approved",!0).neq("id",n.currentUser.id).order("name");if(F)throw F;g(D||[])}catch(_){console.error("Error fetching classmates:",_),s(o("errors.failedToLoadClassmates")+": "+_.message)}finally{f(!1)}},R=v=>{m.includes(v)?h(m.filter(_=>_!==v)):h([...m,v])},$=async()=>{var v;if(!l.trim()){s(o("student.pleaseEnterTeamName"));return}if(m.length===0){s(o("student.pleaseSelectOneTeammate"));return}z(!0),s(null);try{const _=(v=n.currentUser)==null?void 0:v.teacher_id,D={name:l,teacher_id:_};D.creator_id=n.currentUser.id;const{data:F,error:G}=await N.from("teams").insert(D).select().single();if(G)throw G;const J=[{team_id:F.id,student_id:n.currentUser.id},...m.map(ie=>({team_id:F.id,student_id:ie}))],{error:X}=await N.from("team_members").insert(J);if(X)throw X;A(F),w(!0)}catch(_){console.error("Error creating team:",_),s(o("errors.failedToCreateTeam")+": "+_.message)}finally{z(!1)}},E=async()=>{if(!C||C.length!==6){s(o("student.enterValid6DigitPIN"));return}z(!0),s(null);try{const{data:v,error:_}=await N.from("quiz_sessions").select("*").eq("pin",C);if(_)throw _;if(!v||v.length===0){s(o("errors.invalidPinQuizNotFound")),z(!1);return}const D=v[0];if(D.status==="completed"){s(o("errors.quizAlreadyEnded")),z(!1);return}const{data:F,error:G}=await N.from("session_participants").insert({session_id:D.id,user_id:n.currentUser.id,team_id:O.id,is_team_entry:!0,score:0}).select().single();if(G)if(G.code==="23505")console.log("Team already joined this session, proceeding...");else throw new Error(`${o("errors.failedToJoinQuiz")}: ${G.message}`);r("student-quiz",D.id)}catch(v){s(o("errors.errorJoiningQuiz")+": "+v.message),z(!1)}};return S?e.jsx("div",{className:"bg-gradient-to-br from-blue-500 to-cyan-500 min-h-screen flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md",children:[e.jsxs("button",{onClick:a,className:"flex items-center gap-2 text-gray-600 hover:text-gray-800 mb-4",children:[e.jsx(We,{size:20}),o("student.backToDashboard")]}),e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"text-6xl mb-4",children:"✅"}),e.jsx("h1",{className:"text-3xl font-bold mb-2 text-green-600",children:o("student.teamCreated")}),e.jsx("p",{className:"text-xl font-semibold text-gray-800 mb-2",children:O==null?void 0:O.name}),e.jsxs("p",{className:"text-gray-600",children:[m.length+1," ",o("student.members")]})]}),e.jsxs("div",{className:"border-t pt-6",children:[e.jsx("h2",{className:"text-xl font-bold text-center mb-4",children:o("student.joinTeamQuiz")}),e.jsx("p",{className:"text-center text-gray-600 mb-4",children:o("student.enterPinFromTeacher")}),t&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:t}),e.jsx("input",{type:"text",placeholder:o("session.enterPin"),value:C,onChange:v=>Q(v.target.value),className:"w-full p-4 border-2 rounded-lg text-center text-2xl mb-4",maxLength:"6"}),e.jsx("button",{onClick:E,disabled:b,className:"w-full bg-blue-600 text-white p-4 rounded-lg hover:bg-blue-700 text-xl disabled:opacity-50 disabled:cursor-not-allowed",children:o(b?"student.joining":"student.joinAsTeam")})]})]})}):i?e.jsx("div",{className:"bg-gradient-to-br from-blue-500 to-cyan-500 min-h-screen flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-8 w-full max-w-2xl",children:[e.jsxs("button",{onClick:a,className:"flex items-center gap-2 text-gray-600 hover:text-gray-800 mb-4",children:[e.jsx(We,{size:20}),o("student.backToDashboard")]}),e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"text-4xl mb-3",children:"👥"}),e.jsx("h1",{className:"text-3xl font-bold mb-2",children:o("student.createTeam")}),e.jsx("p",{className:"text-gray-600",children:o("student.formTeamWithClassmates")})]}),t&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:t}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:[o("student.teamName")," *"]}),e.jsx("input",{type:"text",placeholder:o("student.enterYourTeamName"),value:l,onChange:v=>d(v.target.value),className:"w-full p-3 border-2 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:[o("student.selectTeammates")," * (",o("student.chooseAtLeastOne"),")"]}),k?e.jsx("div",{className:"text-center py-8 text-gray-500",children:o("student.loadingClassmates")}):u.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:o("student.noOtherStudentsInClass")}):e.jsx("div",{className:"border-2 rounded-lg max-h-64 overflow-y-auto",children:u.map(v=>e.jsxs("div",{onClick:()=>R(v.id),className:`p-3 cursor-pointer hover:bg-gray-50 border-b last:border-b-0 flex items-center justify-between ${m.includes(v.id)?"bg-blue-50":""}`,children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:v.name}),e.jsx("div",{className:"text-sm text-gray-500",children:v.email})]}),m.includes(v.id)&&e.jsx(wt,{size:20,className:"text-blue-600"})]},v.id))})]}),m.length>0&&e.jsxs("div",{className:"mb-4 text-sm text-gray-600",children:[e.jsx(Oe,{size:16,className:"inline mr-1"}),m.length+1," ",o("student.members")," (",o("student.includingYou"),")"]}),e.jsx("button",{onClick:$,disabled:b||k,className:"w-full bg-blue-600 text-white p-4 rounded-lg hover:bg-blue-700 text-xl font-semibold disabled:opacity-50 disabled:cursor-not-allowed",children:o(b?"student.creatingTeam":"student.createTeam")})]})}):e.jsx("div",{className:"bg-gradient-to-br from-blue-500 to-cyan-500 min-h-screen flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-8 w-full max-w-xl text-center",children:[e.jsxs("button",{onClick:a,className:"flex items-center gap-2 text-gray-600 hover:text-gray-800 mb-6",children:[e.jsx(We,{size:20}),o("student.backToDashboard")]}),e.jsx("div",{className:"text-4xl mb-3",children:"⏳"}),e.jsx("h1",{className:"text-3xl font-bold mb-2",children:o("student.awaitingApproval")}),e.jsx("p",{className:"text-gray-600",children:o("student.teamToolsUnlockMessage")})]})})}function Rr({appState:n,onBack:r}){const{t}=qe(),[s,a]=c.useState(!0),[i,o]=c.useState([]),[l,d]=c.useState({totalQuizzes:0,averageScore:0,averageAccuracy:0,totalPoints:0});c.useEffect(()=>{u()},[n.currentUser]);const u=async()=>{try{a(!0);const{data:m,error:h}=await N.from("session_participants").select(`
          id,
          score,
          joined_at,
          session_id,
          quiz_sessions (
            id,
            pin,
            created_at,
            quiz_id,
            quizzes (
              id,
              title
            )
          )
        `).eq("user_id",n.currentUser.id).order("joined_at",{ascending:!1});if(h)throw h;const z=(await Promise.all(m.map(async k=>{var C,Q;const{data:f,error:S}=await N.from("quiz_answers").select("*").eq("participant_id",k.id);if(S)return console.error("Error fetching answers:",S),null;const w=f.length,O=f.filter(M=>M.is_correct).length,A=w>0?O/w*100:0;return{sessionId:k.session_id,participantId:k.id,quizTitle:((Q=(C=k.quiz_sessions)==null?void 0:C.quizzes)==null?void 0:Q.title)||"Unknown Quiz",score:k.score,dateTaken:k.joined_at,totalQuestions:w,correctAnswers:O,accuracy:A,answers:f}}))).filter(k=>k!==null);if(o(z),z.length>0){const k=z.reduce((w,O)=>w+O.score,0),f=k/z.length,S=z.reduce((w,O)=>w+O.accuracy,0)/z.length;d({totalQuizzes:z.length,averageScore:Math.round(f),averageAccuracy:Math.round(S),totalPoints:k})}a(!1)}catch(m){console.error("Error fetching results:",m),a(!1)}},g=m=>new Date(m).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return s?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-500 to-cyan-500 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white/95 backdrop-blur-sm rounded-2xl shadow-2xl p-12 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-blue-700 mx-auto mb-4"}),e.jsx("p",{className:"text-xl text-gray-800",children:t("common.loading")})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-500 to-cyan-500 p-4 md:p-8",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs("div",{className:"bg-white/95 backdrop-blur-sm rounded-2xl shadow-2xl p-4 md:p-6 mb-4 md:mb-6",children:[e.jsxs("button",{onClick:r,className:"flex items-center gap-2 text-blue-700 hover:text-blue-800 font-semibold mb-3 md:mb-4 transition-colors text-sm md:text-base",children:[e.jsx(We,{size:20}),t("student.backToDashboard")]}),e.jsxs("div",{className:"flex items-center gap-2 md:gap-3",children:[e.jsx($e,{className:"text-yellow-500",size:32}),e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-gray-800",children:t("student.viewMyResults")})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 md:gap-4 mb-4 md:mb-6",children:[e.jsx("div",{className:"bg-white/95 backdrop-blur-sm rounded-xl shadow-lg p-4 md:p-6",children:e.jsxs("div",{className:"flex items-center gap-2 md:gap-3",children:[e.jsx("div",{className:"bg-blue-100 rounded-full p-2 md:p-3",children:e.jsx(jt,{className:"text-blue-700",size:20})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs md:text-sm text-gray-600",children:t("studentReport.totalQuizzes")}),e.jsx("p",{className:"text-2xl md:text-3xl font-bold text-blue-700",children:l.totalQuizzes})]})]})}),e.jsx("div",{className:"bg-white/95 backdrop-blur-sm rounded-xl shadow-lg p-4 md:p-6",children:e.jsxs("div",{className:"flex items-center gap-2 md:gap-3",children:[e.jsx("div",{className:"bg-green-100 rounded-full p-2 md:p-3",children:e.jsx(_s,{className:"text-green-700",size:20})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs md:text-sm text-gray-600",children:t("studentReport.averageScore")}),e.jsx("p",{className:"text-2xl md:text-3xl font-bold text-green-700",children:l.averageScore})]})]})}),e.jsx("div",{className:"bg-white/95 backdrop-blur-sm rounded-xl shadow-lg p-4 md:p-6",children:e.jsxs("div",{className:"flex items-center gap-2 md:gap-3",children:[e.jsx("div",{className:"bg-purple-100 rounded-full p-2 md:p-3",children:e.jsx(Cs,{className:"text-purple-700",size:20})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs md:text-sm text-gray-600",children:t("studentReport.averageAccuracy")}),e.jsxs("p",{className:"text-2xl md:text-3xl font-bold text-purple-700",children:[l.averageAccuracy,"%"]})]})]})}),e.jsx("div",{className:"bg-white/95 backdrop-blur-sm rounded-xl shadow-lg p-4 md:p-6",children:e.jsxs("div",{className:"flex items-center gap-2 md:gap-3",children:[e.jsx("div",{className:"bg-yellow-100 rounded-full p-2 md:p-3",children:e.jsx(it,{className:"text-yellow-700",size:20})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs md:text-sm text-gray-600",children:t("quiz.totalPoints")}),e.jsx("p",{className:"text-2xl md:text-3xl font-bold text-yellow-700",children:l.totalPoints})]})]})})]}),e.jsxs("div",{className:"bg-white/95 backdrop-blur-sm rounded-2xl shadow-2xl p-4 md:p-6",children:[e.jsxs("h2",{className:"text-xl md:text-2xl font-bold text-gray-800 mb-4 md:mb-6 flex items-center gap-2",children:[e.jsx(ws,{size:24,className:"text-blue-700"}),t("studentReport.quizHistory")]}),i.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx($e,{className:"mx-auto mb-4 text-gray-400",size:64}),e.jsx("p",{className:"text-xl text-gray-600 mb-2",children:t("common.noDataAvailable")}),e.jsx("p",{className:"text-gray-500",children:t("student.enterPinToJoinIndividually")})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden md:block overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b-2 border-gray-200",children:[e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-700",children:t("studentReport.quizTitle")}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-700",children:t("studentReport.dateTaken")}),e.jsx("th",{className:"text-center py-3 px-4 font-semibold text-gray-700",children:t("quiz.questions")}),e.jsx("th",{className:"text-center py-3 px-4 font-semibold text-gray-700",children:t("studentReport.score")}),e.jsx("th",{className:"text-center py-3 px-4 font-semibold text-gray-700",children:t("studentReport.accuracy")})]})}),e.jsx("tbody",{children:i.map((m,h)=>e.jsxs("tr",{className:"border-b border-gray-100 hover:bg-blue-50 transition-colors",children:[e.jsx("td",{className:"py-4 px-4",children:e.jsx("div",{className:"font-medium text-gray-800",children:m.quizTitle})}),e.jsx("td",{className:"py-4 px-4 text-gray-600",children:g(m.dateTaken)}),e.jsx("td",{className:"py-4 px-4 text-center",children:e.jsxs("span",{className:"inline-block bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-semibold",children:[m.correctAnswers,"/",m.totalQuestions]})}),e.jsx("td",{className:"py-4 px-4 text-center",children:e.jsx("span",{className:"inline-block bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-bold",children:m.score})}),e.jsx("td",{className:"py-4 px-4 text-center",children:e.jsxs("span",{className:`inline-block px-3 py-1 rounded-full text-sm font-semibold ${m.accuracy>=80?"bg-green-100 text-green-800":m.accuracy>=60?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:[Math.round(m.accuracy),"%"]})})]},h))})]})}),e.jsx("div",{className:"md:hidden space-y-4",children:i.map((m,h)=>e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl p-4 border-l-4 border-blue-500 shadow-md",children:[e.jsx("div",{className:"font-bold text-lg text-gray-800 mb-3",children:m.quizTitle}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 text-xs mb-1",children:t("studentReport.dateTaken")}),e.jsx("p",{className:"font-medium text-gray-800",children:g(m.dateTaken)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 text-xs mb-1",children:t("quiz.questions")}),e.jsxs("span",{className:"inline-block bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-semibold",children:[m.correctAnswers,"/",m.totalQuestions]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 text-xs mb-1",children:t("studentReport.score")}),e.jsx("span",{className:"inline-block bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-bold",children:m.score})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 text-xs mb-1",children:t("studentReport.accuracy")}),e.jsxs("span",{className:`inline-block px-3 py-1 rounded-full text-sm font-semibold ${m.accuracy>=80?"bg-green-100 text-green-800":m.accuracy>=60?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:[Math.round(m.accuracy),"%"]})]})]})]},h))})]})]}),i.length>0&&e.jsxs("div",{className:"mt-4 md:mt-6 bg-gradient-to-r from-purple-500 to-pink-500 rounded-2xl shadow-2xl p-6 md:p-8 text-white text-center",children:[e.jsx("h3",{className:"text-xl md:text-2xl font-bold mb-2",children:t("student.greatJob")}),e.jsx("p",{className:"text-base md:text-lg opacity-90",children:l.averageAccuracy>=80?"You're doing excellent! Keep up the great work!":l.averageAccuracy>=60?"You're making good progress! Keep practicing!":"Keep learning and improving! You're on the right track!"})]})]})})}function $r({appState:n,setAppState:r,setView:t,error:s,setError:a}){var m,h;const{t:i}=qe(),[o,l]=c.useState("dashboard"),d=(m=n.currentUser)==null?void 0:m.approved,u=()=>{l("dashboard"),a(null)},g=(b,z)=>{b==="student-dashboard"&&u(),t(b,z)};return e.jsxs("div",{className:"flex min-h-screen bg-gray-50",children:[e.jsx(Ee,{currentView:"student-dashboard",setView:g,appState:n}),e.jsxs("div",{className:"flex-1 md:ml-64 pt-16 md:pt-0",children:[o==="dashboard"&&e.jsx("div",{className:"bg-gradient-to-br from-blue-500 to-cyan-500 min-h-screen flex items-center justify-center p-4 md:p-8",children:e.jsxs("div",{className:"max-w-6xl w-full",children:[e.jsx("h1",{className:"text-2xl md:text-4xl font-bold text-white text-center mb-4 md:mb-6",children:i("student.welcome",{name:(h=n.currentUser)==null?void 0:h.name})}),!d&&e.jsxs("div",{className:"mb-10 mx-auto max-w-2xl rounded-2xl bg-white/15 border border-white/30 backdrop-blur-sm p-5 text-center text-white",children:[e.jsxs("div",{className:"flex items-center justify-center gap-3 text-lg font-semibold",children:[e.jsx(Pr,{size:24}),i("student.awaitingTeacherApproval")]}),e.jsx("p",{className:"mt-2 text-sm text-white/80",children:i("student.approvalMessage")})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 md:gap-8",children:[e.jsxs("div",{onClick:d?()=>l("join-classic"):void 0,className:`bg-white rounded-2xl shadow-2xl p-8 transition-transform duration-200 flex flex-col items-center text-center ${d?"cursor-pointer hover:scale-105":"cursor-not-allowed opacity-60"}`,children:[e.jsx("div",{className:"bg-blue-50 rounded-full p-6 mb-4",children:e.jsx(js,{size:48,className:"text-blue-700"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-3",children:i("student.joinQuiz")}),e.jsx("p",{className:"text-gray-600 mb-4",children:i(d?"student.enterPinToJoinIndividually":"student.disabledUntilApproved")}),e.jsx("div",{className:"mt-auto",children:e.jsx("span",{className:`inline-block px-6 py-2 rounded-lg font-semibold ${d?"bg-blue-700 text-white hover:bg-blue-800":"bg-gray-300 text-gray-600"}`,children:i("actions.start")})})]}),e.jsxs("div",{onClick:d?()=>l("create-team"):void 0,className:`bg-white rounded-2xl shadow-2xl p-8 transition-transform duration-200 flex flex-col items-center text-center ${d?"cursor-pointer hover:scale-105":"cursor-not-allowed opacity-60"}`,children:[e.jsx("div",{className:"bg-blue-100 rounded-full p-6 mb-4",children:e.jsx(Oe,{size:48,className:"text-blue-600"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-3",children:i("student.createTeam")}),e.jsx("p",{className:"text-gray-600 mb-4",children:i(d?"student.formTeamWithClassmates":"student.disabledUntilApproved")}),e.jsx("div",{className:"mt-auto",children:e.jsx("span",{className:`inline-block px-6 py-2 rounded-lg font-semibold ${d?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-300 text-gray-600"}`,children:i("common.create")})})]}),e.jsxs("div",{onClick:()=>l("results"),className:"bg-white rounded-2xl shadow-2xl p-8 cursor-pointer hover:scale-105 transition-transform duration-200 flex flex-col items-center text-center",children:[e.jsx("div",{className:"bg-green-100 rounded-full p-6 mb-4",children:e.jsx($e,{size:48,className:"text-green-600"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-3",children:i("student.viewMyResults")}),e.jsx("p",{className:"text-gray-600 mb-4",children:i("student.seeQuizHistoryAndScores")}),e.jsx("div",{className:"mt-auto",children:e.jsx("span",{className:"inline-block bg-green-600 text-white px-6 py-2 rounded-lg font-semibold hover:bg-green-700",children:i("common.view")})})]})]})]})}),o==="join-classic"&&e.jsx(Ir,{appState:n,setView:t,error:s,setError:a,onBack:u,isApproved:d}),o==="create-team"&&e.jsx(Mr,{appState:n,setView:t,error:s,setError:a,onBack:u,isApproved:d}),o==="results"&&e.jsx(Rr,{appState:n,onBack:u})]})]})}function Ur({appState:n,setAppState:r,setView:t}){const{t:s}=qe(),a=n.currentUser,[i,o]=c.useState(!1),[l,d]=c.useState(!1);c.useEffect(()=>{(async()=>{if(a&&a.role==="teacher"&&!a.teacher_code){d(!0);try{let h,b=!0;for(;b;){h=Dt();const{data:k}=await N.from("users").select("id").eq("teacher_code",h).maybeSingle();b=!!k}const{error:z}=await N.from("users").update({teacher_code:h}).eq("id",a.id);z||r({...n,currentUser:{...a,teacher_code:h}})}catch(h){console.error("Error generating teacher code:",h)}finally{d(!1)}}})()},[a==null?void 0:a.id]);const u=m=>{m==="Manage Quizzes"&&t("manage-quizzes"),m==="Manage Students"&&t("manage-students"),m==="Reports"&&t("reports")},g=()=>{if(a!=null&&a.teacher_code){const m=Gt(a.teacher_code);console.log("=== COPYING TEACHER CODE ==="),console.log("Raw code from database:",a.teacher_code),console.log("Formatted code (displayed):",m),console.log("Code being copied to clipboard:",m),navigator.clipboard.writeText(m),o(!0),setTimeout(()=>o(!1),2e3)}};return e.jsxs("div",{className:"flex min-h-screen bg-gray-50",children:[e.jsx(Ee,{currentView:"teacher-dashboard",setView:t,appState:n}),e.jsxs("div",{className:"flex-1 md:ml-64 pt-16 md:pt-0",children:[e.jsx("nav",{className:"bg-white shadow-sm border-b border-gray-200 px-6 py-4",children:e.jsx("h1",{className:"text-2xl font-bold",style:{color:"#2c5aa0"},children:s("teacher.teacherDashboard")})}),e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsx("h2",{className:"text-3xl font-bold mb-6",style:{color:"#1f3a52"},children:s("teacher.teacherDashboard")}),l?e.jsx("div",{className:"text-white p-6 rounded-xl shadow-lg mb-6",style:{background:"linear-gradient(to right, #2c5aa0, #4db8d8)"},children:e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("p",{className:"text-lg",children:s("teacher.generatingTeacherCode")})})}):a!=null&&a.teacher_code?e.jsx("div",{className:"text-white p-6 rounded-xl shadow-lg mb-6",style:{background:"linear-gradient(to right, #2c5aa0, #4db8d8)"},children:e.jsx("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between",children:e.jsxs("div",{className:"mb-4 md:mb-0",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:s("teacher.yourTeacherInvitationCode")}),e.jsx("p",{className:"text-sm mb-3",style:{color:"rgba(255, 255, 255, 0.9)"},children:s("teacher.shareCodeWithStudents")}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-white px-6 py-3 rounded-lg font-mono text-2xl font-bold tracking-wider",style:{color:"#2c5aa0"},children:Gt(a.teacher_code)}),e.jsx("button",{onClick:g,className:"bg-white/20 hover:bg-white/30 text-white px-4 py-3 rounded-lg transition flex items-center gap-2 font-medium",children:i?e.jsxs(e.Fragment,{children:[e.jsx(wt,{size:20}),s("teacher.copied")]}):e.jsxs(e.Fragment,{children:[e.jsx(ot,{size:20}),s("teacher.copyCode")]})})]})]})})}):null,e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{onClick:()=>u("Manage Quizzes"),className:"cursor-pointer bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition",children:[e.jsx(js,{className:"mb-4",size:40,style:{color:"#2c5aa0"}}),e.jsx("h3",{className:"text-xl font-bold mb-2",style:{color:"#1f3a52"},children:s("nav.manageQuizzes")}),e.jsx("p",{className:"text-gray-600",children:s("teacher.manageQuizzesDescription")})]}),e.jsxs("div",{onClick:()=>u("Manage Students"),className:"cursor-pointer bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition",children:[e.jsx(Oe,{className:"mb-4",size:40,style:{color:"#4db8d8"}}),e.jsx("h3",{className:"text-xl font-bold mb-2",style:{color:"#1f3a52"},children:s("teacher.manageStudents")}),e.jsx("p",{className:"text-gray-600",children:s("teacher.manageStudentsDescription")})]}),e.jsxs("div",{onClick:()=>u("Reports"),className:"cursor-pointer bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition",children:[e.jsx(jt,{className:"mb-4",size:40,style:{color:"#4a7c7e"}}),e.jsx("h3",{className:"text-xl font-bold mb-2",style:{color:"#1f3a52"},children:s("nav.reports")}),e.jsx("p",{className:"text-gray-600",children:s("teacher.reportsDescription")})]})]})]})]})]})}const Hr=(n,r=!0)=>{c.useEffect(()=>{if(!r||!n.current)return;const t=n.current,s=t.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),a=s[0],i=s[s.length-1];a==null||a.focus();const o=l=>{l.key==="Tab"&&(l.shiftKey?document.activeElement===a&&(l.preventDefault(),i==null||i.focus()):document.activeElement===i&&(l.preventDefault(),a==null||a.focus()))};return t.addEventListener("keydown",o),()=>t.removeEventListener("keydown",o)},[n,r])};function Ie({isOpen:n,title:r,message:t,onClose:s,buttonText:a="OK",type:i="info"}){const o=c.useRef(null);if(Hr(o,n),c.useEffect(()=>(n?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[n]),c.useEffect(()=>{const u=g=>{g.key==="Escape"&&n&&s()};return document.addEventListener("keydown",u),()=>document.removeEventListener("keydown",u)},[n,s]),!n)return null;const l={info:"text-blue-600",success:"text-green-600",error:"text-red-600",warning:"text-orange-600"},d={info:"bg-gradient-to-r from-blue-600 to-cyan-500 hover:from-blue-700 hover:to-cyan-600",success:"bg-green-600 hover:bg-green-700",error:"bg-red-600 hover:bg-red-700",warning:"bg-orange-600 hover:bg-orange-700"};return e.jsxs("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center p-4 animate-fadeIn",onClick:s,children:[e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50"}),e.jsxs("div",{ref:o,className:"relative bg-white rounded-lg shadow-2xl max-w-md w-full animate-scaleIn",onClick:u=>u.stopPropagation(),role:"dialog","aria-modal":"true","aria-labelledby":"alert-modal-title","aria-describedby":"alert-modal-description",children:[e.jsx("div",{className:"p-6 pb-4",children:e.jsx("h3",{id:"alert-modal-title",className:`text-xl font-semibold text-center ${l[i]}`,children:r})}),e.jsx("div",{className:"px-6 pb-6",children:e.jsx("p",{id:"alert-modal-description",className:"text-gray-600 whitespace-pre-line",children:t})}),e.jsx("div",{className:"flex justify-end px-6 pb-6",children:e.jsx("button",{onClick:s,className:`px-4 py-2 rounded-lg font-medium text-white transition-colors ${d[i]}`,children:a})})]})]})}function Br({setView:n,appState:r}){const[t,s]=c.useState([]),[a,i]=c.useState(!0),[o,l]=c.useState(""),[d,u]=c.useState(""),[g,m]=c.useState("all"),[h,b]=c.useState(!1),[z,k]=c.useState(!1),[f,S]=c.useState(!1),[w,O]=c.useState(null),[A,C]=c.useState({isOpen:!1,title:"",message:"",type:"info"}),[Q,M]=c.useState({isOpen:!1,title:"",message:"",onConfirm:null}),[R,$]=c.useState({name:"",email:"",password:"",role:"student",student_id:""}),[E,v]=c.useState({name:"",email:"",role:"",student_id:"",approved:!1,verified:!1}),[_,D]=c.useState({newPassword:"",confirmPassword:""});c.useEffect(()=>{F(),(async()=>{const{data:{user:Y}}=await N.auth.getUser();if(Y){const{data:oe}=await N.from("users").select("role, email, id").eq("id",Y.id).single();console.log("Current logged in user:",oe),console.log("Auth UID:",Y.id)}})()},[]);const F=async()=>{i(!0),l("");try{const{data:q,error:Y}=await N.from("users").select("*").order("created_at",{ascending:!1});Y?(console.error("Error fetching users:",Y.message),l("Failed to load users")):s(q)}catch(q){console.error("Unexpected error:",q),l("Something went wrong.")}finally{i(!1)}},G=async q=>{if(q.preventDefault(),R.password!==R.confirmPassword){C({isOpen:!0,title:"Password Mismatch",message:"Passwords do not match",type:"error"});return}try{const{data:Y,error:oe}=await N.auth.signUp({email:R.email,password:R.password,options:{data:{name:R.name,role:R.role}}});if(oe)throw oe;const{error:re}=await N.from("users").insert([{id:Y.user.id,name:R.name,email:R.email,role:R.role,student_id:R.student_id||null,verified:!0,approved:!0}]);if(re)throw re;C({isOpen:!0,title:"Success",message:"User created successfully!",type:"success"}),b(!1),$({name:"",email:"",password:"",confirmPassword:"",role:"student",student_id:""}),F()}catch(Y){C({isOpen:!0,title:"Error",message:"Error creating user: "+Y.message,type:"error"})}},J=async q=>{q.preventDefault();try{console.log("Attempting to update user:",w.id),console.log("Update data:",{name:E.name,email:E.email,role:E.role,student_id:E.student_id||null,approved:E.approved,verified:E.verified});const{data:Y,error:oe,count:re}=await N.from("users").update({name:E.name,email:E.email,role:E.role,student_id:E.student_id||null,approved:E.approved,verified:E.verified}).eq("id",w.id).select();if(console.log("Update result:",{data:Y,error:oe,count:re}),oe)throw console.error("Update error:",oe),oe;if(!Y||Y.length===0)throw new Error("No rows were updated. This might be a permissions issue. Check that your role is 'superadmin' and RLS policies are applied.");C({isOpen:!0,title:"Success",message:"User updated successfully!",type:"success"}),k(!1),O(null),F()}catch(Y){console.error("Error in handleEditUser:",Y),C({isOpen:!0,title:"Error",message:"Error updating user: "+Y.message,type:"error"})}},X=(q,Y)=>{M({isOpen:!0,title:"Delete User",message:`Are you sure you want to delete user: ${Y}?

This will delete:
- User account
- All their quizzes and questions
- All quiz sessions
- All participation records

This action cannot be undone!`,onConfirm:async()=>{M({...Q,isOpen:!1});try{const{error:oe}=await N.from("users").delete().eq("id",q);if(oe)throw oe;C({isOpen:!0,title:"Success",message:"User deleted from database. Note: Auth account still exists.",type:"success"}),F()}catch(oe){C({isOpen:!0,title:"Error",message:"Error deleting user: "+oe.message,type:"error"})}}})},ie=async q=>{if(q.preventDefault(),_.newPassword!==_.confirmPassword){C({isOpen:!0,title:"Password Mismatch",message:"Passwords do not match",type:"error"});return}C({isOpen:!0,title:"Password Reset Info",message:`Password reset requires Supabase Admin API or email reset link.

To reset password:
1. Go to Supabase Dashboard
2. Authentication > Users
3. Click user
4. Send password reset email`,type:"info"}),S(!1)},T=q=>{O(q),v({name:q.name||"",email:q.email||"",role:q.role||"",student_id:q.student_id||"",approved:q.approved||!1,verified:q.verified||!1}),k(!0)},B=q=>{O(q),D({newPassword:"",confirmPassword:""}),S(!0)},se=t.filter(q=>{var re,ge;const Y=((re=q.name)==null?void 0:re.toLowerCase().includes(d.toLowerCase()))||((ge=q.email)==null?void 0:ge.toLowerCase().includes(d.toLowerCase())),oe=g==="all"||q.role===g;return Y&&oe}),de={total:t.length,teachers:t.filter(q=>q.role==="teacher").length,students:t.filter(q=>q.role==="student").length,admins:t.filter(q=>q.role==="superadmin").length,pending:t.filter(q=>!q.approved||!q.verified).length};return e.jsxs("div",{className:"flex min-h-screen bg-gray-50",children:[e.jsx(Ee,{currentView:"superadmin-dashboard",setView:n,appState:r}),e.jsxs("div",{className:"flex-1 md:ml-64 pt-16 md:pt-0",children:[e.jsx("nav",{className:"bg-white shadow-sm border-b border-gray-200 px-6 py-4",children:e.jsx("h1",{className:"text-2xl font-bold text-blue-700",children:"Super Admin Dashboard"})}),e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4 mb-6",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-md p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 text-sm",children:"Total Users"}),e.jsx("p",{className:"text-3xl font-bold text-blue-700",children:de.total})]}),e.jsx(Oe,{className:"text-blue-700",size:40})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-md p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 text-sm",children:"Teachers"}),e.jsx("p",{className:"text-3xl font-bold text-blue-600",children:de.teachers})]}),e.jsx(Tt,{className:"text-blue-600",size:40})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-md p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 text-sm",children:"Students"}),e.jsx("p",{className:"text-3xl font-bold text-green-600",children:de.students})]}),e.jsx(Oe,{className:"text-green-600",size:40})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-md p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 text-sm",children:"Admins"}),e.jsx("p",{className:"text-3xl font-bold text-orange-600",children:de.admins})]}),e.jsx(Tt,{className:"text-orange-600",size:40})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-md p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 text-sm",children:"Pending"}),e.jsx("p",{className:"text-3xl font-bold text-red-600",children:de.pending})]}),e.jsx(Ar,{className:"text-red-600",size:40})]})})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-center justify-between",children:[e.jsxs("div",{className:"flex gap-4 flex-1",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Ge,{className:"absolute left-3 top-3 text-gray-400",size:20}),e.jsx("input",{type:"text",placeholder:"Search by name or email...",value:d,onChange:q=>u(q.target.value),className:"w-full pl-10 pr-4 py-2 border rounded-lg focus:ring-2 focus:ring-cyan-500"})]}),e.jsxs("select",{value:g,onChange:q=>m(q.target.value),className:"border rounded-lg px-4 py-2 focus:ring-2 focus:ring-cyan-500",children:[e.jsx("option",{value:"all",children:"All Roles"}),e.jsx("option",{value:"student",children:"Students"}),e.jsx("option",{value:"teacher",children:"Teachers"}),e.jsx("option",{value:"superadmin",children:"Admins"})]})]}),e.jsxs("button",{onClick:()=>b(!0),className:"bg-blue-700 text-white px-6 py-2 rounded-lg hover:bg-blue-800 flex items-center gap-2",children:[e.jsx(ks,{size:20}),"Create User"]})]})}),a&&e.jsx("p",{className:"text-center text-gray-600",children:"Loading users..."}),o&&e.jsx("p",{className:"text-center text-red-500",children:o}),!a&&!o&&e.jsx("div",{className:"bg-white shadow-lg rounded-lg overflow-hidden",children:e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-4 text-left text-sm font-semibold text-gray-700",children:"Name"}),e.jsx("th",{className:"p-4 text-left text-sm font-semibold text-gray-700",children:"Email"}),e.jsx("th",{className:"p-4 text-left text-sm font-semibold text-gray-700",children:"Role"}),e.jsx("th",{className:"p-4 text-left text-sm font-semibold text-gray-700",children:"Student ID"}),e.jsx("th",{className:"p-4 text-left text-sm font-semibold text-gray-700",children:"Status"}),e.jsx("th",{className:"p-4 text-left text-sm font-semibold text-gray-700",children:"Created"}),e.jsx("th",{className:"p-4 text-left text-sm font-semibold text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:se.map(q=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"p-4",children:q.name||"N/A"}),e.jsx("td",{className:"p-4",children:q.email}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold ${q.role==="teacher"?"bg-blue-100 text-blue-800":q.role==="student"?"bg-green-100 text-green-800":"bg-orange-100 text-orange-800"}`,children:q.role})}),e.jsx("td",{className:"p-4",children:q.student_id||"N/A"}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex gap-2",children:[q.verified?e.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-800 text-xs rounded",children:"Verified"}):e.jsx("span",{className:"px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded",children:"Unverified"}),q.approved?e.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-800 text-xs rounded",children:"Approved"}):e.jsx("span",{className:"px-2 py-1 bg-red-100 text-red-800 text-xs rounded",children:"Pending"})]})}),e.jsx("td",{className:"p-4 text-sm text-gray-600",children:q.created_at?new Date(q.created_at).toLocaleDateString():"N/A"}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>T(q),className:"p-2 text-blue-600 hover:bg-blue-50 rounded",title:"Edit User",children:e.jsx(rt,{size:18})}),e.jsx("button",{onClick:()=>B(q),className:"p-2 text-blue-700 hover:bg-blue-50 rounded",title:"Reset Password",children:e.jsx(Cr,{size:18})}),e.jsx("button",{onClick:()=>X(q.id,q.email),className:"p-2 text-red-600 hover:bg-red-50 rounded",title:"Delete User",children:e.jsx(He,{size:18})})]})})]},q.id))})]}),se.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No users found matching your search criteria."})]})}),h&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-8 max-w-md w-full",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Create New User"}),e.jsxs("form",{onSubmit:G,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Name"}),e.jsx("input",{type:"text",required:!0,value:R.name,onChange:q=>$({...R,name:q.target.value}),className:"w-full border rounded px-3 py-2"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Email"}),e.jsx("input",{type:"email",required:!0,value:R.email,onChange:q=>$({...R,email:q.target.value}),className:"w-full border rounded px-3 py-2"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Password"}),e.jsx("input",{type:"password",required:!0,minLength:6,value:R.password,onChange:q=>$({...R,password:q.target.value}),className:"w-full border rounded px-3 py-2"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Confirm Password"}),e.jsx("input",{type:"password",required:!0,minLength:6,value:R.confirmPassword,onChange:q=>$({...R,confirmPassword:q.target.value}),className:"w-full border rounded px-3 py-2"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Role"}),e.jsxs("select",{value:R.role,onChange:q=>$({...R,role:q.target.value}),className:"w-full border rounded px-3 py-2",children:[e.jsx("option",{value:"student",children:"Student"}),e.jsx("option",{value:"teacher",children:"Teacher"}),e.jsx("option",{value:"superadmin",children:"Super Admin"})]})]}),R.role==="student"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Student ID (Optional)"}),e.jsx("input",{type:"text",value:R.student_id,onChange:q=>$({...R,student_id:q.target.value}),className:"w-full border rounded px-3 py-2"})]}),e.jsxs("div",{className:"flex gap-2 mt-6",children:[e.jsx("button",{type:"submit",className:"flex-1 bg-blue-700 text-white py-2 rounded hover:bg-blue-800",children:"Create User"}),e.jsx("button",{type:"button",onClick:()=>b(!1),className:"flex-1 bg-gray-300 text-gray-700 py-2 rounded hover:bg-gray-400",children:"Cancel"})]})]})]})}),z&&w&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-8 max-w-md w-full",children:[e.jsxs("h2",{className:"text-2xl font-bold mb-6",children:["Edit User: ",w.email]}),e.jsxs("form",{onSubmit:J,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Name"}),e.jsx("input",{type:"text",required:!0,value:E.name,onChange:q=>v({...E,name:q.target.value}),className:"w-full border rounded px-3 py-2"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Email"}),e.jsx("input",{type:"email",required:!0,value:E.email,onChange:q=>v({...E,email:q.target.value}),className:"w-full border rounded px-3 py-2"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Role"}),e.jsxs("select",{value:E.role,onChange:q=>v({...E,role:q.target.value}),className:"w-full border rounded px-3 py-2",children:[e.jsx("option",{value:"student",children:"Student"}),e.jsx("option",{value:"teacher",children:"Teacher"}),e.jsx("option",{value:"superadmin",children:"Super Admin"})]})]}),E.role==="student"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Student ID"}),e.jsx("input",{type:"text",value:E.student_id,onChange:q=>v({...E,student_id:q.target.value}),className:"w-full border rounded px-3 py-2"})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:E.verified,onChange:q=>v({...E,verified:q.target.checked}),className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Verified"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:E.approved,onChange:q=>v({...E,approved:q.target.checked}),className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Approved"})]})]}),e.jsxs("div",{className:"flex gap-2 mt-6",children:[e.jsx("button",{type:"submit",className:"flex-1 bg-blue-600 text-white py-2 rounded hover:bg-blue-700",children:"Save Changes"}),e.jsx("button",{type:"button",onClick:()=>k(!1),className:"flex-1 bg-gray-300 text-gray-700 py-2 rounded hover:bg-gray-400",children:"Cancel"})]})]})]})}),f&&w&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-8 max-w-md w-full",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Reset Password"}),e.jsxs("p",{className:"text-gray-600 mb-6",children:["User: ",e.jsx("strong",{children:w.email})]}),e.jsxs("form",{onSubmit:ie,className:"space-y-4",children:[e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded p-4 mb-4",children:e.jsxs("p",{className:"text-sm text-yellow-800",children:[e.jsx("strong",{children:"Note:"})," Direct password changes require Supabase Admin API. The recommended method is to send a password reset email via Supabase Dashboard."]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"New Password"}),e.jsx("input",{type:"password",minLength:6,value:_.newPassword,onChange:q=>D({..._,newPassword:q.target.value}),className:"w-full border rounded px-3 py-2",disabled:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Confirm Password"}),e.jsx("input",{type:"password",minLength:6,value:_.confirmPassword,onChange:q=>D({..._,confirmPassword:q.target.value}),className:"w-full border rounded px-3 py-2",disabled:!0})]}),e.jsx("div",{className:"flex gap-2 mt-6",children:e.jsx("button",{type:"button",onClick:()=>S(!1),className:"w-full bg-gray-300 text-gray-700 py-2 rounded hover:bg-gray-400",children:"Close"})})]})]})}),e.jsx(Ie,{isOpen:A.isOpen,title:A.title,message:A.message,type:A.type,onClose:()=>C({...A,isOpen:!1})}),e.jsx(Le,{isOpen:Q.isOpen,title:Q.title,message:Q.message,onConfirm:Q.onConfirm,onCancel:()=>M({...Q,isOpen:!1}),confirmStyle:"danger"})]})]})]})}const Ot=async(n,r="quiz-images")=>{try{const t=n.name.split(".").pop(),a=`${`${Math.random().toString(36).substring(2)}_${Date.now()}.${t}`}`,{data:i,error:o}=await N.storage.from(r).upload(a,n);if(o)throw o;const{data:l}=N.storage.from(r).getPublicUrl(a);return l.publicUrl}catch(t){throw console.error("Error uploading image:",t),t}},Ps=async(n,r="quiz-videos")=>{try{const t=n.name.split(".").pop(),a=`${`${Math.random().toString(36).substring(2)}_${Date.now()}.${t}`}`,{data:i,error:o}=await N.storage.from(r).upload(a,n);if(o)throw o;const{data:l}=N.storage.from(r).getPublicUrl(a);return l.publicUrl}catch(t){throw console.error("Error uploading video:",t),t}},Ts=async(n,r="quiz-gifs")=>{try{const t=n.name.split(".").pop(),a=`${`${Math.random().toString(36).substring(2)}_${Date.now()}.${t}`}`,{data:i,error:o}=await N.storage.from(r).upload(a,n);if(o)throw o;const{data:l}=N.storage.from(r).getPublicUrl(a);return l.publicUrl}catch(t){throw console.error("Error uploading GIF:",t),t}};function Qs({selectedThemeId:n,onThemeSelect:r,customBackgroundUrl:t,onCustomBackgroundChange:s}){var S;const[a,i]=c.useState([]),[o,l]=c.useState(!0),[d,u]=c.useState(!1),[g,m]=c.useState(null),h=c.useRef(null);c.useEffect(()=>{b()},[]);const b=async()=>{try{const{data:w,error:O}=await N.from("themes").select("*").order("is_default",{ascending:!1}).order("name",{ascending:!0});if(O)throw O;const A=new Map;(w||[]).forEach(Q=>{var R;const M=[(R=Q.name)==null?void 0:R.trim().toLowerCase(),Q.background_image_url||"",Q.primary_color||"",Q.secondary_color||"",Q.text_color||""].join("|");A.has(M)||A.set(M,Q)});const C=Array.from(A.values());C.sort((Q,M)=>Q.is_default===M.is_default?(Q.name||"").localeCompare(M.name||"",void 0,{sensitivity:"base"}):Q.is_default?-1:1),i(C)}catch(w){console.error("Error fetching themes:",w)}finally{l(!1)}},z=w=>{s==null||s(null),r==null||r(w)},k=async w=>{var A;const O=(A=w.target.files)==null?void 0:A[0];if(O){u(!0),m(null);try{const C=await Ot(O);r==null||r(null),s==null||s(C)}catch(C){console.error("Failed to upload custom theme image:",C),m("Upload failed. Please try again or use a smaller image.")}finally{u(!1),h.current&&(h.current.value="")}}};if(o)return e.jsx("div",{className:"text-sm text-gray-500",children:"Loading themes..."});const f=!n&&!!t;return e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-3",children:[e.jsx(qr,{className:"inline mr-2",size:18}),"Quiz Theme"]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:[a.map(w=>{const O=n===w.id;return e.jsx("button",{type:"button",onClick:()=>z(w.id),className:`relative rounded-lg overflow-hidden border-2 transition-all ${O?"border-blue-700 ring-2 ring-cyan-300":"border-gray-200 hover:border-cyan-400"}`,style:{height:"120px"},children:e.jsxs("div",{className:"w-full h-full flex items-center justify-center relative",style:{background:w.background_image_url?`url(${w.background_image_url})`:`linear-gradient(135deg, ${w.primary_color}, ${w.secondary_color})`,backgroundSize:"cover",backgroundPosition:"center"},children:[e.jsx("div",{className:"absolute inset-0 bg-black/30"}),e.jsxs("div",{className:"relative z-10 text-center px-2",children:[e.jsx("p",{className:"text-sm font-semibold drop-shadow-lg",style:{color:w.text_color||"#FFFFFF"},children:w.name}),w.is_default&&e.jsx("span",{className:"text-xs bg-white/80 text-gray-800 px-2 py-0.5 rounded mt-1 inline-block",children:"Default"})]}),O&&e.jsx("div",{className:"absolute top-2 right-2 bg-blue-700 text-white rounded-full p-1",children:e.jsx(wt,{size:16})})]})},w.id)}),e.jsxs("label",{className:`relative rounded-lg border-2 border-dashed flex flex-col items-center justify-center text-center p-4 cursor-pointer transition-all ${d?"border-cyan-400 bg-blue-50 text-blue-700":"border-gray-300 hover:border-cyan-400 hover:bg-blue-50"}`,style:{minHeight:"120px"},children:[e.jsx("input",{ref:h,type:"file",accept:"image/*",className:"hidden",onChange:k}),e.jsx(Sr,{size:28,className:"mx-auto mb-2 text-blue-700"}),e.jsx("p",{className:"text-sm font-semibold text-gray-700",children:"Upload Custom"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:d?"Uploading...":"Use your own background"})]})]}),g&&e.jsx("p",{className:"mt-3 text-sm text-red-600",children:g}),t&&e.jsxs("div",{className:`mt-4 relative rounded-lg overflow-hidden border-2 transition-all ${f?"border-blue-700 ring-2 ring-cyan-300":"border-gray-200"}`,style:{height:"140px"},children:[e.jsx("button",{type:"button",onClick:()=>{r==null||r(null),s==null||s(t)},className:"absolute inset-0 w-full h-full",style:{backgroundImage:`url(${t})`,backgroundSize:"cover",backgroundPosition:"center"},"aria-label":"Custom theme preview"}),e.jsx("div",{className:"absolute inset-0 bg-black/30"}),e.jsxs("div",{className:"absolute bottom-3 left-3 right-3 flex items-center justify-between text-white",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold",children:"Custom Theme"}),e.jsx("p",{className:"text-xs text-white/80",children:"Using your uploaded image"})]}),e.jsxs("button",{type:"button",onClick:w=>{w.stopPropagation(),s==null||s(null);const O=a.find(A=>A.is_default)||a[0];O&&(r==null||r(O.id))},className:"inline-flex items-center gap-1 rounded-full bg-white/90 px-2 py-1 text-xs font-medium text-gray-700 hover:bg-white",children:[e.jsx(Te,{size:14}),"Remove"]})]})]}),n&&e.jsx("div",{className:"mt-3",children:e.jsxs("p",{className:"text-sm text-gray-600",children:["Selected theme:"," ",e.jsx("span",{className:"font-semibold",children:(S=a.find(w=>w.id===n))==null?void 0:S.name})]})}),f&&e.jsx("div",{className:"mt-3",children:e.jsxs("p",{className:"text-sm text-gray-600",children:["Selected theme: ",e.jsx("span",{className:"font-semibold",children:"Custom upload"})]})})]})}const Yt=()=>`temp-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,As=n=>n==="true_false"?[{text:"True",is_correct:!1},{text:"False",is_correct:!1}]:[{text:"",is_correct:!1},{text:"",is_correct:!1},{text:"",is_correct:!1},{text:"",is_correct:!1}],zt=(n="multiple_choice")=>({question_text:"",question_type:n,time_limit:30,points:100,image_url:"",video_url:"",gif_url:"",options:As(n)});function Vr({onQuizCreated:n,setView:r,appState:t}){const{t:s}=qe(),[a,i]=c.useState(""),[o,l]=c.useState(null),[d,u]=c.useState(null),[g,m]=c.useState(""),[h,b]=c.useState([]),[z,k]=c.useState([]),[f,S]=c.useState("settings"),[w,O]=c.useState(zt()),[A,C]=c.useState(null),[Q,M]=c.useState(null),[R,$]=c.useState(!1),[E,v]=c.useState(null),[_,D]=c.useState(null),[F,G]=c.useState(!1),[J,X]=c.useState(null),[ie,T]=c.useState(null),[B,se]=c.useState(!1),[de,q]=c.useState(!1),[Y,oe]=c.useState({isOpen:!1,title:"",message:"",type:"info"});c.useEffect(()=>{ge(),re()},[]);const re=async()=>{try{const{data:U,error:V}=await N.from("themes").select("id").eq("is_default",!0).single();!V&&U&&(l(U.id),u(null))}catch(U){console.error("Error fetching default theme:",U)}},ge=async()=>{try{const{data:U}=await N.auth.getUser();if(!(U!=null&&U.user))return;const{data:V,error:ee}=await N.from("quiz_folders").select("id, name, parent_folder_id").eq("created_by",U.user.id).order("name",{ascending:!0});if(ee)throw ee;b(V||[])}catch(U){console.error("Error fetching folders:",U.message)}},me=c.useMemo(()=>{const U=[],V=(ee=null,te=0)=>{h.filter(Ce=>Ce.parent_folder_id===ee).sort((Ce,x)=>Ce.name.localeCompare(x.name)).forEach(Ce=>{const x=te>0?`${"  ".repeat(te)}- `:"";U.push({id:Ce.id,label:`${x}${Ce.name}`}),V(Ce.id,te+1)})};return V(),U},[h]),pe=()=>{O(zt()),M(null),C(null),v(null)},we=()=>{S("questions"),O(zt()),M(null),C("add"),v(null)},xe=U=>{const V=z[U];S("questions"),M(U),O({question_text:V.question_text,question_type:V.question_type,time_limit:V.time_limit,points:V.points,image_url:V.image_url||"",video_url:V.video_url||"",gif_url:V.gif_url||"",options:V.options.map(ee=>({...ee}))}),C("edit"),v(null)},L=U=>{k(V=>{const ee=V[U],te={...ee,tempId:Yt(),question_text:`${ee.question_text} (Copy)`,options:ee.options.map(fe=>({...fe}))};return[...V,te]}),S("questions")},I=U=>{k(V=>V.filter((ee,te)=>te!==U)),!(A!=="edit"||Q===null)&&(Q===U?pe():Q>U&&M(V=>V!==null?V-1:V))},Z=(U,V,ee)=>{O(te=>{const fe=te.options.map((Ce,x)=>x!==U?{...Ce}:{...Ce,[V]:ee});return V==="is_correct"&&ee&&fe.forEach((Ce,x)=>{x!==U&&(Ce.is_correct=!1)}),{...te,options:fe}})},K=U=>{O(V=>({...V,question_type:U,options:As(U)}))},ne=async(U,V)=>{const ee=U.target.files[0];if(ee){$(!0);try{let te;V==="image"?te=await Ot(ee):V==="video"?te=await Ps(ee):V==="gif"&&(te=await Ts(ee)),te&&O(fe=>({...fe,[`${V}_url`]:te}))}catch(te){v("Error uploading file: "+te.message)}finally{$(!1)}}},ye=U=>{O(V=>({...V,[`${U}_url`]:""}))},le=()=>{var ee;if(!w.question_text.trim()){oe({isOpen:!0,title:s("common.error"),message:s("quiz.questionTextRequired")||"Question text is required.",type:"error"});return}if(!w.options.some(te=>te.is_correct)){oe({isOpen:!0,title:"Validation Error",message:s("quiz.markCorrectAnswer")||"Please mark at least one answer as correct.",type:"warning"});return}if(!A)return;const V={tempId:A==="edit"&&Q!==null?(ee=z[Q])==null?void 0:ee.tempId:Yt(),question_text:w.question_text.trim(),question_type:w.question_type,time_limit:w.time_limit,points:w.points,image_url:w.image_url||"",video_url:w.video_url||"",gif_url:w.gif_url||"",options:w.options.map(te=>({text:te.text.trim(),is_correct:te.is_correct}))};A==="edit"&&Q!==null?k(te=>{const fe=[...te];return fe[Q]=V,fe}):A==="add"&&k(te=>[...te,V]),pe()},ze=(U,V)=>{D(V),U.dataTransfer.effectAllowed="move"},_e=U=>{U.preventDefault(),U.dataTransfer.dropEffect="move"},je=(U,V)=>{U.preventDefault(),!(_===null||_===V)&&(k(ee=>{const te=[...ee],[fe]=te.splice(_,1);return te.splice(V,0,fe),te}),D(null))},be=async(U=!1)=>{const V=typeof U=="boolean"?U:!1;if(G(!0),X(null),T(null),!a.trim()){X("Quiz title is required."),S("settings"),G(!1);return}try{const{data:ee}=await N.auth.getUser();if(!(ee!=null&&ee.user)){X("You must be logged in to create a quiz."),G(!1);return}const{data:te,error:fe}=await N.from("quizzes").insert([{title:a.trim(),theme_id:d?null:o,background_image_url:d||null,folder_id:g||null,created_by:ee.user.id,randomize_questions:!1,randomize_answers:!1,is_template:B,is_public:de}]).select("id").single();if(fe)throw fe;if(z.length>0){const Ce=z.map((y,P)=>({quiz_id:te.id,question_text:y.question_text,question_type:y.question_type,time_limit:y.time_limit,points:y.points,options:y.options,image_url:y.image_url||null,video_url:y.video_url||null,gif_url:y.gif_url||null,order_index:P})),{error:x}=await N.from("questions").insert(Ce);if(x)throw x}if(V){n&&n(),r("manage-quizzes");return}T("Quiz created successfully!"),i(""),m(""),k([]),se(!1),q(!1),S("settings"),pe(),await re(),u(null),n&&n()}catch(ee){X(ee.message)}finally{G(!1)}},ke=c.useMemo(()=>z.reduce((U,V)=>U+(V.points||0),0),[z]),ve=(U=null)=>e.jsxs("div",{children:[U&&e.jsx("h3",{className:"text-xl font-bold mb-4",children:U}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:s("quiz.question")}),e.jsx("input",{type:"text",value:w.question_text,onChange:V=>O(ee=>({...ee,question_text:V.target.value})),className:"w-full border rounded px-3 py-2",placeholder:s("quiz.questionText")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:s("quiz.questionType")}),e.jsxs("select",{value:w.question_type,onChange:V=>K(V.target.value),className:"w-full border rounded px-3 py-2",children:[e.jsx("option",{value:"multiple_choice",children:s("quiz.multipleChoice")}),e.jsx("option",{value:"true_false",children:s("quiz.trueFalse")})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-2",children:[s("quiz.questionText")," (",s("common.or")," Media)"]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx("div",{children:w.image_url?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:w.image_url,alt:"Preview",className:"w-full h-24 object-cover rounded border"}),e.jsx("button",{onClick:()=>ye("image"),className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1 hover:bg-red-600",children:e.jsx(Te,{size:16})})]}):e.jsxs("label",{className:"flex flex-col items-center justify-center h-24 border-2 border-dashed border-gray-300 rounded cursor-pointer hover:border-cyan-400",children:[e.jsx(Je,{size:20,className:"text-gray-400 mb-1"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Image"}),e.jsx("input",{type:"file",accept:"image/*",onChange:V=>ne(V,"image"),className:"hidden",disabled:R})]})}),e.jsx("div",{children:w.video_url?e.jsxs("div",{className:"relative",children:[e.jsx("video",{src:w.video_url,className:"w-full h-24 object-cover rounded border",controls:!0}),e.jsx("button",{onClick:()=>ye("video"),className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1 hover:bg-red-600",children:e.jsx(Te,{size:16})})]}):e.jsxs("label",{className:"flex flex-col items-center justify-center h-24 border-2 border-dashed border-gray-300 rounded cursor-pointer hover:border-cyan-400",children:[e.jsx(Je,{size:20,className:"text-gray-400 mb-1"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Video"}),e.jsx("input",{type:"file",accept:"video/*",onChange:V=>ne(V,"video"),className:"hidden",disabled:R})]})}),e.jsx("div",{children:w.gif_url?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:w.gif_url,alt:"GIF Preview",className:"w-full h-24 object-cover rounded border"}),e.jsx("button",{onClick:()=>ye("gif"),className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1 hover:bg-red-600",children:e.jsx(Te,{size:16})})]}):e.jsxs("label",{className:"flex flex-col items-center justify-center h-24 border-2 border-dashed border-gray-300 rounded cursor-pointer hover:border-cyan-400",children:[e.jsx(Je,{size:20,className:"text-gray-400 mb-1"}),e.jsx("span",{className:"text-xs text-gray-500",children:"GIF"}),e.jsx("input",{type:"file",accept:"image/gif",onChange:V=>ne(V,"gif"),className:"hidden",disabled:R})]})})]}),R&&e.jsx("p",{className:"text-sm text-blue-700 mt-2",children:s("common.loading")})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:s("quiz.timeLimit")}),e.jsx("input",{type:"number",value:w.time_limit,onChange:V=>{const ee=parseInt(V.target.value,10);O(te=>({...te,time_limit:Number.isNaN(ee)?te.time_limit:ee}))},className:"w-full border rounded px-3 py-2",min:"5",max:"120"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:s("quiz.points")}),e.jsx("input",{type:"number",value:w.points,onChange:V=>{const ee=parseInt(V.target.value,10);O(te=>({...te,points:Number.isNaN(ee)?te.points:ee}))},className:"w-full border rounded px-3 py-2",min:"10",max:"1000"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:s("quiz.answers")}),e.jsx("div",{className:"space-y-2",children:w.options.map((V,ee)=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("input",{type:"text",value:V.text,onChange:te=>Z(ee,"text",te.target.value),className:"flex-1 border rounded px-3 py-2",placeholder:`${s("quiz.option")} ${ee+1}`,disabled:w.question_type==="true_false"}),e.jsxs("label",{className:"flex items-center gap-2 whitespace-nowrap",children:[e.jsx("input",{type:"checkbox",checked:V.is_correct,onChange:te=>Z(ee,"is_correct",te.target.checked),className:"w-5 h-5"}),e.jsx("span",{className:"text-sm",children:s("quiz.correctAnswer")})]})]},ee))})]}),E&&e.jsx("p",{className:"text-sm text-red-600",children:E}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:le,className:"flex-1 bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 flex items-center justify-center gap-2",children:[e.jsx(Me,{size:18}),s("common.save")]}),e.jsx("button",{onClick:pe,className:"bg-gray-500 text-white px-6 py-3 rounded-lg hover:bg-gray-600",children:s("common.cancel")})]})]})]});return e.jsxs("div",{className:"flex min-h-screen bg-gray-50",children:[e.jsx(Ee,{currentView:"create-quiz",setView:r,appState:t}),e.jsxs("div",{className:"flex-1 ml-64",children:[e.jsxs("nav",{className:"bg-white shadow-sm border-b border-gray-200 px-6 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-blue-700",children:s("nav.createQuiz")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>be(!1),disabled:F,className:"bg-blue-700 text-white px-4 py-2 rounded-lg hover:bg-blue-800 disabled:opacity-50 flex items-center gap-2",children:[e.jsx(Me,{size:18}),s(F?"common.loading":"common.save")]}),e.jsxs("button",{onClick:()=>be(!0),disabled:F,className:"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 disabled:opacity-50 flex items-center gap-2",children:[e.jsx(Me,{size:18}),"Save & Exit"]})]})]}),(J||ie)&&e.jsxs("div",{className:"mt-3",children:[J&&e.jsx("p",{className:"text-sm text-red-600",children:J}),ie&&e.jsx("p",{className:"text-sm text-green-600",children:ie})]})]}),e.jsxs("div",{className:"container mx-auto p-6 max-w-5xl",children:[e.jsxs("div",{className:"bg-white shadow-md rounded-lg",children:[e.jsxs("div",{className:"flex border-b border-gray-200",children:[e.jsx("button",{className:`flex-1 px-4 py-3 text-sm font-medium transition ${f==="settings"?"text-blue-700 border-b-2 border-blue-700 bg-blue-50":"text-gray-600 hover:text-blue-700"}`,onClick:()=>S("settings"),children:s("nav.settings")}),e.jsxs("button",{className:`flex-1 px-4 py-3 text-sm font-medium transition ${f==="questions"?"text-blue-700 border-b-2 border-blue-700 bg-blue-50":"text-gray-600 hover:text-blue-700"}`,onClick:()=>S("questions"),children:[s("quiz.questions")," (",z.length,")"]})]}),e.jsx("div",{className:"p-6",children:f==="settings"?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:s("quiz.title")}),e.jsx("input",{type:"text",value:a,onChange:U=>i(U.target.value),required:!0,className:"w-full border rounded px-3 py-2 focus:ring focus:ring-blue-300",placeholder:s("quiz.title")})]}),e.jsx("div",{className:"border-t pt-4",children:e.jsx(Qs,{selectedThemeId:o,onThemeSelect:U=>{l(U),u(null)},customBackgroundUrl:d,onCustomBackgroundChange:U=>{u(U),U&&l(null)}})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:s("folder.folder")}),e.jsxs("select",{value:g,onChange:U=>m(U.target.value),className:"w-full border rounded px-3 py-2 focus:ring focus:ring-blue-300",children:[e.jsx("option",{value:"",children:"-- No Folder (Top Level) --"}),me.map(U=>e.jsx("option",{value:U.id,children:U.label},U.id))]}),h.length===0&&e.jsx("p",{className:"mt-2 text-xs text-gray-500",children:s("folder.noFolders")})]}),e.jsxs("div",{className:"border-t pt-4 space-y-3",children:[e.jsx("h3",{className:"font-semibold text-gray-700",children:s("nav.settings")}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:B,onChange:U=>se(U.target.checked),className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:s("quiz.isTemplate")})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:de,onChange:U=>q(U.target.checked),className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:s("quiz.isPublic")})]})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800",children:[s("quiz.questions")," (",z.length,")"]}),e.jsxs("p",{className:"text-sm text-gray-500",children:[z.length," ",z.length===1?s("quiz.question"):s("quiz.questions")," • ",ke," ",s("quiz.points")]})]}),e.jsxs("button",{onClick:we,className:"bg-blue-700 text-white px-4 py-2 rounded-lg hover:bg-blue-800 transition flex items-center gap-2 text-sm font-medium",children:[e.jsx(Re,{size:16}),s("quiz.addQuestion")]})]}),z.length===0?e.jsxs("div",{className:"bg-gray-50 border border-dashed border-blue-100 rounded-lg p-10 text-center",children:[e.jsx("div",{className:"mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-blue-50",children:e.jsx(Re,{size:32,className:"text-blue-700"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-2",children:s("quiz.noQuestions")}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Start building your quiz by adding questions."}),e.jsx("button",{onClick:we,className:"bg-blue-700 text-white px-6 py-3 rounded-lg hover:bg-blue-800 transition font-medium",children:s("quiz.addQuestion")})]}):e.jsx("div",{className:"space-y-4",children:z.map((U,V)=>{const ee=A==="edit"&&Q===V;return e.jsxs("div",{draggable:!ee,onDragStart:te=>{ee||ze(te,V)},onDragOver:te=>{ee||_e(te)},onDrop:te=>{ee||je(te,V)},className:`bg-white rounded-lg border border-gray-200 shadow-sm hover:shadow-md transition-shadow overflow-hidden ${_===V?"opacity-50":""} ${ee?"ring-2 ring-blue-100 border-cyan-300":""}`,children:[e.jsxs("div",{className:"bg-gray-50 px-6 py-3 border-b border-gray-200 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`${ee?"text-gray-300 cursor-not-allowed":"cursor-move text-gray-400 hover:text-gray-600"}`,children:e.jsx(Ns,{size:20})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-lg font-bold text-blue-800 bg-blue-50 px-3 py-1 rounded-full",children:["Q",V+1]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ze,{size:14}),e.jsxs("span",{children:[ee?w.time_limit:U.time_limit,"s"]})]}),e.jsx("span",{children:"•"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(it,{size:14}),e.jsxs("span",{children:[ee?w.points:U.points," pts"]})]})]})]})]}),e.jsx("div",{className:"flex items-center gap-1",children:!ee&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>xe(V),className:"text-gray-600 hover:text-blue-700 px-2 py-1 rounded",title:"Edit question",children:e.jsx(rt,{size:16})}),e.jsx("button",{onClick:()=>L(V),className:"text-gray-600 hover:text-blue-700 px-2 py-1 rounded",title:"Duplicate question",children:e.jsx(ot,{size:16})}),e.jsx("button",{onClick:()=>I(V),className:"text-gray-600 hover:text-red-600 px-2 py-1 rounded",title:"Delete question",children:e.jsx(He,{size:16})})]})})]}),e.jsx("div",{className:"p-6 space-y-4",children:ee?ve():e.jsxs(e.Fragment,{children:[(U.image_url||U.video_url||U.gif_url)&&e.jsxs("div",{className:"mb-4",children:[U.image_url&&e.jsx("img",{src:U.image_url,alt:"Question",className:"rounded-lg max-h-48 object-cover"}),U.video_url&&e.jsx("video",{src:U.video_url,controls:!0,className:"rounded-lg max-h-48 w-full"}),U.gif_url&&e.jsx("img",{src:U.gif_url,alt:"GIF",className:"rounded-lg max-h-48 object-cover"})]}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:U.question_text}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:U.options.map((te,fe)=>e.jsx("div",{className:`p-3 rounded-lg border-2 transition-all ${te.is_correct?"bg-green-50 border-green-400 shadow-sm":"bg-gray-50 border-gray-200 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-start gap-2",children:[te.is_correct&&e.jsx(ut,{size:18,className:"text-green-600 flex-shrink-0 mt-0.5"}),e.jsx("span",{className:`text-sm ${te.is_correct?"font-semibold text-green-900":"text-gray-700"}`,children:te.text||e.jsx("em",{className:"text-gray-400",children:"No answer text"})})]})},fe))})]})})]},U.tempId||V)})}),z.length>0&&A!=="add"&&e.jsx("div",{className:"flex justify-center mt-6",children:e.jsxs("button",{onClick:we,className:"bg-blue-700 text-white px-6 py-3 rounded-lg hover:bg-blue-800 transition flex items-center gap-2 font-medium",children:[e.jsx(Re,{size:18}),s("quiz.addQuestion")]})}),A==="add"&&e.jsx("div",{className:"bg-white border border-blue-100 rounded-lg shadow-sm p-6",children:ve(s("quiz.addQuestion"))})]})})]}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsxs("button",{onClick:be,disabled:F,className:"bg-blue-700 text-white px-6 py-3 rounded-lg hover:bg-blue-800 disabled:opacity-50 flex items-center gap-2",children:[e.jsx(Me,{size:20}),s(F?"common.loading":"common.save")]})})]})]}),e.jsx(Ie,{isOpen:Y.isOpen,title:Y.title,message:Y.message,type:Y.type,onClose:()=>oe({...Y,isOpen:!1})})]})}const Qt=n=>n==="true_false"?[{text:"True",is_correct:!1},{text:"False",is_correct:!1}]:[{text:"",is_correct:!1},{text:"",is_correct:!1},{text:"",is_correct:!1},{text:"",is_correct:!1}],St=(n="multiple_choice")=>({question_text:"",question_type:n,time_limit:30,points:100,image_url:"",video_url:"",gif_url:"",options:Qt(n)});function Kr({setView:n,quizId:r,appState:t}){const{t:s}=qe(),[a,i]=c.useState(""),[o,l]=c.useState(null),[d,u]=c.useState(null),[g,m]=c.useState(""),[h,b]=c.useState(!1),[z,k]=c.useState(!1),[f,S]=c.useState([]),[w,O]=c.useState([]),[A,C]=c.useState("settings"),[Q,M]=c.useState(St()),[R,$]=c.useState(null),[E,v]=c.useState(null),[_,D]=c.useState(null),[F,G]=c.useState(!1),[J,X]=c.useState(null),[ie,T]=c.useState(!0),[B,se]=c.useState(null),[de,q]=c.useState(null),[Y,oe]=c.useState(null),[re,ge]=c.useState(!1),[me,pe]=c.useState({isOpen:!1,title:"",message:"",type:"info"}),[we,xe]=c.useState({isOpen:!1,title:"",message:"",onConfirm:null});c.useEffect(()=>{r&&L()},[r]),c.useEffect(()=>{I()},[]);const L=async()=>{try{const{data:x,error:y}=await N.from("quizzes").select("id, title, theme_id, background_image_url, folder_id, is_template, is_public").eq("id",r).single();if(y)throw y;i(x.title||""),l(x.theme_id),u(x.theme_id?null:x.background_image_url||null),m(x.folder_id||""),b(!!x.is_template),k(!!x.is_public);const{data:P,error:W}=await N.from("questions").select("*").eq("quiz_id",r).order("order_index",{ascending:!0});if(W)throw W;S(P||[])}catch(x){se(x.message)}finally{T(!1)}},I=async()=>{try{const{data:x}=await N.auth.getUser();if(!(x!=null&&x.user))return;const{data:y,error:P}=await N.from("quiz_folders").select("id, name, parent_folder_id").eq("created_by",x.user.id).order("name",{ascending:!0});if(P)throw P;O(y||[])}catch(x){console.error("Error fetching folders:",x.message)}},Z=c.useMemo(()=>{const x=[],y=(P=null,W=0)=>{w.filter(j=>j.parent_folder_id===P).sort((j,H)=>j.name.localeCompare(H.name)).forEach(j=>{const H=W>0?`${"  ".repeat(W)}- `:"";x.push({id:j.id,label:`${H}${j.name}`}),y(j.id,W+1)})};return y(),x},[w]),K=()=>{M(St()),$(null),v(null),D(null)},ne=()=>{C("questions"),M(St()),$("add"),v(null),D(null)},ye=x=>{C("questions"),M({question_text:x.question_text,question_type:x.question_type,time_limit:x.time_limit,points:x.points,image_url:x.image_url||"",video_url:x.video_url||"",gif_url:x.gif_url||"",options:x.options&&Array.isArray(x.options)?x.options.map(y=>({...y})):Qt(x.question_type)}),$("edit"),v(x),D(null)},le=async()=>{if(!Q.question_text.trim()){pe({isOpen:!0,title:s("common.error"),message:s("quiz.questionTextRequired"),type:"error"});return}if(!Q.options.some(y=>y.is_correct)){pe({isOpen:!0,title:"Validation Error",message:s("quiz.markCorrectAnswer"),type:"warning"});return}if(R){ge(!0),D(null);try{const y={question_text:Q.question_text.trim(),question_type:Q.question_type,time_limit:Q.time_limit,points:Q.points,options:Q.options.map(P=>({text:P.text.trim(),is_correct:P.is_correct})),image_url:Q.image_url||null,video_url:Q.video_url||null,gif_url:Q.gif_url||null};if(R==="edit"&&E){const{error:P}=await N.from("questions").update(y).eq("id",E.id);if(P)throw P}else if(R==="add"){const{error:P}=await N.from("questions").insert([{...y,quiz_id:r,order_index:f.length}]);if(P)throw P}await L(),K()}catch(y){pe({isOpen:!0,title:s("common.error"),message:s("quiz.errorSavingQuestion")+": "+y.message,type:"error"})}finally{ge(!1)}}},ze=x=>{xe({isOpen:!0,title:s("quiz.deleteQuestion"),message:s("quiz.confirmDeleteQuestion"),onConfirm:async()=>{xe({...we,isOpen:!1});try{const{error:y}=await N.from("questions").delete().eq("id",x);if(y)throw y;R==="edit"&&(E==null?void 0:E.id)===x&&K(),await L()}catch(y){pe({isOpen:!0,title:s("common.error"),message:s("quiz.errorDeletingQuestion")+": "+y.message,type:"error"})}}})},_e=(x,y,P)=>{M(W=>{const p=W.options.map((j,H)=>H===x?{...j,[y]:P}:{...j});return y==="is_correct"&&P&&p.forEach((j,H)=>{H!==x&&(j.is_correct=!1)}),{...W,options:p}})},je=x=>{M(y=>({...y,question_type:x,options:Qt(x)}))},be=async(x,y)=>{const P=x.target.files[0];if(P){G(!0);try{let W;y==="image"?W=await Ot(P):y==="video"?W=await Ps(P):y==="gif"&&(W=await Ts(P)),W&&M(p=>({...p,[`${y}_url`]:W}))}catch(W){pe({isOpen:!0,title:s("common.error"),message:s("quiz.errorUploadingFile")+": "+W.message,type:"error"})}finally{G(!1)}}},ke=x=>{M(y=>({...y,[`${x}_url`]:""}))},ve=async x=>{try{const{error:y}=await N.from("questions").insert([{quiz_id:r,question_text:`${x.question_text} ${s("quiz.copySuffix")}`,question_type:x.question_type,time_limit:x.time_limit,points:x.points,options:x.options,image_url:x.image_url,video_url:x.video_url,gif_url:x.gif_url,order_index:f.length}]);if(y)throw y;await L()}catch(y){pe({isOpen:!0,title:s("common.error"),message:s("quiz.errorDuplicatingQuestion")+": "+y.message,type:"error"})}},U=(x,y,P)=>{if(R==="edit"&&(E==null?void 0:E.id)===y.id){x.preventDefault();return}X({question:y,index:P}),x.dataTransfer.effectAllowed="move"},V=x=>{x.preventDefault(),x.dataTransfer.dropEffect="move"},ee=async(x,y)=>{if(x.preventDefault(),!(!J||J.index===y))try{const P=[...f],[W]=P.splice(J.index,1);P.splice(y,0,W);const p=P.map((j,H)=>({id:j.id,order_index:H}));for(const j of p)await N.from("questions").update({order_index:j.order_index}).eq("id",j.id);await L(),X(null)}catch(P){pe({isOpen:!0,title:s("common.error"),message:s("quiz.errorReorderingQuestions")+": "+P.message,type:"error"})}},te=async(x=!1)=>{const y=typeof x=="boolean"?x:!1;if(ge(!0),q(null),oe(null),!a.trim()){q(s("quiz.quizTitleRequired")),C("settings"),ge(!1);return}try{const P={title:a.trim(),theme_id:d?null:o,background_image_url:d||null,folder_id:g||null,randomize_questions:!1,randomize_answers:!1,is_template:h,is_public:z},{error:W}=await N.from("quizzes").update(P).eq("id",r);if(W)throw W;if(y){n("manage-quizzes");return}oe("Changes saved!")}catch(P){q(P.message)}finally{ge(!1)}},fe=c.useMemo(()=>f.reduce((x,y)=>x+(y.points||0),0),[f]),Ce=(x=null)=>e.jsxs("div",{children:[x&&e.jsx("h3",{className:"text-xl font-bold mb-4",children:x}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:s("quiz.question")}),e.jsx("input",{type:"text",value:Q.question_text,onChange:y=>M(P=>({...P,question_text:y.target.value})),className:"w-full border rounded px-3 py-2",placeholder:s("quiz.enterQuestion")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:s("quiz.questionType")}),e.jsxs("select",{value:Q.question_type,onChange:y=>je(y.target.value),className:"w-full border rounded px-3 py-2",children:[e.jsx("option",{value:"multiple_choice",children:s("quiz.multipleChoice")}),e.jsx("option",{value:"true_false",children:s("quiz.trueFalse")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:s("quiz.mediaOptional")}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx("div",{children:Q.image_url?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:Q.image_url,alt:"Preview",className:"w-full h-24 object-cover rounded border"}),e.jsx("button",{onClick:()=>ke("image"),className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1 hover:bg-red-600",children:e.jsx(Te,{size:16})})]}):e.jsxs("label",{className:"flex flex-col items-center justify-center h-24 border-2 border-dashed border-gray-300 rounded cursor-pointer hover:border-cyan-400",children:[e.jsx(Je,{size:20,className:"text-gray-400 mb-1"}),e.jsx("span",{className:"text-xs text-gray-500",children:s("quiz.image")}),e.jsx("input",{type:"file",accept:"image/*",onChange:y=>be(y,"image"),className:"hidden",disabled:F})]})}),e.jsx("div",{children:Q.video_url?e.jsxs("div",{className:"relative",children:[e.jsx("video",{src:Q.video_url,className:"w-full h-24 object-cover rounded border",controls:!0}),e.jsx("button",{onClick:()=>ke("video"),className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1 hover:bg-red-600",children:e.jsx(Te,{size:16})})]}):e.jsxs("label",{className:"flex flex-col items-center justify-center h-24 border-2 border-dashed border-gray-300 rounded cursor-pointer hover:border-cyan-400",children:[e.jsx(Je,{size:20,className:"text-gray-400 mb-1"}),e.jsx("span",{className:"text-xs text-gray-500",children:s("quiz.video")}),e.jsx("input",{type:"file",accept:"video/*",onChange:y=>be(y,"video"),className:"hidden",disabled:F})]})}),e.jsx("div",{children:Q.gif_url?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:Q.gif_url,alt:"GIF Preview",className:"w-full h-24 object-cover rounded border"}),e.jsx("button",{onClick:()=>ke("gif"),className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1 hover:bg-red-600",children:e.jsx(Te,{size:16})})]}):e.jsxs("label",{className:"flex flex-col items-center justify-center h-24 border-2 border-dashed border-gray-300 rounded cursor-pointer hover:border-cyan-400",children:[e.jsx(Je,{size:20,className:"text-gray-400 mb-1"}),e.jsx("span",{className:"text-xs text-gray-500",children:s("quiz.gif")}),e.jsx("input",{type:"file",accept:"image/gif",onChange:y=>be(y,"gif"),className:"hidden",disabled:F})]})})]}),F&&e.jsx("p",{className:"text-sm text-blue-700 mt-2",children:s("common.uploading")})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:s("quiz.timeLimit")}),e.jsx("input",{type:"number",value:Q.time_limit,onChange:y=>{const P=parseInt(y.target.value,10);M(W=>({...W,time_limit:Number.isNaN(P)?W.time_limit:P}))},className:"w-full border rounded px-3 py-2",min:"5",max:"120"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:s("quiz.points")}),e.jsx("input",{type:"number",value:Q.points,onChange:y=>{const P=parseInt(y.target.value,10);M(W=>({...W,points:Number.isNaN(P)?W.points:P}))},className:"w-full border rounded px-3 py-2",min:"10",max:"1000"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:s("quiz.answers")}),e.jsx("div",{className:"space-y-2",children:Q.options.map((y,P)=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("input",{type:"text",value:y.text,onChange:W=>_e(P,"text",W.target.value),className:"flex-1 border rounded px-3 py-2",placeholder:`${s("quiz.option")} ${P+1}`,disabled:Q.question_type==="true_false"}),e.jsxs("label",{className:"flex items-center gap-2 whitespace-nowrap",children:[e.jsx("input",{type:"checkbox",checked:y.is_correct,onChange:W=>_e(P,"is_correct",W.target.checked),className:"w-5 h-5"}),e.jsx("span",{className:"text-sm",children:s("quiz.correct")})]})]},P))})]}),_&&e.jsx("p",{className:"text-sm text-red-600",children:_}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:le,disabled:re,className:"flex-1 bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 disabled:opacity-50 flex items-center justify-center gap-2",children:[e.jsx(Me,{size:18}),s(re?"common.saving":"quiz.saveQuestion")]}),e.jsx("button",{onClick:K,className:"bg-gray-500 text-white px-6 py-3 rounded-lg hover:bg-gray-600",children:s("common.cancel")})]})]})]});return ie?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("p",{className:"text-xl text-gray-600",children:s("quiz.loadingQuiz")})}):B?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-xl text-red-600 mb-4",children:[s("common.error"),": ",B]}),e.jsx("button",{onClick:()=>n("manage-quizzes"),className:"bg-blue-700 text-white px-6 py-3 rounded-lg hover:bg-blue-800",children:s("quiz.backToQuizzes")})]})}):e.jsxs("div",{className:"flex min-h-screen bg-gray-50",children:[e.jsx(Ee,{currentView:"manage-quizzes",setView:n,appState:t}),e.jsxs("div",{className:"flex-1 ml-64",children:[e.jsxs("nav",{className:"bg-white shadow-sm border-b border-gray-200 px-6 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>n("manage-quizzes"),className:"text-gray-600 hover:text-gray-900 transition",children:e.jsx(We,{size:24})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:a||s("quiz.untitledQuiz")}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-sm text-gray-600",children:[e.jsxs("span",{children:[f.length," ",f.length===1?s("quiz.question"):s("quiz.questions")]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:[fe," ",s("quiz.totalPoints")]})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>te(!1),disabled:re,className:"bg-blue-700 text-white px-4 py-2 rounded-lg hover:bg-blue-800 disabled:opacity-50 flex items-center gap-2",children:[e.jsx(Me,{size:18}),re?s("common.saving"):"Save Quiz"]}),e.jsxs("button",{onClick:()=>te(!0),disabled:re,className:"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 disabled:opacity-50 flex items-center gap-2",children:[e.jsx(Me,{size:18}),"Save & Exit"]})]})]}),(de||Y)&&e.jsxs("div",{className:"mt-3",children:[de&&e.jsx("p",{className:"text-sm text-red-600",children:de}),Y&&e.jsx("p",{className:"text-sm text-green-600",children:Y})]})]}),e.jsxs("div",{className:"container mx-auto p-6 max-w-5xl",children:[e.jsxs("div",{className:"bg-white shadow-md rounded-lg",children:[e.jsxs("div",{className:"flex border-b border-gray-200",children:[e.jsx("button",{className:`flex-1 px-4 py-3 text-sm font-medium transition ${A==="settings"?"text-blue-700 border-b-2 border-blue-700 bg-blue-50":"text-gray-600 hover:text-blue-700"}`,onClick:()=>C("settings"),children:s("nav.settings")}),e.jsxs("button",{className:`flex-1 px-4 py-3 text-sm font-medium transition ${A==="questions"?"text-blue-700 border-b-2 border-blue-700 bg-blue-50":"text-gray-600 hover:text-blue-700"}`,onClick:()=>C("questions"),children:[s("quiz.questions")," (",f.length,")"]})]}),e.jsx("div",{className:"p-6",children:A==="settings"?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:s("quiz.title")}),e.jsx("input",{type:"text",value:a,onChange:x=>i(x.target.value),className:"w-full border rounded px-3 py-2 focus:ring focus:ring-blue-300",placeholder:s("quiz.enterQuizTitle")})]}),e.jsx("div",{className:"border-t pt-4",children:e.jsx(Qs,{selectedThemeId:o,onThemeSelect:x=>{l(x),u(null)},customBackgroundUrl:d,onCustomBackgroundChange:x=>{u(x),x&&l(null)}})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:s("folder.folder")}),e.jsxs("select",{value:g,onChange:x=>m(x.target.value),className:"w-full border rounded px-3 py-2 focus:ring focus:ring-blue-300",children:[e.jsx("option",{value:"",children:s("folder.noFolder")}),Z.map(x=>e.jsx("option",{value:x.id,children:x.label},x.id))]}),w.length===0&&e.jsx("p",{className:"mt-2 text-xs text-gray-500",children:s("folder.noFoldersMessage")})]}),e.jsxs("div",{className:"border-t pt-4 space-y-3",children:[e.jsx("h3",{className:"font-semibold text-gray-700",children:s("quiz.quizSettings")}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:h,onChange:x=>b(x.target.checked),className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:s("quiz.isTemplate")})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:z,onChange:x=>k(x.target.checked),className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:s("quiz.isPublic")})]})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800",children:[s("quiz.questions")," (",f.length,")"]}),e.jsxs("p",{className:"text-sm text-gray-500",children:[f.length," ",f.length===1?s("quiz.question"):s("quiz.questions")," • ",fe," ",s("quiz.totalPoints")]})]}),e.jsxs("button",{onClick:ne,className:"bg-blue-700 text-white px-4 py-2 rounded-lg hover:bg-blue-800 transition flex items-center gap-2 text-sm font-medium",children:[e.jsx(Re,{size:16}),s("quiz.addQuestion")]})]}),f.length===0?e.jsxs("div",{className:"bg-gray-50 border border-dashed border-blue-100 rounded-lg p-10 text-center",children:[e.jsx("div",{className:"mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-blue-50",children:e.jsx(Re,{size:32,className:"text-blue-700"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-2",children:s("quiz.noQuestions")}),e.jsx("p",{className:"text-gray-600 mb-6",children:s("quiz.startBuildingQuiz")}),e.jsx("button",{onClick:ne,className:"bg-blue-700 text-white px-6 py-3 rounded-lg hover:bg-blue-800 transition font-medium",children:s("quiz.addFirstQuestion")})]}):e.jsx("div",{className:"space-y-4",children:f.map((x,y)=>{var W;const P=R==="edit"&&(E==null?void 0:E.id)===x.id;return e.jsxs("div",{draggable:!P,onDragStart:p=>{P||U(p,x,y)},onDragOver:p=>{P||V(p)},onDrop:p=>{P||ee(p,y)},className:`bg-white rounded-lg border border-gray-200 shadow-sm hover:shadow-md transition-shadow overflow-hidden ${(J==null?void 0:J.question.id)===x.id?"opacity-50":""} ${P?"ring-2 ring-blue-100 border-cyan-300":""}`,children:[e.jsxs("div",{className:"bg-gray-50 px-6 py-3 border-b border-gray-200 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`${P?"text-gray-300 cursor-not-allowed":"cursor-move text-gray-400 hover:text-gray-600"}`,children:e.jsx(Ns,{size:20})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-lg font-bold text-blue-800 bg-blue-50 px-3 py-1 rounded-full",children:["Q",y+1]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ze,{size:14}),e.jsxs("span",{children:[P?Q.time_limit:x.time_limit,"s"]})]}),e.jsx("span",{children:"•"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(it,{size:14}),e.jsxs("span",{children:[P?Q.points:x.points," pts"]})]})]})]})]}),e.jsx("div",{className:"flex items-center gap-1",children:!P&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>ye(x),className:"text-gray-600 hover:text-blue-700 px-2 py-1 rounded",title:s("quiz.editQuestion"),children:e.jsx(rt,{size:16})}),e.jsx("button",{onClick:()=>ve(x),className:"text-gray-600 hover:text-blue-700 px-2 py-1 rounded",title:s("quiz.duplicateQuestion"),children:e.jsx(ot,{size:16})}),e.jsx("button",{onClick:()=>ze(x.id),className:"text-gray-600 hover:text-red-600 px-2 py-1 rounded",title:s("quiz.deleteQuestion"),children:e.jsx(He,{size:16})})]})})]}),e.jsx("div",{className:"p-6 space-y-4",children:P?Ce():e.jsxs(e.Fragment,{children:[(x.image_url||x.video_url||x.gif_url)&&e.jsxs("div",{className:"mb-4",children:[x.image_url&&e.jsx("img",{src:x.image_url,alt:"Question",className:"rounded-lg max-h-48 object-cover"}),x.video_url&&e.jsx("video",{src:x.video_url,controls:!0,className:"rounded-lg max-h-48 w-full"}),x.gif_url&&e.jsx("img",{src:x.gif_url,alt:"GIF",className:"rounded-lg max-h-48 object-cover"})]}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:x.question_text}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:(W=x.options)==null?void 0:W.map((p,j)=>e.jsx("div",{className:`p-3 rounded-lg border-2 transition-all ${p.is_correct?"bg-green-50 border-green-400 shadow-sm":"bg-gray-50 border-gray-200 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-start gap-2",children:[p.is_correct&&e.jsx(ut,{size:18,className:"text-green-600 flex-shrink-0 mt-0.5"}),e.jsx("span",{className:`text-sm ${p.is_correct?"font-semibold text-green-900":"text-gray-700"}`,children:p.text||e.jsx("em",{className:"text-gray-400",children:s("quiz.noAnswerText")})})]})},j))})]})})]},x.id)})}),f.length>0&&R!=="add"&&e.jsx("div",{className:"flex justify-center mt-6",children:e.jsxs("button",{onClick:ne,className:"bg-blue-700 text-white px-6 py-3 rounded-lg hover:bg-blue-800 transition flex items-center gap-2 font-medium",children:[e.jsx(Re,{size:18}),s("quiz.addQuestion")]})}),R==="add"&&e.jsx("div",{className:"bg-white border border-blue-100 rounded-lg shadow-sm p-6",children:Ce(s("quiz.addNewQuestion"))})]})})]}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsxs("button",{onClick:te,disabled:re,className:"bg-blue-700 text-white px-6 py-3 rounded-lg hover:bg-blue-800 disabled:opacity-50 flex items-center gap-2",children:[e.jsx(Me,{size:20}),re?s("common.saving"):"Save Quiz"]})})]})]}),e.jsx(Ie,{isOpen:me.isOpen,title:me.title,message:me.message,type:me.type,onClose:()=>pe({...me,isOpen:!1})}),e.jsx(Le,{isOpen:we.isOpen,title:we.title,message:we.message,onConfirm:we.onConfirm,onCancel:()=>xe({...we,isOpen:!1}),confirmStyle:"danger"})]})}function Wr({winners:n}){var a,i,o;if(!n||n.length===0)return null;const r=n[0],t=n[1],s=n[2];return e.jsxs("div",{className:"flex items-end justify-center gap-8 h-96 mb-8",children:[t&&e.jsxs("div",{className:"text-center animate-bounce-in",style:{animationDelay:"0.2s"},children:[e.jsx("div",{className:"text-6xl mb-4",children:"🥈"}),e.jsxs("div",{className:"bg-gray-300 rounded-t-lg p-8 flex flex-col justify-end",style:{height:"200px",minWidth:"150px"},children:[e.jsx("p",{className:"text-2xl font-bold mb-2",children:((a=t.users)==null?void 0:a.name)||"Anonymous"}),e.jsxs("p",{className:"text-xl text-gray-700",children:[t.score," pts"]})]}),e.jsx("div",{className:"bg-gray-400 text-white font-bold py-2 rounded-b-lg",children:"2nd"})]}),r&&e.jsxs("div",{className:"text-center animate-bounce-in",style:{animationDelay:"0s"},children:[e.jsx("div",{className:"text-8xl mb-4",children:"🥇"}),e.jsxs("div",{className:"bg-yellow-400 rounded-t-lg p-8 flex flex-col justify-end",style:{height:"280px",minWidth:"150px"},children:[e.jsx("p",{className:"text-3xl font-bold mb-2",children:((i=r.users)==null?void 0:i.name)||"Anonymous"}),e.jsxs("p",{className:"text-2xl text-gray-800",children:[r.score," pts"]})]}),e.jsx("div",{className:"bg-yellow-500 text-white font-bold py-2 rounded-b-lg",children:"1st"})]}),s&&e.jsxs("div",{className:"text-center animate-bounce-in",style:{animationDelay:"0.4s"},children:[e.jsx("div",{className:"text-6xl mb-4",children:"🥉"}),e.jsxs("div",{className:"bg-orange-300 rounded-t-lg p-8 flex flex-col justify-end",style:{height:"150px",minWidth:"150px"},children:[e.jsx("p",{className:"text-2xl font-bold mb-2",children:((o=s.users)==null?void 0:o.name)||"Anonymous"}),e.jsxs("p",{className:"text-xl text-gray-700",children:[s.score," pts"]})]}),e.jsx("div",{className:"bg-orange-400 text-white font-bold py-2 rounded-b-lg",children:"3rd"})]})]})}function pt({src:n,className:r,controls:t=!0,reloadKey:s,muted:a,...i}){const o=c.useRef(null),l=a===void 0;return c.useEffect(()=>{const d=o.current;if(!d||!n)return;let u=!1;const g=()=>{if(u)return;a!==void 0?d.muted=a:d.muted=!1;const h=d.play();h&&typeof h.catch=="function"&&h.catch(()=>{!l||u||(d.muted=!0,d.play().catch(()=>{}))})},m=()=>{d.removeEventListener("canplay",m),g()};d.pause();try{d.currentTime=0,d.load()}catch{}return d.readyState>=2?g():d.addEventListener("canplay",m),()=>{u=!0,d.removeEventListener("canplay",m),d.pause()}},[n,s,a]),e.jsx("video",{ref:o,src:n,className:r,controls:t,autoPlay:!0,playsInline:!0,muted:a,...i})}function Jr({sessionId:n,setView:r}){var ee,te,fe,Ce;const{t}=qe(),[s,a]=c.useState(null),[i,o]=c.useState(null),[l,d]=c.useState([]),[u,g]=c.useState([]),[m,h]=c.useState([]),[b,z]=c.useState([]),[k,f]=c.useState(null),[S,w]=c.useState(null),[O,A]=c.useState(null),[C,Q]=c.useState(!1),[M,R]=c.useState([]),[$,E]=c.useState([]),[v,_]=c.useState(!0),[D,F]=c.useState(null),[G,J]=c.useState(!0),[X,ie]=c.useState(null),[T,B]=c.useState(5),[se,de]=c.useState(0),[q,Y]=c.useState(null),[oe,re]=c.useState(!1),[ge,me]=c.useState({isOpen:!1,title:"",message:"",type:"info"}),[pe,we]=c.useState({isOpen:!1,title:"",message:"",onConfirm:null}),xe=c.useRef(null);c.useEffect(()=>{if(n){L();const x=K(),y=setInterval(()=>{(s==null?void 0:s.status)==="waiting"&&(console.log("[TeacherControl] Polling for participant updates (fallback)"),I(s)),(s==null?void 0:s.status)==="question_active"&&S&&(console.log("[TeacherControl] Polling for live answers (fallback)"),Z(S.id))},3e3);return()=>{x(),clearInterval(y)}}},[n,s==null?void 0:s.status,S==null?void 0:S.id]),c.useEffect(()=>{xe.current=S},[S]),c.useEffect(()=>{if((s==null?void 0:s.status)==="active"&&!S&&T>0){const x=setTimeout(()=>B(T-1),1e3);return()=>clearTimeout(x)}},[s==null?void 0:s.status,S,T]),c.useEffect(()=>{if((s==null?void 0:s.status)==="question_active"&&se>0&&!oe){const x=setInterval(()=>{de(y=>y<=1?(clearInterval(x),0):y-1)},1e3);return()=>clearInterval(x)}},[s==null?void 0:s.status,se,oe]),c.useEffect(()=>{if((s==null?void 0:s.status)==="question_active"&&m.length>0){const x=m.filter(y=>$.some(P=>P.participant_id===y.id)).length===m.length;if(re(x),x&&q){console.log("[TeacherControl] All students answered! Auto-advancing to results in 2 seconds..."),clearTimeout(q);const y=setTimeout(()=>{console.log("[TeacherControl] Auto-advancing to results now"),ze(s.current_question_index)},2e3);Y(y)}}},[$,m,s==null?void 0:s.status]);const L=async()=>{try{const{data:x,error:y}=await N.from("quiz_sessions").select("*").eq("id",n);if(y)throw y;const P=x&&x.length>0?x[0]:null;if(!P)throw new Error(t("errors.quizSessionNotFound"));a(P);const{data:W,error:p}=await N.from("quizzes").select("*").eq("id",P.quiz_id);if(p)throw p;const j=W&&W.length>0?W[0]:null;if(!j)throw new Error(t("errors.quizNotFound"));if(o(j),j.theme_id){const{data:he,error:Ne}=await N.from("themes").select("*").eq("id",j.theme_id);!Ne&&he&&he.length>0?f(he[0]):f(null)}else f(null);const{data:H,error:ce}=await N.from("questions").select("*").eq("quiz_id",P.quiz_id).order("order_index",{ascending:!0});if(ce)throw ce;if(d(H),P.question_order){const he=P.question_order.map(Ne=>H.find(Qe=>Qe.id===Ne)).filter(Boolean);g(he),A(P.question_order)}else g(H),A(H.map(he=>he.id));await I(P),_(!1)}catch(x){F(x.message),_(!1)}},I=async(x=null)=>{const y=x||s;console.log("[TeacherControl] Loading participants for session:",n,"mode:",y==null?void 0:y.mode);let{data:P,error:W}=await N.from("session_participants").select("*, users(name, avatar_url), teams(id, name, team_name)").eq("session_id",n).order("score",{ascending:!1});if(W){console.error("[TeacherControl] Error loading participants:",W),console.error("[TeacherControl] Error details:",{message:W.message,details:W.details,hint:W.hint,code:W.code}),console.log("[TeacherControl] Attempting fallback query without teams...");const j=await N.from("session_participants").select("*, users(name, avatar_url)").eq("session_id",n).order("score",{ascending:!1});j.error?console.error("[TeacherControl] Fallback query also failed:",j.error):(console.log("[TeacherControl] Fallback query succeeded!"),P=j.data,W=null)}console.log("[TeacherControl] Loaded participants data:",P),console.log("[TeacherControl] Number of participants:",(P==null?void 0:P.length)||0);const p=await Promise.all((P||[]).map(async j=>{if(j.is_team_entry===!0&&j.team_id)try{const{data:H}=await N.from("team_members").select("student_id, users(name)").eq("team_id",j.team_id);return{...j,teamMembers:H||[]}}catch(H){return console.error("[TeacherControl] Error fetching team members:",H),j}return j}));if(h(p),console.log("[TeacherControl] Set participants state with",p.length,"participants"),(y==null?void 0:y.mode)==="team"){const j={};console.log("[TeacherControl] Processing team mode grouping, participants:",p==null?void 0:p.length);for(const ce of p||[])if(console.log("[TeacherControl] Participant:",ce.id,"is_team_entry:",ce.is_team_entry,"team_id:",ce.team_id,"teams:",ce.teams),ce.is_team_entry===!0&&ce.team_id){let he="Unknown Team";if(ce.teams)he=ce.teams.name||ce.teams.team_name||he,console.log("[TeacherControl] Team name from join:",he);else{console.log("[TeacherControl] Teams JOIN failed, fetching directly for team_id:",ce.team_id);try{const{data:Ne}=await N.from("teams").select("name, team_name").eq("id",ce.team_id).single();Ne&&(he=Ne.name||Ne.team_name||he,console.log("[TeacherControl] Team name from direct fetch:",he))}catch(Ne){console.error("[TeacherControl] Error fetching team name:",Ne)}}j[he]||(j[he]=[]),j[he].push(ce)}const H=Object.entries(j).map(([ce,he])=>({name:ce,members:he,score:he.reduce((Ne,Qe)=>Ne+(Qe.score||0),0)}));z(H),console.log("[TeacherControl] Teams grouped:",H.length,"teams:",H.map(ce=>ce.name))}},Z=async x=>{if(!x){console.log("[TeacherControl] loadLiveAnswers called with no questionId");return}console.log("[TeacherControl] Loading live answers for question:",x);const{data:y,error:P}=await N.from("quiz_answers").select("*").eq("session_id",n).eq("question_id",x);P?console.error("[TeacherControl] Error loading live answers:",P):(console.log("[TeacherControl] Loaded live answers:",(y==null?void 0:y.length)||0,"answers"),E(y||[]))},K=()=>{console.log("[TeacherControl] Setting up realtime subscriptions for session:",n);const x=N.channel(`session-${n}-participants`).on("postgres_changes",{event:"*",schema:"public",table:"session_participants",filter:`session_id=eq.${n}`},P=>{console.log("[TeacherControl] Participant change detected:",P),console.log("[TeacherControl] Event type:",P.eventType),console.log("[TeacherControl] New data:",P.new),console.log("[TeacherControl] Old data:",P.old),I()}).subscribe(P=>{console.log("[TeacherControl] Participant subscription status:",P),P==="SUBSCRIBED"?console.log("[TeacherControl] Successfully subscribed to participant changes"):P==="CHANNEL_ERROR"&&console.error("[TeacherControl] Error subscribing to participant channel")}),y=N.channel(`session-${n}-answers`).on("postgres_changes",{event:"INSERT",schema:"public",table:"quiz_answers",filter:`session_id=eq.${n}`},P=>{console.log("[TeacherControl] New answer detected:",P),console.log("[TeacherControl] Answer details:",{participant_id:P.new.participant_id,question_id:P.new.question_id,is_correct:P.new.is_correct}),I();const W=xe.current;console.log("[TeacherControl] Current active question:",W==null?void 0:W.id),W&&P.new.question_id===W.id?(console.log("[TeacherControl] Answer is for current question - reloading live answers"),Z(W.id)):console.log("[TeacherControl] Answer is NOT for current question - ignoring")}).subscribe(P=>{console.log("[TeacherControl] Answer subscription status:",P),P==="SUBSCRIBED"?console.log("[TeacherControl] Successfully subscribed to answer changes"):P==="CHANNEL_ERROR"&&console.error("[TeacherControl] Error subscribing to answer channel")});return()=>{console.log("[TeacherControl] Cleaning up realtime subscriptions"),x.unsubscribe(),y.unsubscribe()}},ne=async x=>{try{console.log("[TeacherControl] Selecting mode:",x,"for session:",n);const{data:y,error:P}=await N.from("quiz_sessions").update({mode:x}).eq("id",n).select();if(console.log("[TeacherControl] Mode update result:",{data:y,error:P}),P){console.error("[TeacherControl] Error updating mode:",P),me({isOpen:!0,title:t("common.error"),message:t("teacher.errorSettingMode")+": "+P.message,type:"error"});return}console.log("[TeacherControl] Mode updated successfully to:",x),ie(x),J(!1);const W={...s,mode:x};a(W),await I(W)}catch(y){console.error("[TeacherControl] Exception in selectMode:",y),me({isOpen:!0,title:t("common.error"),message:t("teacher.errorSettingMode")+": "+y.message,type:"error"})}},ye=async()=>{try{console.log("[startQuiz] Starting quiz, sessionId:",n),console.log("[startQuiz] Current session state:",s);const{data:x,error:y}=await N.from("quiz_sessions").select("*").eq("id",n).single();if(console.log("[startQuiz] Existing session check:",{existingSession:x,checkError:y}),y){console.error("[startQuiz] Failed to fetch session:",y),me({isOpen:!0,title:t("errors.errorStartingQuiz"),message:`${t("teacher.cannotAccessSession")}: ${y.message}`,type:"error"});return}const P={status:"active"};!s.question_order&&O&&(P.question_order=O);const{data:W,error:p}=await N.from("quiz_sessions").update(P).eq("id",n).select();if(console.log("[startQuiz] Update result:",{data:W,error:p}),p){console.error("[startQuiz] Update error:",p),me({isOpen:!0,title:t("errors.errorStartingQuiz"),message:`${t("teacher.failedToStartQuiz")}: ${p.message}

${t("teacher.details")}: ${JSON.stringify(p,null,2)}`,type:"error"});return}console.log("[startQuiz] Quiz started successfully"),a({...s,status:"active",question_order:O}),B(5),setTimeout(()=>{le(0)},5e3)}catch(x){console.error("[startQuiz] Unexpected error:",x),me({isOpen:!0,title:t("common.error"),message:t("errors.errorStartingQuiz")+": "+x.message,type:"error"})}},le=async x=>{const y=u.length>0?u:l;if(x>=y.length){await je();return}try{const P=y[x];await N.from("quiz_sessions").update({current_question_index:x,status:"question_active"}).eq("id",n),q&&clearTimeout(q),w(P),Q(!1),E([]),de(P.time_limit),re(!1),a({...s,current_question_index:x,status:"question_active"}),await Z(P.id);const W=setTimeout(()=>{ze(x)},P.time_limit*1e3);Y(W)}catch(P){me({isOpen:!0,title:t("common.error"),message:t("teacher.errorShowingQuestion")+": "+P.message,type:"error"})}},ze=async x=>{try{const y=u.length>0?u:l,{data:P,error:W}=await N.from("quiz_answers").select("*, session_participants(users(name))").eq("session_id",n).eq("question_id",y[x].id);if(W)throw W;await N.from("quiz_sessions").update({status:"showing_results"}).eq("id",n),R(P||[]),Q(!0),a({...s,status:"showing_results"})}catch(y){me({isOpen:!0,title:t("common.error"),message:t("teacher.errorLoadingResults")+": "+y.message,type:"error"})}},_e=()=>{const x=s.current_question_index+1;le(x)},je=async()=>{try{await N.from("quiz_sessions").update({status:"completed"}).eq("id",n),a({...s,status:"completed"})}catch(x){me({isOpen:!0,title:"Error",message:"Error ending quiz: "+x.message,type:"error"})}},be=async()=>{we({isOpen:!0,title:"End Session",message:"Are you sure you want to end this session?",onConfirm:async()=>{we({...pe,isOpen:!1}),await je(),r("manage-quizzes")}})},ke=()=>{if(k!=null&&k.background_image_url)return{style:{backgroundImage:`url(${k.background_image_url})`,backgroundSize:"cover",backgroundPosition:"center"},overlay:!0};if(k&&(k.primary_color||k.secondary_color)){const x=k.primary_color||"#7C3AED",y=k.secondary_color||x;return{style:{background:`linear-gradient(135deg, ${x}, ${y})`},overlay:!1}}return i!=null&&i.background_image_url?{style:{backgroundImage:`url(${i.background_image_url})`,backgroundSize:"cover",backgroundPosition:"center"},overlay:!0}:{style:{background:"linear-gradient(135deg, #7C3AED, #2563EB)"},overlay:!1}},ve=c.useMemo(ke,[k,i]),U=(x,y={})=>{const{overlayStrength:P=.45}=y,W=ve.overlay;return e.jsx(V,{children:e.jsxs("div",{className:"min-h-screen relative",style:ve.style,children:[W&&e.jsx("div",{className:"absolute inset-0",style:{backgroundColor:`rgba(0, 0, 0, ${P})`}}),e.jsx("div",{className:"relative z-10 min-h-screen flex flex-col",children:x})]})})},V=({children:x})=>e.jsxs(e.Fragment,{children:[x,e.jsx(Ie,{isOpen:ge.isOpen,title:ge.title,message:ge.message,type:ge.type,onClose:()=>me({...ge,isOpen:!1})}),e.jsx(Le,{isOpen:pe.isOpen,title:pe.title,message:pe.message,onConfirm:pe.onConfirm,onCancel:()=>we({...pe,isOpen:!1}),confirmStyle:"danger"})]});if(v)return e.jsx(V,{children:e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("p",{className:"text-xl text-gray-600",children:"Loading session..."})})});if(D)return e.jsx(V,{children:e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-xl text-red-600 mb-4",children:["Error: ",D]}),e.jsx("button",{onClick:()=>r("manage-quizzes"),className:"bg-blue-700 text-white px-6 py-3 rounded-lg hover:bg-blue-800",children:"Back to Quizzes"})]})})});if(s.status==="waiting"&&G)return U(e.jsxs(e.Fragment,{children:[e.jsxs("nav",{className:"bg-white shadow-md p-4 flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-blue-700",children:i.title}),e.jsx("button",{onClick:be,className:"text-red-600 hover:text-red-700",children:e.jsx(Te,{size:24})})]}),e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"container mx-auto p-6 flex flex-col items-center justify-center min-h-[80vh]",children:e.jsxs("div",{className:"bg-white/95 backdrop-blur-sm rounded-2xl shadow-2xl p-12 text-center max-w-4xl w-full",children:[e.jsx("h2",{className:"text-4xl font-bold mb-4",children:"Select Quiz Mode"}),e.jsx("p",{className:"text-gray-600 mb-8",children:"Choose how you want students to participate"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{onClick:()=>ne("classic"),className:"border-2 border-gray-300 rounded-xl p-8 hover:border-blue-700 hover:shadow-lg transition cursor-pointer group bg-white",children:[e.jsx("div",{className:"text-6xl mb-4",children:"🎯"}),e.jsx("h3",{className:"text-2xl font-bold mb-3 group-hover:text-blue-700",children:"Classic Mode"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Students join individually using the PIN and compete on their own."}),e.jsxs("ul",{className:"text-left text-sm text-gray-600 space-y-2",children:[e.jsx("li",{children:"✓ Individual scores"}),e.jsx("li",{children:"✓ Personal leaderboard"}),e.jsx("li",{children:"✓ Quick setup"})]})]}),e.jsxs("div",{onClick:()=>ne("team"),className:"border-2 border-gray-300 rounded-xl p-8 hover:border-blue-600 hover:shadow-lg transition cursor-pointer group bg-white",children:[e.jsx("div",{className:"text-6xl mb-4",children:"👥"}),e.jsx("h3",{className:"text-2xl font-bold mb-3 group-hover:text-blue-600",children:"Team Mode"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Students form teams with custom names and compete together."}),e.jsxs("ul",{className:"text-left text-sm text-gray-600 space-y-2",children:[e.jsx("li",{children:"✓ Team collaboration"}),e.jsx("li",{children:"✓ Custom team names"}),e.jsx("li",{children:"✓ Combined scores"})]})]})]})]})})})]}));if(s.status==="waiting"&&!G){const x=s.mode==="team";return U(e.jsxs(e.Fragment,{children:[e.jsxs("nav",{className:"bg-white shadow-md p-4 flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-blue-700",children:i.title}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:`px-4 py-2 rounded-lg font-semibold ${x?"bg-blue-100 text-blue-800":"bg-blue-50 text-blue-800"}`,children:x?"Team Mode":"Classic Mode"}),e.jsx("button",{onClick:be,className:"text-red-600 hover:text-red-700",children:e.jsx(Te,{size:24})})]})]}),e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"container mx-auto p-6 flex flex-col items-center justify-center min-h-[80vh]",children:e.jsxs("div",{className:"bg-white/95 backdrop-blur-sm rounded-2xl shadow-2xl p-12 text-center max-w-2xl w-full",children:[e.jsx("h2",{className:"text-4xl font-bold mb-6",children:"Join at QuizMaster"}),e.jsxs("div",{className:"bg-gray-100 rounded-xl p-8 mb-6",children:[e.jsx("p",{className:"text-gray-600 text-xl mb-2",children:"Game PIN:"}),e.jsx("p",{className:"text-7xl font-bold text-blue-700",children:s.pin})]}),x?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-center gap-3 mb-8",children:[e.jsx(Oe,{className:"text-blue-600",size:32}),e.jsx("p",{className:"text-3xl font-bold",children:b.length}),e.jsx("p",{className:"text-xl text-gray-600",children:"teams joined"}),e.jsx("button",{onClick:I,className:"ml-2 p-2 text-blue-600 hover:text-blue-800 hover:bg-blue-50 rounded-lg transition-colors",title:"Refresh team count",children:e.jsx(Kt,{size:24})})]}),b.length>0&&e.jsx("div",{className:"mb-6 max-h-60 overflow-y-auto",children:e.jsx("div",{className:"space-y-3",children:b.map((y,P)=>e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("div",{className:"font-bold text-lg text-blue-900 mb-2",children:y.name}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Members: ",y.members.map(W=>{var p;return((p=W.users)==null?void 0:p.name)||W.player_name}).join(", ")]})]},P))})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-center gap-3 mb-8",children:[e.jsx(Oe,{className:"text-blue-600",size:32}),e.jsx("p",{className:"text-3xl font-bold",children:m.length}),e.jsx("p",{className:"text-xl text-gray-600",children:m.filter(y=>y.is_team_entry===!0).length>0?"participants":"players"}),e.jsx("button",{onClick:I,className:"ml-2 p-2 text-blue-600 hover:text-blue-800 hover:bg-blue-50 rounded-lg transition-colors",title:"Refresh participant count",children:e.jsx(Kt,{size:24})})]}),m.length>0&&e.jsx("div",{className:"mb-6 max-h-60 overflow-y-auto",children:e.jsx("div",{className:"space-y-2",children:m.map(y=>{var P,W;return y.is_team_entry===!0&&y.teams?e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[e.jsx("div",{className:"font-bold text-lg text-blue-900",children:y.teams.team_name}),e.jsx("div",{className:"ml-4 mt-1 space-y-0.5",children:(P=y.teamMembers)==null?void 0:P.map((p,j)=>{var H;return e.jsxs("div",{className:"text-sm text-gray-600",children:["- ",((H=p.users)==null?void 0:H.name)||"Unknown"]},j)})})]},y.id):e.jsx("div",{className:"bg-gray-50 rounded-lg p-2 text-sm font-medium",children:((W=y.users)==null?void 0:W.name)||"Anonymous"},y.id)})})})]}),e.jsxs("button",{onClick:ye,disabled:x?b.length===0:m.length===0,className:"bg-green-600 text-white px-12 py-4 rounded-xl hover:bg-green-700 text-2xl font-bold disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-3 mx-auto",children:[e.jsx(zs,{size:32}),"Start Quiz"]}),(x&&b.length===0||!x&&m.length===0)&&e.jsxs("p",{className:"text-gray-500 mt-4",children:["Waiting for ",x?"teams":"players"," to join..."]})]})})})]}))}if(s.status==="active"&&!S)return U(e.jsxs(e.Fragment,{children:[e.jsxs("nav",{className:"bg-white shadow-md p-4 flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-blue-700",children:i.title}),e.jsx("button",{onClick:be,className:"text-red-600 hover:text-red-700",children:e.jsx(Te,{size:24})})]}),e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"container mx-auto p-6 flex items-center justify-center min-h-[80vh]",children:e.jsxs("div",{className:"bg-white/95 backdrop-blur-sm rounded-2xl shadow-2xl p-12 text-center max-w-md w-full",children:[e.jsx("h2",{className:"text-4xl font-bold text-gray-800 mb-8",children:i.title}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-gray-600 mb-4",children:"Starting in..."}),e.jsx("div",{className:"text-8xl font-bold text-blue-700 animate-pulse",children:T})]}),e.jsx("p",{className:"text-sm text-gray-500 mt-6",children:"Get ready! The first question will appear shortly."})]})})})]}));if(s.status==="question_active"&&S)return U(e.jsxs(e.Fragment,{children:[e.jsxs("nav",{className:"bg-white shadow-md p-4 flex justify-between items-center",children:[e.jsx("h1",{className:"text-xl font-bold text-blue-700",children:i.title}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-blue-50 px-4 py-2 rounded-lg",children:[e.jsx(Ze,{size:20,className:"text-blue-700"}),e.jsxs("span",{className:"text-2xl font-bold text-blue-700",children:[se,"s"]})]}),e.jsxs("span",{className:"text-gray-600",children:["Question ",s.current_question_index+1," of ",l.length]}),e.jsx("button",{onClick:be,className:"text-red-600 hover:text-red-700",children:e.jsx(Te,{size:24})})]})]}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsxs("div",{className:"bg-white/95 backdrop-blur-sm rounded-2xl shadow-2xl p-8 mb-6",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsxs("p",{className:"text-gray-600 mb-4",children:["Time: ",S.time_limit,"s"]}),e.jsx("h2",{className:"text-4xl font-bold mb-6",children:S.question_text}),S.image_url&&e.jsx("img",{src:S.image_url,alt:"Question",className:"max-w-md mx-auto rounded-lg shadow-lg mb-4"}),S.video_url&&e.jsx(pt,{src:S.video_url,className:"max-w-md mx-auto rounded-lg shadow-lg mb-4",reloadKey:S.id}),S.gif_url&&e.jsx("img",{src:S.gif_url,alt:"GIF",className:"max-w-md mx-auto rounded-lg shadow-lg mb-4"})]}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:(ee=S.options)==null?void 0:ee.map((x,y)=>{const W=[{bg:"bg-red-500",icon:gt},{bg:"bg-blue-600",icon:xt},{bg:"bg-orange-500",icon:ht},{bg:"bg-green-500",icon:mt}][y],p=W.icon;return e.jsxs("div",{className:`${W.bg} text-white p-8 rounded-lg text-center text-2xl font-bold flex flex-col md:flex-row items-center justify-center gap-3 relative`,children:[e.jsx(p,{size:28,className:"shrink-0",fill:"white"}),e.jsx("span",{className:"text-center",children:x.text})]},y)})})]}),e.jsx("div",{className:"bg-white/95 backdrop-blur-sm rounded-xl shadow-lg p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Oe,{size:24}),e.jsxs("span",{className:"text-xl font-semibold",children:[m.filter(x=>$.some(y=>y.participant_id===x.id)).length," ","/ ",m.length," answered"]})]}),oe?e.jsx("div",{className:"bg-green-100 text-green-800 px-6 py-3 rounded-lg font-semibold animate-pulse",children:"All answered! Showing results..."}):e.jsx("div",{className:"text-gray-600 text-sm",children:"Waiting for all students..."})]})})]})})]}));if(s.status==="showing_results"&&S){(te=S.options)==null||te.find(y=>y.is_correct);const x={};return(fe=S.options)==null||fe.forEach((y,P)=>{x[P]=0}),M.forEach(y=>{y.selected_option_index!==null&&x[y.selected_option_index]++}),U(e.jsxs(e.Fragment,{children:[e.jsxs("nav",{className:"bg-white shadow-md p-4 flex justify-between items-center",children:[e.jsx("h1",{className:"text-xl font-bold text-blue-700",children:i.title}),e.jsx("button",{onClick:be,className:"text-red-600 hover:text-red-700",children:e.jsx(Te,{size:24})})]}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsxs("div",{className:"bg-white/95 backdrop-blur-sm rounded-2xl shadow-2xl p-8 mb-6",children:[e.jsx("h2",{className:"text-3xl font-bold text-center mb-6",children:S.question_text}),S.image_url&&e.jsx("img",{src:S.image_url,alt:"Question",className:"max-w-md mx-auto rounded-lg shadow-lg mb-6"}),S.video_url&&e.jsx(pt,{src:S.video_url,className:"max-w-md mx-auto rounded-lg shadow-lg mb-6",reloadKey:S.id}),S.gif_url&&e.jsx("img",{src:S.gif_url,alt:"GIF",className:"max-w-md mx-auto rounded-lg shadow-lg mb-6"}),e.jsx("div",{className:"grid grid-cols-2 gap-4 mb-8",children:(Ce=S.options)==null?void 0:Ce.map((y,P)=>{const p=[{bg:"bg-red-500",icon:gt},{bg:"bg-blue-600",icon:xt},{bg:"bg-orange-500",icon:ht},{bg:"bg-green-500",icon:mt}][P],j=p.icon,H=y.is_correct;return e.jsxs("div",{className:`${p.bg} ${H?"ring-4 ring-white":"opacity-60"} text-white p-6 rounded-lg relative`,children:[e.jsx(j,{size:24,className:"absolute left-4 top-4",fill:"white"}),e.jsx("div",{className:"text-xl font-bold mb-2 mt-8",children:y.text}),e.jsxs("div",{className:"text-lg",children:[x[P]," answer",x[P]!==1?"s":""]}),H&&e.jsx("div",{className:"absolute top-2 right-2 bg-white text-green-600 rounded-full p-2 font-bold",children:"✓"})]},P)})}),e.jsx("div",{className:"flex justify-center",children:s.current_question_index<l.length-1?e.jsxs("button",{onClick:_e,className:"bg-blue-600 text-white px-12 py-4 rounded-xl hover:bg-blue-700 text-xl font-bold flex items-center gap-3",children:["Next Question",e.jsx(Ss,{size:24})]}):e.jsxs("button",{onClick:je,className:"bg-blue-700 text-white px-12 py-4 rounded-xl hover:bg-blue-800 text-xl font-bold flex items-center gap-3",children:[e.jsx($e,{size:24}),"Show Final Results"]})})]}),e.jsxs("div",{className:"bg-white/95 backdrop-blur-sm rounded-xl shadow-lg p-6",children:[e.jsx("h3",{className:"text-2xl font-bold mb-4 text-center",children:"Leaderboard"}),e.jsx("div",{className:"space-y-2",children:m.slice(0,5).map((y,P)=>{var W,p,j;return e.jsxs("div",{className:"flex items-center justify-between bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-2xl font-bold text-gray-400",children:["#",P+1]}),((W=y.users)==null?void 0:W.avatar_url)&&e.jsx("img",{src:y.users.avatar_url,alt:((p=y.users)==null?void 0:p.name)||"Avatar",className:"w-10 h-10 rounded-full object-cover"}),e.jsx("span",{className:"text-lg font-semibold",children:((j=y.users)==null?void 0:j.name)||"Anonymous"})]}),e.jsxs("span",{className:"text-xl font-bold text-blue-700",children:[y.score," pts"]})]},y.id)})})]})]})})]}))}if(s.status==="completed"){const x=m.slice(0,3);return U(e.jsxs(e.Fragment,{children:[e.jsxs("nav",{className:"bg-white shadow-md p-4 flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-blue-700",children:i.title}),e.jsx("button",{onClick:()=>r("manage-quizzes"),className:"bg-blue-700 text-white px-4 py-2 rounded-lg hover:bg-blue-800",children:"Back to Quizzes"})]}),e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"container mx-auto p-6",children:e.jsxs("div",{className:"bg-white/95 backdrop-blur-sm rounded-2xl shadow-2xl p-12 mb-6",children:[e.jsx($e,{className:"mx-auto mb-6 text-yellow-500",size:80}),e.jsx("h2",{className:"text-4xl font-bold mb-12 text-center",children:"Quiz Complete!"}),x.length>=3&&e.jsx(Wr,{winners:x}),e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsx("h3",{className:"text-2xl font-bold mb-4 text-center",children:"Final Rankings"}),e.jsx("div",{className:"space-y-3",children:m.map((y,P)=>{var W,p,j;return e.jsxs("div",{className:`flex items-center justify-between p-4 rounded-xl ${P===0?"bg-yellow-100 border-2 border-yellow-500":P===1?"bg-gray-100 border-2 border-gray-400":P===2?"bg-orange-100 border-2 border-orange-400":"bg-gray-50"}`,children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"text-3xl font-bold",children:P===0?"🥇":P===1?"🥈":P===2?"🥉":`#${P+1}`}),((W=y.users)==null?void 0:W.avatar_url)&&e.jsx("img",{src:y.users.avatar_url,alt:((p=y.users)==null?void 0:p.name)||"Avatar",className:"w-12 h-12 rounded-full object-cover"}),e.jsx("span",{className:"text-xl font-semibold",children:((j=y.users)==null?void 0:j.name)||"Anonymous"})]}),e.jsxs("span",{className:"text-2xl font-bold text-blue-700",children:[y.score," pts"]})]},y.id)})})]}),e.jsx("div",{className:"flex justify-center mt-8",children:e.jsx("button",{onClick:()=>r("manage-quizzes"),className:"bg-blue-700 text-white px-8 py-3 rounded-lg hover:bg-blue-800 text-xl font-semibold",children:"Back to Dashboard"})})]})})})]}))}return null}function Gr({quizId:n,setView:r,returnView:t="manage-quizzes"}){var pe,we;const[s,a]=c.useState(null),[i,o]=c.useState(null),[l,d]=c.useState([]),[u,g]=c.useState(0),[m,h]=c.useState(null),[b,z]=c.useState(!1),[k,f]=c.useState(0),[S,w]=c.useState(0),[O,A]=c.useState(!0),[C,Q]=c.useState(null),[M,R]=c.useState(!1),[$,E]=c.useState(!1),[v,_]=c.useState(!1),[D,F]=c.useState(5),[G,J]=c.useState(!0),[X,ie]=c.useState({isOpen:!1,title:"",message:"",type:"info"}),[T,B]=c.useState({isOpen:!1,title:"",message:"",onConfirm:null});c.useEffect(()=>{se()},[n]);const se=async()=>{try{if(!n){Q("No quiz ID provided"),A(!1);return}const{data:xe,error:L}=await N.from("quizzes").select("*").eq("id",n).single();if(L)throw L;if(a(xe),xe.theme_id){const{data:K,error:ne}=await N.from("themes").select("*").eq("id",xe.theme_id).single();!ne&&K&&o(K)}const{data:I,error:Z}=await N.from("questions").select("*").eq("quiz_id",n).order("order_index",{ascending:!0});if(Z)throw Z;if(!I||I.length===0){Q("This quiz has no questions yet."),A(!1);return}d(I),f(I[0].time_limit),A(!1),J(!0),F(5)}catch(xe){Q(xe.message),A(!1)}},q=(()=>i!=null&&i.background_image_url?{backgroundImage:`url(${i.background_image_url})`,backgroundSize:"cover",backgroundPosition:"center",backgroundAttachment:"fixed"}:i?{background:`linear-gradient(135deg, ${i.primary_color}, ${i.secondary_color})`}:s!=null&&s.background_image_url?{backgroundImage:`url(${s.background_image_url})`,backgroundSize:"cover",backgroundPosition:"center",backgroundAttachment:"fixed"}:{background:"linear-gradient(135deg, #7C3AED, #2563EB)"})();c.useEffect(()=>{if(G&&D>0){const xe=setTimeout(()=>{F(D-1)},1e3);return()=>clearTimeout(xe)}else G&&D===0&&J(!1)},[G,D]),c.useEffect(()=>{if(k>0&&!b&&!M&&!v){const xe=setInterval(()=>{f(L=>L<=1?(clearInterval(xe),0):L-1)},1e3);return()=>clearInterval(xe)}},[k,b,M,v]);const Y=xe=>{if(b)return;const L=l[u];h(xe),z(!0);const I=L.options[xe].is_correct;if(E(I),I){const Z=Math.floor(k/L.time_limit*100),K=L.points+Z;w(S+K)}R(!0)},oe=()=>{u<l.length-1?(g(u+1),h(null),z(!1),R(!1),E(!1),f(l[u+1].time_limit)):_(!0)},re=()=>{B({isOpen:!0,title:"Quit Preview",message:"Are you sure you want to quit the preview? Your progress will be lost.",onConfirm:async()=>{B({...T,isOpen:!1}),r(t)}})};if(O)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",style:q,children:e.jsx("p",{className:"text-2xl text-white",children:"Loading preview..."})});if(C)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center bg-white rounded-2xl shadow-2xl p-12 max-w-md",children:[e.jsxs("p",{className:"text-xl text-red-600 mb-4",children:["Error: ",C]}),e.jsx("button",{onClick:()=>r(t),className:"bg-blue-700 text-white px-6 py-3 rounded-lg hover:bg-blue-800",children:"Back"})]})});if(v)return e.jsxs("div",{className:"min-h-screen",style:q,children:[e.jsxs("nav",{className:"bg-white/95 backdrop-blur-sm shadow-md p-4 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Preview Mode"}),e.jsx("h1",{className:"text-xl font-bold text-blue-700",children:s.title})]}),e.jsx("button",{onClick:()=>r(t),className:"bg-blue-700 text-white px-4 py-2 rounded-lg hover:bg-blue-800",children:"Exit Preview"})]}),e.jsx("div",{className:"container mx-auto p-6 flex items-center justify-center min-h-[80vh]",children:e.jsxs("div",{className:"bg-white/95 backdrop-blur-sm rounded-2xl shadow-2xl p-12 text-center max-w-md w-full",children:[e.jsx($e,{className:"mx-auto mb-6 text-yellow-500",size:80}),e.jsx("h2",{className:"text-4xl font-bold mb-6",children:"Preview Complete!"}),e.jsxs("div",{className:"bg-blue-50 rounded-xl p-8 mb-6",children:[e.jsx("p",{className:"text-gray-600 mb-2",children:"Final Score"}),e.jsx("p",{className:"text-5xl font-bold text-blue-700",children:S}),e.jsx("p",{className:"text-gray-600 mt-2",children:"points"})]}),e.jsxs("p",{className:"text-gray-600 mb-6",children:["You answered ",l.length," question",l.length!==1?"s":""]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{g(0),h(null),z(!1),R(!1),E(!1),w(0),_(!1),f(l[0].time_limit),J(!0),F(5)},className:"flex-1 bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 font-semibold",children:"Try Again"}),e.jsx("button",{onClick:()=>r(t),className:"flex-1 bg-blue-700 text-white px-6 py-3 rounded-lg hover:bg-blue-800 font-semibold",children:"Exit Preview"})]})]})})]});if(G)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",style:q,children:e.jsx("div",{className:"text-center",children:e.jsxs("div",{className:"bg-white/95 backdrop-blur-sm rounded-2xl shadow-2xl p-12 max-w-md",children:[e.jsx("div",{className:"mb-6",children:e.jsx("span",{className:"px-4 py-2 bg-green-100 text-green-800 rounded-full text-sm font-semibold",children:"PREVIEW MODE"})}),e.jsx("h1",{className:"text-4xl font-bold text-gray-800 mb-8",children:s==null?void 0:s.title}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-gray-600 mb-4",children:"Starting in..."}),e.jsx("div",{className:"text-8xl font-bold animate-pulse",style:{color:(i==null?void 0:i.primary_color)||"#7C3AED"},children:D})]}),e.jsx("p",{className:"text-sm text-gray-500 mt-6",children:"Get ready! The quiz will begin shortly."})]})})});const ge=l[u],me=[{bg:"bg-red-500",hover:"hover:bg-red-600",ring:"ring-red-400",icon:gt},{bg:"bg-blue-600",hover:"hover:bg-blue-700",ring:"ring-blue-400",icon:xt},{bg:"bg-orange-500",hover:"hover:bg-orange-600",ring:"ring-orange-400",icon:ht},{bg:"bg-green-500",hover:"hover:bg-green-600",ring:"ring-green-400",icon:mt}];return e.jsxs("div",{className:"min-h-screen",style:q,children:[e.jsx("nav",{className:"bg-white/95 backdrop-blur-sm shadow-md p-4",children:e.jsxs("div",{className:"container mx-auto flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm font-semibold",children:"PREVIEW MODE"}),e.jsx("h1",{className:"text-xl font-bold text-blue-700",children:s.title})]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Question ",u+1," of ",l.length]})]}),e.jsxs("button",{onClick:re,className:"flex items-center gap-2 bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700",children:[e.jsx(Te,{size:20}),"Exit Preview"]})]})}),e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("div",{className:"bg-white/95 backdrop-blur-sm rounded-xl shadow-lg p-4 mb-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ze,{size:24,className:"text-blue-700"}),e.jsxs("span",{className:"text-3xl font-bold text-blue-700",children:[k,"s"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Preview Score"}),e.jsx("p",{className:"text-2xl font-bold text-blue-700",children:S})]})]})}),e.jsxs("div",{className:"bg-white/95 backdrop-blur-sm rounded-2xl shadow-2xl p-6 mb-4",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h2",{className:"text-3xl font-bold mb-4",children:ge.question_text}),ge.image_url&&e.jsx("img",{src:ge.image_url,alt:"Question",className:"max-w-md mx-auto rounded-lg shadow-lg mb-4"}),ge.video_url&&e.jsx(pt,{src:ge.video_url,className:"max-w-md mx-auto rounded-lg shadow-lg mb-4",reloadKey:ge.id}),ge.gif_url&&e.jsx("img",{src:ge.gif_url,alt:"GIF",className:"max-w-md mx-auto rounded-lg shadow-lg mb-4"})]}),M?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:(we=ge.options)==null?void 0:we.map((xe,L)=>{const I=me[L],Z=I.icon,K=xe.is_correct;return e.jsxs("div",{className:`${I.bg} ${K?"ring-4 ring-white":"opacity-60"} text-white p-6 rounded-lg relative`,children:[e.jsx(Z,{size:24,className:"absolute left-4 top-4",fill:"white"}),e.jsx("div",{className:"text-xl font-bold mt-8",children:xe.text}),K&&e.jsx("div",{className:"absolute top-2 right-2 bg-white text-green-600 rounded-full p-2 font-bold",children:"✓"}),m===L&&!K&&e.jsx("div",{className:"absolute top-2 right-2 bg-white text-red-600 rounded-full p-2 font-bold",children:"✗"})]},L)})}),e.jsxs("div",{className:`p-4 rounded-xl text-center mb-4 ${$?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:[e.jsx("p",{className:"text-2xl font-bold",children:$?"✓ Correct!":"✗ Incorrect"}),e.jsx("p",{className:"text-lg",children:$?`+${ge.points} points!`:"Better luck next time!"})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx("button",{onClick:oe,className:"bg-blue-600 text-white px-12 py-4 rounded-xl hover:bg-blue-700 text-xl font-bold flex items-center gap-3",children:u<l.length-1?e.jsxs(e.Fragment,{children:["Next Question",e.jsx(Ss,{size:24})]}):e.jsxs(e.Fragment,{children:[e.jsx($e,{size:24}),"Finish Preview"]})})})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:(pe=ge.options)==null?void 0:pe.map((xe,L)=>{const I=me[L],Z=I.icon;return e.jsxs("button",{onClick:()=>Y(L),disabled:b||k===0,className:`${I.bg} ${!b&&k>0?I.hover:""} ${m===L?`ring-4 ${I.ring}`:""} text-white p-6 md:p-8 rounded-lg text-xl md:text-2xl font-bold transition-all disabled:opacity-60 disabled:cursor-not-allowed flex flex-col md:flex-row items-center justify-center gap-3 relative`,children:[e.jsx(Z,{size:28,className:"shrink-0",fill:"white"}),e.jsx("span",{className:"text-center",children:xe.text})]},L)})}),!b&&k===0&&!M&&e.jsxs("div",{className:"mt-6 p-4 rounded-xl text-center bg-gray-100 text-gray-800",children:[e.jsx("p",{className:"text-2xl font-bold",children:"Time's up!"}),e.jsx("button",{onClick:oe,className:"mt-4 bg-blue-600 text-white px-8 py-3 rounded-lg hover:bg-blue-700 font-semibold",children:"Continue"})]})]})]}),e.jsx(Ie,{isOpen:X.isOpen,title:X.title,message:X.message,type:X.type,onClose:()=>ie({...X,isOpen:!1})}),e.jsx(Le,{isOpen:T.isOpen,title:T.title,message:T.message,onConfirm:T.onConfirm,onCancel:()=>B({...T,isOpen:!1}),confirmStyle:"danger"})]})}function Yr({setView:n,appState:r}){var W;const{t}=qe(),[s,a]=c.useState([]),[i,o]=c.useState([]),[l,d]=c.useState(new Set),[u,g]=c.useState(!0),[m,h]=c.useState(null),[b,z]=c.useState({}),[k,f]=c.useState(!1),[S,w]=c.useState(""),[O,A]=c.useState(null),[C,Q]=c.useState(null),[M,R]=c.useState(null),[$,E]=c.useState(null),[v,_]=c.useState(null),[D,F]=c.useState(null),[G,J]=c.useState(""),[X,ie]=c.useState(new Set),[T,B]=c.useState("created_at"),[se,de]=c.useState(null),[q,Y]=c.useState({isOpen:!1,title:"",message:"",type:"info"}),[oe,re]=c.useState({isOpen:!1,title:"",message:"",onConfirm:null});c.useEffect(()=>{(async()=>{const j=await ge();await me(j),await pe()})()},[]);const ge=async()=>{try{const{data:p,error:j}=await N.from("themes").select("id, name, background_image_url, primary_color, secondary_color, text_color");if(j)throw j;const H={};return(p||[]).forEach(ce=>{H[ce.id]=ce}),z(H),H}catch(p){return console.error("Error fetching themes:",p.message),{}}},me=async(p=b)=>{try{const{data:j}=await N.auth.getUser();if(!(j!=null&&j.user)){h(t("errors.notAuthenticated"));return}const{data:H,error:ce}=await N.from("quizzes").select("id, title, theme_id, background_image_url, category_id, folder_id, created_at, categories(name), questions(id)").eq("created_by",j.user.id).order("created_at",{ascending:!1});if(ce)throw ce;const he=(H||[]).map(Ne=>{var Qe;return{...Ne,questionCount:((Qe=Ne.questions)==null?void 0:Qe.length)||0,themeDetails:p[Ne.theme_id]||null}});a(he)}catch(j){h(j.message)}finally{g(!1)}},pe=async()=>{try{const{data:p}=await N.auth.getUser();if(!(p!=null&&p.user))return;const{data:j,error:H}=await N.from("quiz_folders").select("*").eq("created_by",p.user.id).order("order_index",{ascending:!0});if(H)throw H;o(j||[])}catch(p){console.error("Error fetching folders:",p.message)}},we=p=>{d(j=>{const H=new Set(j);return H.has(p)?H.delete(p):H.add(p),H})},xe=async()=>{if(S.trim())try{const{data:p}=await N.auth.getUser(),{error:j}=await N.from("quiz_folders").insert([{name:S,parent_folder_id:O,created_by:p.user.id}]);if(j)throw j;await pe(),f(!1),w(""),A(null)}catch(p){Y({isOpen:!0,title:t("common.error"),message:t("errors.errorCreatingFolder")+": "+p.message,type:"error"})}},L=async(p,j)=>{if(j.trim())try{const{error:H}=await N.from("quiz_folders").update({name:j}).eq("id",p);if(H)throw H;await pe(),Q(null)}catch(H){Y({isOpen:!0,title:t("common.error"),message:t("errors.errorRenamingFolder")+": "+H.message,type:"error"})}},I=p=>{re({isOpen:!0,title:t("folder.deleteFolder"),message:t("manager.deleteFolderConfirm"),onConfirm:async()=>{re({...oe,isOpen:!1});try{const{error:j}=await N.from("quiz_folders").delete().eq("id",p);if(j)throw j;await pe(),await me(),R(null)}catch(j){Y({isOpen:!0,title:t("common.error"),message:t("errors.errorDeletingFolder")+": "+j.message,type:"error"})}}})},Z=async(p,j)=>{try{const{error:H}=await N.from("quizzes").update({folder_id:j}).eq("id",p);if(H)throw H;await me(),E(null)}catch(H){Y({isOpen:!0,title:t("common.error"),message:t("errors.errorMovingQuiz")+": "+H.message,type:"error"})}},K=(p,j,H)=>{_({item:j,type:H}),p.dataTransfer.effectAllowed="move"},ne=p=>{p.preventDefault(),p.dataTransfer.dropEffect="move"},ye=async(p,j)=>{if(p.preventDefault(),p.stopPropagation(),!!v)try{if(v.type==="quiz")await Z(v.item.id,(j==null?void 0:j.id)||null);else if(v.type==="folder"){if(v.item.id===(j==null?void 0:j.id)){Y({isOpen:!0,title:t("common.error"),message:t("manager.cannotMoveIntoItself"),type:"error"});return}let H=j==null?void 0:j.parent_folder_id;for(;H;){if(H===v.item.id){Y({isOpen:!0,title:t("common.error"),message:t("manager.cannotMoveIntoSubfolder"),type:"error"});return}const he=i.find(Ne=>Ne.id===H);H=he==null?void 0:he.parent_folder_id}const{error:ce}=await N.from("quiz_folders").update({parent_folder_id:(j==null?void 0:j.id)||null}).eq("id",v.item.id);if(ce)throw ce;await pe()}}catch(H){Y({isOpen:!0,title:t("common.error"),message:t("errors.errorMovingItem")+": "+H.message,type:"error"})}finally{_(null)}},le=p=>{re({isOpen:!0,title:t("quiz.deleteQuiz"),message:t("manager.deleteQuizConfirm"),onConfirm:async()=>{re({...oe,isOpen:!1});try{const{error:j}=await N.from("quizzes").delete().eq("id",p);if(j)throw j;await me()}catch(j){Y({isOpen:!0,title:t("common.error"),message:t("errors.errorDeletingQuiz")+": "+j.message,type:"error"})}}})},ze=async p=>{try{const{data:j,error:H}=await N.from("quizzes").select("*").eq("id",p).single();if(H)throw H;const{data:ce,error:he}=await N.from("questions").select("*").eq("quiz_id",p);if(he)throw he;const{data:Ne,error:Qe}=await N.from("quizzes").insert([{title:`${j.title} (Copy)`,theme_id:j.theme_id||null,category_id:j.category_id,created_by:r.currentUser.id,background_image_url:j.background_image_url||null,randomize_questions:j.randomize_questions,randomize_answers:j.randomize_answers,is_template:j.is_template,is_public:j.is_public}]).select().single();if(Qe)throw Qe;if(ce&&ce.length>0){const Se=ce.map(Ae=>({quiz_id:Ne.id,question_text:Ae.question_text,question_type:Ae.question_type,time_limit:Ae.time_limit,points:Ae.points,options:Ae.options,image_url:Ae.image_url,video_url:Ae.video_url,gif_url:Ae.gif_url,order_index:Ae.order_index})),{error:Fe}=await N.from("questions").insert(Se);if(Fe)throw Fe}Y({isOpen:!0,title:t("common.success"),message:t("messages.quizDuplicatedSuccess"),type:"success"}),await me()}catch(j){Y({isOpen:!0,title:t("common.error"),message:t("errors.errorDuplicatingQuiz")+": "+j.message,type:"error"})}},_e=async p=>{try{const{data:j,error:H}=await N.from("questions").select("id").eq("quiz_id",p);if(H)throw H;if(!j||j.length===0){Y({isOpen:!0,title:t("quiz.noQuestions"),message:t("errors.noQuestions"),type:"error"});return}const ce=Math.floor(1e5+Math.random()*9e5).toString(),{data:he,error:Ne}=await N.from("quiz_sessions").insert([{quiz_id:p,pin:ce,status:"waiting",current_question_index:0,host_id:r.currentUser.id}]).select().single();if(Ne)throw Ne;n("teacher-control",he.id)}catch(j){Y({isOpen:!0,title:t("common.error"),message:t("errors.errorStartingQuiz")+": "+j.message,type:"error"})}},je=(p=null)=>i.filter(j=>j.parent_folder_id===p).sort((j,H)=>j.order_index-H.order_index),be=p=>s.filter(j=>j.folder_id===p),ke=()=>s.filter(p=>!p.folder_id),ve=()=>{let p=D==="unfiled"?ke():D?be(D):s;return G&&(p=p.filter(j=>j.title.toLowerCase().includes(G.toLowerCase()))),se&&(p=p.filter(j=>j.category_id===se)),T==="created_at"?p.sort((j,H)=>new Date(H.created_at)-new Date(j.created_at)):T==="title"&&p.sort((j,H)=>j.title.localeCompare(H.title)),p},U=p=>{ie(j=>{const H=new Set(j);return H.has(p)?H.delete(p):H.add(p),H})},V=()=>{const p=ve();ie(new Set(p.map(j=>j.id)))},ee=()=>{ie(new Set)},te=async p=>{try{const j=Array.from(X),{error:H}=await N.from("quizzes").update({folder_id:p}).in("id",j);if(H)throw H;await me(),ee(),E(null)}catch(j){Y({isOpen:!0,title:t("common.error"),message:t("errors.errorMovingQuizzes")+": "+j.message,type:"error"})}},fe=()=>{re({isOpen:!0,title:t("quiz.deleteQuiz"),message:t("manager.deleteQuizzesConfirm",{count:X.size}),onConfirm:async()=>{re({...oe,isOpen:!1});try{const p=Array.from(X),{error:j}=await N.from("quizzes").delete().in("id",p);if(j)throw j;await me(),ee()}catch(p){Y({isOpen:!0,title:t("common.error"),message:t("errors.errorDeletingQuizzes")+": "+p.message,type:"error"})}}})},Ce=(p,j=0)=>{const H=l.has(p.id),ce=je(p.id),he=be(p.id),Ne=ce.length>0||he.length>0,Qe=D===p.id;return e.jsxs("div",{style:{marginLeft:`${j*16}px`},children:[e.jsxs("div",{draggable:!0,onDragStart:Se=>K(Se,p,"folder"),onDragOver:ne,onDrop:Se=>ye(Se,p),onClick:()=>F(p.id),className:`flex items-center gap-2 py-2 px-3 rounded-lg group cursor-pointer transition-colors ${Qe?"bg-blue-50 text-blue-800 font-medium":"hover:bg-gray-200 text-gray-700"} ${(v==null?void 0:v.item.id)===p.id?"opacity-50":""}`,children:[e.jsx("button",{onClick:Se=>{Se.stopPropagation(),Ne&&we(p.id)},className:"p-1 hover:bg-gray-300 rounded",children:Ne?H?e.jsx(et,{size:16}):e.jsx(jr,{size:16}):e.jsx("span",{className:"w-4"})}),H?e.jsx(dt,{size:18,className:Qe?"text-blue-700":"text-yellow-600"}):e.jsx($t,{size:18,className:Qe?"text-blue-700":"text-yellow-600"}),C===p.id?e.jsx("input",{type:"text",defaultValue:p.name,autoFocus:!0,onClick:Se=>Se.stopPropagation(),onBlur:Se=>L(p.id,Se.target.value),onKeyDown:Se=>{Se.key==="Enter"&&L(p.id,Se.target.value),Se.key==="Escape"&&Q(null)},className:"flex-1 px-2 py-1 border rounded text-sm"}):e.jsx("span",{className:"flex-1 text-sm",children:p.name}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${Qe?"bg-blue-100 text-blue-800":"bg-gray-200 text-gray-600"}`,children:he.length}),e.jsxs("div",{className:"opacity-0 group-hover:opacity-100 flex gap-1",children:[e.jsx("button",{onClick:Se=>{Se.stopPropagation(),A(p.id),f(!0)},className:"p-1 hover:bg-gray-300 rounded transition",title:"Add subfolder",children:e.jsx(Rt,{size:14})}),e.jsx("button",{onClick:Se=>{Se.stopPropagation(),Q(p.id)},className:"p-1 hover:bg-gray-300 rounded transition",title:"Rename folder",children:e.jsx(rt,{size:14})}),e.jsx("button",{onClick:Se=>{Se.stopPropagation(),I(p.id)},className:"p-1 hover:bg-red-100 text-red-600 rounded transition",title:"Delete folder",children:e.jsx(He,{size:14})})]})]}),H&&e.jsxs("div",{children:[ce.map(Se=>Ce(Se,j+1)),he.length>0&&e.jsx("div",{className:"ml-8 mt-1 space-y-1",children:he.map(Se=>{const Fe=Se.themeDetails||b[Se.theme_id]||null,Ae=(Fe==null?void 0:Fe.background_image_url)||Se.background_image_url,Ms=Fe!=null&&Fe.primary_color?`linear-gradient(135deg, ${Fe.primary_color}, ${Fe.secondary_color||Fe.primary_color})`:"linear-gradient(135deg, #7C3AED, #2563EB)";return e.jsxs("div",{onClick:()=>F(p.id),className:"py-1.5 px-3 text-sm text-gray-700 hover:bg-gray-100 rounded cursor-pointer transition-colors flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full border border-white/60 shadow",style:{backgroundImage:Ae?`url(${Ae})`:void 0,backgroundSize:"cover",backgroundPosition:"center",background:Ae?void 0:Ms}}),e.jsx("span",{className:"flex-1",children:Se.title})]},Se.id)})})]})]},p.id)},x=p=>{if(!p)return t("theme.defaultTheme");const H=`theme.${p.toLowerCase()}`,ce=t(H);return ce===H?p:ce},y=p=>{const j=p.themeDetails||b[p.theme_id]||null,H=p.background_image_url;if(j!=null&&j.background_image_url)return{label:x(j.name),style:{backgroundImage:`url(${j.background_image_url})`,backgroundSize:"cover",backgroundPosition:"center"},textColor:j.text_color||"#FFFFFF",overlay:!0,isCustom:!1};if(j&&(j.primary_color||j.secondary_color)){const ce=j.primary_color||"#7C3AED",he=j.secondary_color||ce;return{label:x(j.name),style:{background:`linear-gradient(135deg, ${ce}, ${he})`},textColor:j.text_color||"#FFFFFF",overlay:!1,isCustom:!1}}return H?{label:t("theme.customTheme"),style:{backgroundImage:`url(${H})`,backgroundSize:"cover",backgroundPosition:"center"},textColor:"#FFFFFF",overlay:!0,isCustom:!0}:{label:t("theme.defaultTheme"),style:{background:"linear-gradient(135deg, #7C3AED, #2563EB)"},textColor:"#FFFFFF",overlay:!1,isCustom:!1}},P=p=>{var he;const j=X.has(p.id),H=y(p),ce=H.label;return e.jsxs("div",{draggable:!0,onDragStart:Ne=>K(Ne,p,"quiz"),className:`bg-white rounded-lg shadow-md hover:shadow-xl transition-all duration-200 overflow-hidden border-2 ${j?"border-cyan-400 ring-2 ring-blue-100":"border-transparent"} ${(v==null?void 0:v.item.id)===p.id?"opacity-50":""}`,children:[e.jsxs("div",{className:"relative h-28",children:[e.jsx("div",{className:"absolute inset-0",style:H.style}),H.overlay&&e.jsx("div",{className:"absolute inset-0 bg-black/35"}),e.jsxs("div",{className:"absolute bottom-2 left-3 right-3 flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-blue-700 drop-shadow",style:{color:H.textColor},children:ce}),H.isCustom&&e.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full bg-white/80 text-gray-700",children:t("theme.custom")})]})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx("button",{onClick:Ne=>{Ne.stopPropagation(),U(p.id)},className:"mt-1 flex-shrink-0",children:j?e.jsx(vr,{size:20,className:"text-blue-700"}):e.jsx(Qr,{size:20,className:"text-gray-400 hover:text-blue-700"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-2 line-clamp-2",children:p.title}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-3",children:[ce&&e.jsx("span",{className:"text-xs px-2 py-1 rounded-full font-medium bg-blue-50 text-blue-800 border border-blue-100",children:ce}),((he=p.categories)==null?void 0:he.name)&&e.jsx("span",{className:"text-xs px-2 py-1 rounded-full bg-indigo-100 text-indigo-700 border border-indigo-300",children:p.categories.name})]}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-gray-500",children:[e.jsx("span",{children:new Date(p.created_at).toLocaleDateString()}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:[p.questionCount," ",p.questionCount!==1?t("quiz.questions"):t("quiz.question")]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-1 pt-3 border-t border-gray-100",children:[e.jsxs("button",{onClick:()=>_e(p.id),className:"flex-1 bg-green-600 text-white px-3 py-2 rounded-md hover:bg-green-700 transition text-sm font-medium flex items-center justify-center gap-1.5",title:t("quiz.startQuiz"),children:[e.jsx(zs,{size:14}),t("actions.start")]}),e.jsx("button",{onClick:()=>n("preview-quiz",p.id),className:"p-2 bg-green-50 text-green-700 rounded-md hover:bg-green-100 transition",title:t("actions.preview"),children:e.jsx(Ft,{size:16})}),e.jsx("button",{onClick:()=>n("edit-quiz",p.id),className:"p-2 bg-blue-50 text-blue-700 rounded-md hover:bg-blue-100 transition",title:t("common.edit"),children:e.jsx(rt,{size:16})}),e.jsx("button",{onClick:()=>ze(p.id),className:"p-2 bg-blue-50 text-blue-800 rounded-md hover:bg-blue-50 transition",title:t("actions.duplicate"),children:e.jsx(ot,{size:16})}),e.jsx("button",{onClick:()=>E(p.id),className:"p-2 bg-gray-50 text-gray-700 rounded-md hover:bg-gray-100 transition",title:t("folder.moveToFolder"),children:e.jsx(Vt,{size:16})}),e.jsx("button",{onClick:()=>le(p.id),className:"p-2 bg-red-50 text-red-700 rounded-md hover:bg-red-100 transition",title:t("common.delete"),children:e.jsx(He,{size:16})})]})]})]},p.id)};return e.jsxs("div",{className:"flex min-h-screen bg-gray-50",children:[e.jsx(Ee,{currentView:"manage-quizzes",setView:n,appState:r}),e.jsxs("div",{className:"flex-1 ml-64",children:[e.jsx("nav",{className:"bg-white shadow-sm border-b border-gray-200 px-6 py-4",children:e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-blue-700",children:t("manager.quizManager")}),e.jsx("div",{className:"h-6 w-px bg-gray-300"}),e.jsx("span",{className:"text-sm text-gray-600",children:t("manager.quizzesAndFolders",{quizCount:s.length,quizText:s.length!==1?t("quiz.quizzes"):t("quiz.quiz"),folderCount:i.length,folderText:i.length!==1?t("folder.folders"):t("folder.folder")})})]})})}),e.jsx("div",{className:"bg-white border-b border-gray-200 px-6 py-4 shadow-sm",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(Ge,{size:18,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:t("manager.searchQuizzes"),value:G,onChange:p=>J(p.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-transparent"})]}),e.jsxs("select",{value:T,onChange:p=>B(p.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500 text-sm",children:[e.jsx("option",{value:"created_at",children:t("manager.sortNewest")}),e.jsx("option",{value:"title",children:t("manager.sortAZ")})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[X.size>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"px-3 py-2 bg-blue-50 text-blue-800 rounded-lg text-sm font-medium",children:t("manager.selected",{count:X.size})}),e.jsxs("button",{onClick:()=>E("bulk"),className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition flex items-center gap-2 text-sm",children:[e.jsx(Vt,{size:16}),t("manager.move")]}),e.jsxs("button",{onClick:fe,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition flex items-center gap-2 text-sm",children:[e.jsx(He,{size:16}),t("common.delete")]}),e.jsx("button",{onClick:ee,className:"px-3 py-2 text-gray-600 hover:text-gray-800 text-sm",children:t("manager.clear")})]}),X.size===0&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>{A(null),f(!0)},className:"px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition flex items-center gap-2 text-sm font-medium",children:[e.jsx(Rt,{size:16}),t("folder.newFolder")]}),e.jsxs("button",{onClick:()=>n("create-quiz"),className:"px-4 py-2 bg-blue-700 text-white rounded-lg hover:bg-blue-800 transition flex items-center gap-2 text-sm font-medium",children:[e.jsx(Re,{size:16}),t("nav.createQuiz")]})]})]})]})}),e.jsxs("div",{className:"flex h-[calc(100vh-140px)]",children:[u&&e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsx("p",{className:"text-gray-600",children:t("common.loading")})}),m&&e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("p",{className:"text-red-600",children:[t("common.error"),": ",m]})}),!u&&!m&&s.length===0&&i.length===0&&e.jsx("div",{className:"flex-1 flex items-center justify-center p-8",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-12 text-center max-w-md",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-50 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(Re,{size:32,className:"text-blue-700"})}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:t("quiz.noQuizzes")}),e.jsx("p",{className:"text-gray-600 mb-6",children:t("manager.getStarted")}),e.jsx("button",{onClick:()=>n("create-quiz"),className:"bg-blue-700 text-white px-8 py-3 rounded-lg hover:bg-blue-800 transition font-medium",children:t("manager.createYourFirstQuiz")})]})}),!u&&!m&&(i.length>0||s.length>0)&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-72 bg-gray-100 border-r border-gray-200 overflow-y-auto",children:e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"font-bold text-sm uppercase text-gray-600 mb-3 px-2",children:t("folder.folders")}),e.jsxs("div",{className:"space-y-0.5",children:[e.jsxs("div",{onClick:()=>F(null),className:`py-2 px-3 rounded-lg flex items-center gap-2 cursor-pointer transition-colors ${D===null?"bg-blue-50 text-blue-800 font-medium":"hover:bg-gray-200 text-gray-700"}`,children:[e.jsx(br,{size:18,className:D===null?"text-blue-700":"text-gray-600"}),e.jsx("span",{className:"flex-1 text-sm",children:t("folder.allQuizzes")}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${D===null?"bg-blue-100 text-blue-800":"bg-gray-200 text-gray-600"}`,children:s.length})]}),e.jsxs("div",{onClick:()=>F("unfiled"),onDragOver:ne,onDrop:p=>ye(p,null),className:`py-2 px-3 rounded-lg flex items-center gap-2 cursor-pointer transition-colors ${D==="unfiled"?"bg-blue-50 text-blue-800 font-medium":"hover:bg-gray-200 text-gray-700"}`,children:[e.jsx(dt,{size:18,className:D==="unfiled"?"text-blue-700":"text-gray-600"}),e.jsx("span",{className:"flex-1 text-sm",children:t("folder.unfiledQuizzes")}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${D==="unfiled"?"bg-blue-100 text-blue-800":"bg-gray-200 text-gray-600"}`,children:ke().length})]}),e.jsx("div",{className:"pt-2 border-t border-gray-300 mt-2",children:je(null).map(p=>Ce(p))})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto bg-white",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:D===null?t("folder.allQuizzes"):D==="unfiled"?t("folder.unfiledQuizzes"):((W=i.find(p=>p.id===D))==null?void 0:W.name)||t("folder.folder")}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[ve().length," ",ve().length!==1?t("quiz.quizzes"):t("quiz.quiz"),G&&` ${t("manager.matchingSearch",{query:G})}`]})]}),ve().length>0&&e.jsx("button",{onClick:V,className:"text-sm text-blue-700 hover:text-blue-800 font-medium",children:t("manager.selectAll")})]}),ve().length===0?e.jsxs("div",{className:"text-center py-16",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(Ge,{size:32,className:"text-gray-400"})}),e.jsx("p",{className:"text-gray-600",children:G?t("manager.noQuizzesFound",{query:G}):t("manager.noQuizzesInFolder")})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4",children:ve().map(p=>P(p))})]})})]})]}),k&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-96",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:t(O?"folder.createSubfolder":"folder.createFolder")}),e.jsx("input",{type:"text",placeholder:t("folder.folderName"),value:S,onChange:p=>w(p.target.value),onKeyDown:p=>p.key==="Enter"&&xe(),className:"w-full px-4 py-2 border rounded-lg mb-4",autoFocus:!0}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{onClick:()=>{f(!1),w(""),A(null)},className:"px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300",children:t("common.cancel")}),e.jsx("button",{onClick:xe,className:"px-4 py-2 bg-blue-700 text-white rounded-lg hover:bg-blue-800",children:t("common.create")})]})]})}),$&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl p-6 w-96 max-h-[80vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-xl font-bold mb-2",children:$==="bulk"?t("folder.moveToFolder")+` (${X.size})`:t("folder.moveToFolder")}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:t("folder.folder")}),e.jsxs("div",{className:"space-y-1 max-h-96 overflow-y-auto",children:[e.jsxs("button",{onClick:()=>{$==="bulk"?te(null):Z($,null)},className:"w-full text-left px-4 py-3 hover:bg-blue-50 rounded-lg transition flex items-center gap-3 group",children:[e.jsx(dt,{size:18,className:"text-gray-600 group-hover:text-blue-700"}),e.jsx("span",{className:"text-sm group-hover:text-blue-800 font-medium",children:t("folder.unfiledQuizzes")})]}),i.map(p=>{const j=(()=>{let H=0,ce=p.parent_folder_id;for(;ce;){H++;const he=i.find(Ne=>Ne.id===ce);ce=he==null?void 0:he.parent_folder_id}return H})();return e.jsxs("button",{onClick:()=>{$==="bulk"?te(p.id):Z($,p.id)},className:"w-full text-left px-4 py-3 hover:bg-blue-50 rounded-lg transition flex items-center gap-3 group",style:{paddingLeft:`${16+j*20}px`},children:[e.jsx($t,{size:18,className:"text-yellow-600 group-hover:text-blue-700"}),e.jsx("span",{className:"text-sm group-hover:text-blue-800",children:p.name})]},p.id)})]}),e.jsx("div",{className:"mt-6 pt-4 border-t border-gray-200 flex gap-2",children:e.jsx("button",{onClick:()=>E(null),className:"flex-1 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition font-medium",children:t("common.cancel")})})]})}),e.jsx(Ie,{isOpen:q.isOpen,title:q.title,message:q.message,type:q.type,onClose:()=>Y({...q,isOpen:!1})}),e.jsx(Le,{isOpen:oe.isOpen,title:oe.title,message:oe.message,onConfirm:oe.onConfirm,onCancel:()=>re({...oe,isOpen:!1}),confirmStyle:"danger"})]})]})}function Zr({setView:n,appState:r}){const{t}=qe(),[s,a]=c.useState([]),[i,o]=c.useState([]),[l,d]=c.useState(""),[u,g]=c.useState("all"),[m,h]=c.useState(!0),[b,z]=c.useState(null),[k,f]=c.useState(null),[S,w]=c.useState(!1),[O,A]=c.useState({isOpen:!1,title:"",message:"",type:"info"}),[C,Q]=c.useState({isOpen:!1,title:"",message:"",onConfirm:null}),[M,R]=c.useState(!1),[$,E]=c.useState({name:"",email:"",studentId:"",password:"",confirmPassword:""}),[v,_]=c.useState(!1),[D,F]=c.useState(""),[G,J]=c.useState(null),[X,ie]=c.useState("name"),[T,B]=c.useState("asc");c.useEffect(()=>{se()},[]);const se=async()=>{try{const{data:L,error:I}=await N.from("users").select("*").eq("role","student").eq("teacher_id",r.currentUser.id).order("created_at",{ascending:!1});if(I)throw I;a(L||[]),o((L==null?void 0:L.filter(Z=>!Z.approved))||[])}catch(L){z(L.message)}finally{h(!1)}},de=async L=>{var I,Z;try{console.log("Approving student:",L),console.log("Current user (teacher):",(I=r.currentUser)==null?void 0:I.id);const{data:K,error:ne}=await N.from("users").update({approved:!0}).eq("id",L).select();if(ne)throw console.error("Approval error details:",{message:ne.message,code:ne.code,details:ne.details,hint:ne.hint}),ne.code==="42501"||(Z=ne.message)!=null&&Z.includes("policy")?new Error(t("manageStudents.permissionDenied")):ne;console.log("Student approved successfully. Updated data:",K),A({isOpen:!0,title:t("manageStudents.successTitle"),message:t("manageStudents.studentApprovedSuccess"),type:"success"}),await se()}catch(K){console.error("handleApprove error:",K),A({isOpen:!0,title:t("manageStudents.errorTitle"),message:K.message||t("manageStudents.errorApprovingStudent"),type:"error"})}},q=async L=>{Q({isOpen:!0,title:t("manageStudents.rejectStudentTitle"),message:t("manageStudents.rejectStudentMessage"),onConfirm:async()=>{Q({...C,isOpen:!1});try{const{error:I}=await N.from("users").update({approved:!1}).eq("id",L);if(I)throw I;await se()}catch(I){A({isOpen:!0,title:t("manageStudents.errorTitle"),message:t("manageStudents.errorRejectingStudent")+I.message,type:"error"})}}})},Y=async L=>{Q({isOpen:!0,title:t("manageStudents.deleteStudentTitle"),message:t("manageStudents.deleteStudentMessage"),onConfirm:async()=>{Q({...C,isOpen:!1});try{const{error:I}=await N.from("users").delete().eq("id",L);if(I)throw I;await se(),w(!1)}catch(I){A({isOpen:!0,title:t("manageStudents.errorTitle"),message:t("manageStudents.errorDeletingStudent")+I.message,type:"error"})}}})},oe=()=>{E({name:"",email:"",studentId:"",password:"",confirmPassword:""}),F(""),J(null)},re=()=>{R(!1),oe()},ge=async L=>{L.preventDefault(),F(""),J(null);const I=$.name.trim(),Z=$.email.trim().toLowerCase(),K=$.studentId.trim(),ne=$.password,ye=$.confirmPassword;if(!I){F(t("manageStudents.createStudentNameRequired"));return}if(!Z){F(t("manageStudents.createStudentEmailRequired"));return}if(!ne||ne.length<6){F(t("manageStudents.createStudentPasswordLength"));return}if(ne!==ye){F(t("manageStudents.createStudentPasswordMismatch"));return}_(!0);try{const{data:le,error:ze}=await N.from("users").select("id").eq("email",Z).maybeSingle();if(ze&&ze.code!=="PGRST116")throw ze;if(le){F(t("manageStudents.createStudentEmailExists")),_(!1);return}const{data:_e}=await N.auth.getSession(),je=_e==null?void 0:_e.session,{data:be,error:ke}=await N.auth.signUp({email:Z,password:ne,options:{data:{name:I,role:"student",teacher_id:r.currentUser.id}}});if(ke)throw ke;const ve=be==null?void 0:be.user;if(!ve)throw new Error(t("manageStudents.createStudentNoUser"));const U={id:ve.id,name:I,email:Z,role:"student",student_id:K||null,teacher_id:r.currentUser.id,approved:!0,verified:!1},{error:V}=await N.from("users").insert([U]);if(V)throw V;if(je!=null&&je.access_token&&(je!=null&&je.refresh_token)){const{error:ee}=await N.auth.setSession({access_token:je.access_token,refresh_token:je.refresh_token});ee&&console.error("Error restoring teacher session:",ee)}J({name:I,email:Z,password:ne}),E({name:"",email:"",studentId:"",password:"",confirmPassword:""}),await se()}catch(le){console.error("Error creating student:",le),F(le.message||t("manageStudents.createStudentGenericError"))}finally{_(!1)}},me=async L=>{try{const{data:I,error:Z}=await N.from("session_participants").select(`
          id,
          score,
          joined_at,
          quiz_sessions!inner(
            id,
            quiz_id,
            created_at,
            quizzes(title)
          )
        `).eq("user_id",L).order("joined_at",{ascending:!1});if(Z)throw Z;const{data:K,error:ne}=await N.from("quiz_answers").select("is_correct, points_earned").in("participant_id",(I==null?void 0:I.map(be=>be.id))||[]);if(ne)throw ne;const ye=(I==null?void 0:I.length)||0,le=(I==null?void 0:I.reduce((be,ke)=>be+(ke.score||0),0))||0,ze=(K==null?void 0:K.filter(be=>be.is_correct).length)||0,_e=(K==null?void 0:K.length)||0,je=_e>0?(ze/_e*100).toFixed(1):0;return{totalQuizzes:ye,totalScore:le,accuracy:je,recentQuizzes:(I==null?void 0:I.slice(0,5))||[]}}catch(I){return console.error("Error fetching student performance:",I),{totalQuizzes:0,totalScore:0,accuracy:0,recentQuizzes:[]}}},pe=async L=>{f(L),w(!0);const I=await me(L.id);f({...L,performance:I})},we=L=>{X===L?B(T==="asc"?"desc":"asc"):(ie(L),B("asc"))},xe=s.filter(L=>{var K,ne,ye;const I=((K=L.name)==null?void 0:K.toLowerCase().includes(l.toLowerCase()))||((ne=L.email)==null?void 0:ne.toLowerCase().includes(l.toLowerCase()))||((ye=L.student_id)==null?void 0:ye.toLowerCase().includes(l.toLowerCase())),Z=u==="all"||u==="approved"&&L.approved&&L.verified||u==="pending"&&!L.approved||u==="unverified"&&!L.verified;return I&&Z}).sort((L,I)=>{let Z,K;switch(X){case"name":Z=(L.name||"").toLowerCase(),K=(I.name||"").toLowerCase();break;case"studentId":Z=(L.student_id||"").toLowerCase(),K=(I.student_id||"").toLowerCase();break;case"joined":Z=new Date(L.created_at).getTime(),K=new Date(I.created_at).getTime();break;default:return 0}return Z<K?T==="asc"?-1:1:Z>K?T==="asc"?1:-1:0});return m?e.jsxs("div",{className:"flex min-h-screen bg-gray-50",children:[e.jsx(Ee,{currentView:"manage-students",setView:n,appState:r}),e.jsx("div",{className:"flex-1 ml-64 flex items-center justify-center",children:e.jsx("p",{className:"text-xl text-gray-600",children:t("manageStudents.loadingStudents")})})]}):b?e.jsxs("div",{className:"flex min-h-screen bg-gray-50",children:[e.jsx(Ee,{currentView:"manage-students",setView:n,appState:r}),e.jsx("div",{className:"flex-1 ml-64 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-xl text-red-600 mb-4",children:[t("manageStudents.errorTitle"),": ",b]}),e.jsx("button",{onClick:()=>n("teacher-dashboard"),className:"bg-blue-700 text-white px-6 py-3 rounded-lg hover:bg-blue-800",children:t("manageStudents.backToDashboard")})]})})]}):e.jsxs("div",{className:"flex min-h-screen bg-gray-50",children:[e.jsx(Ee,{currentView:"manage-students",setView:n,appState:r}),e.jsxs("div",{className:"flex-1 ml-64",children:[e.jsx("nav",{className:"bg-white shadow-sm border-b border-gray-200 px-6 py-4 relative z-10",children:e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-green-600",children:t("manageStudents.title")}),e.jsxs("button",{onClick:()=>{oe(),R(!0)},className:"inline-flex items-center justify-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition self-start md:self-auto",children:[e.jsx(ks,{size:18}),t("manageStudents.createStudentButton")]})]})}),e.jsxs("div",{className:"container mx-auto p-6 relative z-0",children:[e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsxs("strong",{children:[t("common.note"),":"]})," ",t("manageStudents.teacherCodeNote")]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-md p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:t("manageStudents.totalStudents")}),e.jsx("p",{className:"text-3xl font-bold text-gray-800",children:s.length})]}),e.jsx(Tt,{className:"text-blue-600",size:40})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-md p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:t("manageStudents.approved")}),e.jsx("p",{className:"text-3xl font-bold text-green-600",children:s.filter(L=>L.approved).length})]}),e.jsx(ut,{className:"text-green-600",size:40})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-md p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:t("manageStudents.pendingApproval")}),e.jsx("p",{className:"text-3xl font-bold text-orange-600",children:i.length})]}),e.jsx(Ze,{className:"text-orange-600",size:40})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-md p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:t("manageStudents.unverifiedEmail")}),e.jsx("p",{className:"text-3xl font-bold text-red-600",children:s.filter(L=>!L.verified).length})]}),e.jsx(Er,{className:"text-red-600",size:40})]})})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-md p-6 mb-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ge,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:20}),e.jsx("input",{type:"text",placeholder:t("manageStudents.searchPlaceholder"),value:l,onChange:L=>d(L.target.value),className:"w-full pl-10 pr-4 py-2 border rounded-lg focus:ring-2 focus:ring-green-300"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>g("all"),className:`px-4 py-2 rounded-lg ${u==="all"?"bg-green-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:t("manageStudents.filterAll")}),e.jsx("button",{onClick:()=>g("approved"),className:`px-4 py-2 rounded-lg ${u==="approved"?"bg-green-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:t("manageStudents.filterApproved")}),e.jsx("button",{onClick:()=>g("pending"),className:`px-4 py-2 rounded-lg ${u==="pending"?"bg-green-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:t("manageStudents.filterPending")}),e.jsx("button",{onClick:()=>g("unverified"),className:`px-4 py-2 rounded-lg ${u==="unverified"?"bg-green-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:t("manageStudents.filterUnverified")})]})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-md overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-100 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{onClick:()=>we("name"),className:"px-6 py-3 text-left text-sm font-semibold text-gray-700 cursor-pointer hover:bg-gray-200 transition",children:e.jsxs("div",{className:"flex items-center gap-2",children:[t("manageStudents.tableHeaderName"),X==="name"&&(T==="asc"?e.jsx(ct,{size:16}):e.jsx(et,{size:16}))]})}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:t("manageStudents.tableHeaderEmail")}),e.jsx("th",{onClick:()=>we("studentId"),className:"px-6 py-3 text-left text-sm font-semibold text-gray-700 cursor-pointer hover:bg-gray-200 transition",children:e.jsxs("div",{className:"flex items-center gap-2",children:[t("manageStudents.tableHeaderStudentId"),X==="studentId"&&(T==="asc"?e.jsx(ct,{size:16}):e.jsx(et,{size:16}))]})}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:t("manageStudents.tableHeaderStatus")}),e.jsx("th",{onClick:()=>we("joined"),className:"px-6 py-3 text-left text-sm font-semibold text-gray-700 cursor-pointer hover:bg-gray-200 transition",children:e.jsxs("div",{className:"flex items-center gap-2",children:[t("manageStudents.tableHeaderJoined"),X==="joined"&&(T==="asc"?e.jsx(ct,{size:16}):e.jsx(et,{size:16}))]})}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:t("manageStudents.tableHeaderActions")})]})}),e.jsx("tbody",{children:xe.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"px-6 py-8 text-center text-gray-500",children:t("manageStudents.noStudentsFound")})}):xe.map(L=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"font-medium text-gray-900",children:L.name})}),e.jsx("td",{className:"px-6 py-4 text-gray-600",children:L.email}),e.jsx("td",{className:"px-6 py-4 text-gray-600",children:L.student_id||"-"}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex gap-2",children:[L.approved?e.jsx("span",{className:"px-2 py-1 text-xs font-semibold bg-green-100 text-green-800 rounded",children:t("manageStudents.statusApproved")}):e.jsx("span",{className:"px-2 py-1 text-xs font-semibold bg-orange-100 text-orange-800 rounded",children:t("manageStudents.statusPending")}),!L.verified&&e.jsx("span",{className:"px-2 py-1 text-xs font-semibold bg-red-100 text-red-800 rounded",children:t("manageStudents.statusUnverified")})]})}),e.jsx("td",{className:"px-6 py-4 text-gray-600",children:new Date(L.created_at).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>pe(L),className:"text-blue-600 hover:text-blue-700 font-medium",children:t("manageStudents.actionView")}),!L.approved&&e.jsx("button",{onClick:()=>de(L.id),className:"text-green-600 hover:text-green-700 font-medium",children:t("manageStudents.actionApprove")}),L.approved&&e.jsx("button",{onClick:()=>q(L.id),className:"text-orange-600 hover:text-orange-700 font-medium",children:t("manageStudents.actionRevoke")}),e.jsx("button",{onClick:()=>Y(L.id),className:"text-red-600 hover:text-red-700 font-medium",children:t("manageStudents.actionDelete")})]})})]},L.id))})]})})]})]}),M&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-[9999]",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-lg",children:[e.jsxs("div",{className:"p-6 border-b flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:t("manageStudents.createStudentTitle")}),e.jsx("button",{type:"button",onClick:re,className:"text-gray-500 hover:text-gray-700",children:"✕"})]}),e.jsxs("form",{onSubmit:ge,className:"p-6 space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:t("manageStudents.createStudentDescription")}),D&&e.jsx("div",{className:"rounded-lg border border-red-200 bg-red-50 px-4 py-3 text-sm text-red-700",children:D}),G&&e.jsxs("div",{className:"rounded-lg border border-green-200 bg-green-50 px-4 py-4 text-sm text-green-700",children:[e.jsx("p",{className:"font-semibold",children:t("manageStudents.createStudentSuccess")}),e.jsx("p",{className:"mt-2",children:t("manageStudents.createStudentCredentials")}),e.jsxs("div",{className:"mt-3 space-y-1",children:[e.jsxs("p",{children:[e.jsxs("span",{className:"font-semibold",children:[t("manageStudents.createStudentCredentialsEmail"),":"]})," ",G.email]}),e.jsxs("p",{children:[e.jsxs("span",{className:"font-semibold",children:[t("manageStudents.createStudentCredentialsPassword"),":"]})," ",G.password]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:t("manageStudents.createStudentNameLabel")}),e.jsx("input",{type:"text",value:$.name,onChange:L=>E(I=>({...I,name:L.target.value})),className:"w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-300",placeholder:t("manageStudents.createStudentNamePlaceholder")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:t("manageStudents.createStudentEmailLabel")}),e.jsx("input",{type:"email",value:$.email,onChange:L=>E(I=>({...I,email:L.target.value})),className:"w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-300",placeholder:t("manageStudents.createStudentEmailPlaceholder")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:t("manageStudents.createStudentIdLabel")}),e.jsx("input",{type:"text",value:$.studentId,onChange:L=>E(I=>({...I,studentId:L.target.value})),className:"w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-300",placeholder:t("manageStudents.createStudentIdPlaceholder")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:t("manageStudents.createStudentPasswordLabel")}),e.jsx("input",{type:"password",value:$.password,onChange:L=>E(I=>({...I,password:L.target.value})),className:"w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-300",placeholder:t("manageStudents.createStudentPasswordPlaceholder")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:t("manageStudents.createStudentConfirmPasswordLabel")}),e.jsx("input",{type:"password",value:$.confirmPassword,onChange:L=>E(I=>({...I,confirmPassword:L.target.value})),className:"w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-300",placeholder:t("manageStudents.createStudentConfirmPasswordPlaceholder")}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:t("manageStudents.createStudentPasswordHint")})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:re,className:"px-4 py-2 rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-100",children:t("common.cancel")}),e.jsx("button",{type:"submit",disabled:v,className:"px-4 py-2 rounded-lg bg-green-600 text-white hover:bg-green-700 disabled:opacity-60",children:t(v?"manageStudents.creatingStudent":"manageStudents.createStudentSubmit")})]})]})]})}),S&&k&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-[9999]",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"p-6 border-b flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:t("manageStudents.studentDetails")}),e.jsx("button",{onClick:()=>w(!1),className:"text-gray-500 hover:text-gray-700",children:"✕"})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:t("manageStudents.personalInformation")}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:t("manageStudents.name")}),e.jsx("p",{className:"font-medium",children:k.name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:t("manageStudents.email")}),e.jsx("p",{className:"font-medium",children:k.email})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:t("manageStudents.studentNumber")}),e.jsx("p",{className:"font-medium",children:k.student_id||t("manageStudents.notApplicable")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:t("manageStudents.status")}),e.jsx("p",{className:"font-medium",children:k.approved?t("manageStudents.statusApprovedDetail"):t("manageStudents.statusPendingDetail")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:t("manageStudents.emailVerified")}),e.jsx("p",{className:"font-medium",children:k.verified?t("manageStudents.yes"):t("manageStudents.no")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:t("manageStudents.joined")}),e.jsx("p",{className:"font-medium",children:new Date(k.created_at).toLocaleDateString()})]})]})]}),k.performance&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:t("manageStudents.performanceOverview")}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 text-center",children:[e.jsx(it,{className:"mx-auto mb-2 text-blue-600",size:32}),e.jsx("p",{className:"text-sm text-gray-600",children:t("manageStudents.quizzesTaken")}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:k.performance.totalQuizzes})]}),e.jsxs("div",{className:"bg-green-50 rounded-lg p-4 text-center",children:[e.jsx(_s,{className:"mx-auto mb-2 text-green-600",size:32}),e.jsx("p",{className:"text-sm text-gray-600",children:t("manageStudents.totalScore")}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:k.performance.totalScore})]}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 text-center",children:[e.jsx(ut,{className:"mx-auto mb-2 text-blue-700",size:32}),e.jsx("p",{className:"text-sm text-gray-600",children:t("manageStudents.accuracy")}),e.jsxs("p",{className:"text-2xl font-bold text-blue-700",children:[k.performance.accuracy,"%"]})]})]}),k.performance.recentQuizzes.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:t("manageStudents.recentQuizActivity")}),e.jsx("div",{className:"space-y-2",children:k.performance.recentQuizzes.map(L=>{var I,Z;return e.jsxs("div",{className:"flex justify-between items-center bg-gray-50 rounded-lg p-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:((Z=(I=L.quiz_sessions)==null?void 0:I.quizzes)==null?void 0:Z.title)||t("manageStudents.unknownQuiz")}),e.jsx("p",{className:"text-sm text-gray-600",children:new Date(L.joined_at).toLocaleDateString()})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-lg font-bold text-green-600",children:L.score}),e.jsx("p",{className:"text-xs text-gray-600",children:t("manageStudents.points")})]})]},L.id)})})]})]}),e.jsxs("div",{className:"flex gap-3",children:[k.approved?e.jsx("button",{onClick:()=>{q(k.id),w(!1)},className:"flex-1 bg-orange-600 text-white px-4 py-2 rounded-lg hover:bg-orange-700",children:t("manageStudents.revokeApproval")}):e.jsx("button",{onClick:()=>{de(k.id),w(!1)},className:"flex-1 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700",children:t("manageStudents.approveStudent")}),e.jsx("button",{onClick:()=>Y(k.id),className:"flex-1 bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700",children:t("manageStudents.deleteStudent")})]})]})]})}),e.jsx(Ie,{isOpen:O.isOpen,title:O.title,message:O.message,type:O.type,onClose:()=>A({...O,isOpen:!1})}),e.jsx(Le,{isOpen:C.isOpen,title:C.title,message:C.message,onConfirm:C.onConfirm,onCancel:()=>Q({...C,isOpen:!1}),confirmStyle:"danger"})]})}function Xr({setView:n,appState:r}){const{t}=qe(),[s,a]=c.useState([]),[i,o]=c.useState(null),[l,d]=c.useState(null),[u,g]=c.useState(!0),[m,h]=c.useState(null),[b,z]=c.useState(null),[k,f]=c.useState([]),[S,w]=c.useState(null),[O,A]=c.useState({isOpen:!1,title:"",message:"",type:"info"}),[C,Q]=c.useState({isOpen:!1,title:"",message:"",onConfirm:null}),[M,R]=c.useState([]),[$,E]=c.useState(!0);c.useEffect(()=>{_(),v()},[]);const v=async()=>{try{const{data:{user:T}}=await N.auth.getUser();if(!T)return;const{data:B,error:se}=await N.from("users").select("id, name").eq("teacher_id",T.id).eq("role","student");if(se)throw se;const de=B.map(re=>re.id),{data:q,error:Y}=await N.from("session_participants").select(`
          user_id,
          quiz_answers ( is_correct ),
          session_id
        `).in("user_id",de);if(Y)throw Y;const oe=B.map(re=>{const ge=q.filter(L=>L.user_id===re.id),me=new Set(ge.map(L=>L.session_id)).size;let pe=0,we=0;ge.forEach(L=>{pe+=L.quiz_answers.filter(I=>I.is_correct).length,we+=L.quiz_answers.length});const xe=we>0?pe/we*100:0;return{student_id:re.id,name:re.name,quizzesParticipated:me,averageAccuracy:xe.toFixed(1)}});R(oe)}catch(T){h(T.message)}finally{E(!1)}};c.useEffect(()=>{const T=()=>w(null);return document.addEventListener("click",T),()=>document.removeEventListener("click",T)},[]);const _=async()=>{try{const{data:T}=await N.auth.getUser();if(!(T!=null&&T.user))return;const{data:B,error:se}=await N.from("quizzes").select(`
          id,
          title,
          created_at,
          quiz_sessions(id, status, created_at)
        `).eq("created_by",T.user.id);if(se)throw se;const de=(B==null?void 0:B.map(q=>{const Y=q.quiz_sessions||[],oe=Y.filter(ge=>ge.status==="completed"),re=oe.length>0?oe.sort((ge,me)=>new Date(me.created_at)-new Date(ge.created_at))[0]:null;return{...q,sessionCount:Y.length,completedCount:oe.length,latestSession:re,mode:"Individual"}}).sort((q,Y)=>new Date(Y.created_at)-new Date(q.created_at)))||[];a(de),g(!1)}catch(T){h(T.message),g(!1)}},D=async T=>{try{g(!0);const{data:B,error:se}=await N.from("quiz_sessions").select("id, created_at, status").eq("quiz_id",T);if(se)throw se;const de=(B==null?void 0:B.map(le=>le.id))||[],{data:q,error:Y}=await N.from("session_participants").select(`
          id,
          user_id,
          score,
          session_id,
          users(name, email)
        `).in("session_id",de);if(Y)throw Y;const oe=(q==null?void 0:q.map(le=>le.id))||[],{data:re,error:ge}=await N.from("quiz_answers").select(`
          question_id,
          selected_option_index,
          is_correct,
          points_earned,
          participant_id
        `).in("participant_id",oe);if(ge)throw ge;const{data:me,error:pe}=await N.from("questions").select("*").eq("quiz_id",T).order("order_index",{ascending:!0});if(pe)throw pe;const we=(B==null?void 0:B.length)||0,xe=(q==null?void 0:q.length)||0,L=(re==null?void 0:re.length)||0,I=(re==null?void 0:re.filter(le=>le.is_correct).length)||0,Z=xe>0?(q.reduce((le,ze)=>le+(ze.score||0),0)/xe).toFixed(0):0,K=L>0?(I/L*100).toFixed(1):0,ne=(me==null?void 0:me.map(le=>{var ee,te;const ze=(re==null?void 0:re.filter(fe=>fe.question_id===le.id))||[],_e=ze.filter(fe=>fe.is_correct).length,je=ze.length,be=je>0?(_e/je*100).toFixed(1):0,ke={};(ee=le.options)==null||ee.forEach((fe,Ce)=>{ke[Ce]=ze.filter(x=>x.selected_option_index===Ce).length});const ve=ze.filter(fe=>!fe.is_correct),U={};ve.forEach(fe=>{fe.selected_option_index!==null&&(U[fe.selected_option_index]=(U[fe.selected_option_index]||0)+1)});const V=Object.entries(U).sort((fe,Ce)=>Ce[1]-fe[1])[0];return{...le,totalAnswers:je,correctAnswers:_e,accuracy:parseFloat(be),optionCounts:ke,mostCommonWrongAnswer:V?{index:parseInt(V[0]),count:V[1],text:(te=le.options[V[0]])==null?void 0:te.text}:null,difficultyKey:be>80?"difficultyEasy":be>50?"difficultyMedium":"difficultyHard"}}))||[],ye=(q==null?void 0:q.map(le=>{var be,ke;const ze=(re==null?void 0:re.filter(ve=>ve.participant_id===le.id))||[],_e=ze.filter(ve=>ve.is_correct).length,je=ze.length;return{id:le.id,name:((be=le.users)==null?void 0:be.name)||"Unknown",email:((ke=le.users)==null?void 0:ke.email)||"",score:le.score||0,questionsAnswered:je,correctAnswers:_e,accuracy:je>0?(_e/je*100).toFixed(1):0}}).sort((le,ze)=>ze.score-le.score))||[];d({totalSessions:we,totalParticipants:xe,averageScore:Z,overallAccuracy:K,questionAnalytics:ne,studentPerformance:ye,sessions:(B==null?void 0:B.filter(le=>le.status==="completed").length)||0}),g(!1)}catch(B){console.error("Error fetching quiz statistics:",B),h(B.message),g(!1)}},F=T=>{o(T),D(T.id)},G=T=>{f(B=>B.includes(T)?B.filter(se=>se!==T):[...B,T])},J=T=>{T.target.checked?f(s.map(B=>B.id)):f([])},X=T=>{A({isOpen:!0,title:t("reports.exportTitle"),message:t("reports.exportMessage",{title:T.title}),type:"info"})},ie=async T=>{Q({isOpen:!0,title:t("reports.deleteQuizTitle"),message:t("reports.deleteQuizMessage",{title:T.title}),onConfirm:async()=>{Q({...C,isOpen:!1});try{const{error:B}=await N.from("quizzes").delete().eq("id",T.id);if(B)throw B;await _(),w(null)}catch(B){A({isOpen:!0,title:t("reports.errorTitle"),message:t("reports.errorDeletingQuiz")+B.message,type:"error"})}}})};return u&&!i?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("p",{className:"text-xl text-gray-600",children:t("reports.loadingReports")})}):m?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-xl text-red-600 mb-4",children:[t("reports.errorTitle"),": ",m]}),e.jsx("button",{onClick:()=>n("teacher-dashboard"),className:"bg-blue-700 text-white px-6 py-3 rounded-lg hover:bg-blue-800",children:t("reports.backToDashboard")})]})}):e.jsxs("div",{className:"flex min-h-screen bg-gray-50",children:[e.jsx(Ee,{currentView:"reports",setView:n,appState:r}),e.jsxs("div",{className:"flex-1 ml-64",children:[e.jsx("nav",{className:"bg-white shadow-sm border-b border-gray-200 px-6 py-4",children:e.jsx("h1",{className:"text-2xl font-bold text-blue-600",children:t("reports.title")})}),e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6",children:t("reports.studentPerformanceGlobal")}),$?e.jsx("div",{className:"bg-white rounded-xl shadow-md text-center py-12",children:e.jsx("p",{className:"text-gray-600",children:t("reports.loadingStudentPerformance")})}):M.length===0?e.jsx("div",{className:"bg-white rounded-xl shadow-md text-center py-12",children:e.jsx("p",{className:"text-gray-600",children:t("reports.noStudentDataAvailable")})}):e.jsx("div",{className:"bg-white rounded-xl shadow-md overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-100 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:t("reports.student")}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:t("reports.quizzesParticipated")}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:t("reports.averageAccuracy")})]})}),e.jsx("tbody",{children:M.map(T=>e.jsxs("tr",{className:"border-b hover:bg-blue-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx("button",{onClick:()=>n("student-report",{studentId:T.student_id}),className:"font-bold text-gray-900 hover:text-blue-600 text-left",children:T.name})}),e.jsx("td",{className:"px-6 py-4 text-gray-600",children:T.quizzesParticipated}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("span",{className:`font-semibold ${T.averageAccuracy>80?"text-green-600":T.averageAccuracy>50?"text-yellow-600":"text-red-600"}`,children:[T.averageAccuracy,"%"]})})]},T.student_id))})]})})]}),i?e.jsxs("div",{children:[e.jsx("button",{onClick:()=>{o(null),d(null)},className:"mb-4 text-blue-600 hover:text-blue-700 font-medium",children:t("reports.backToQuizList")}),e.jsxs("h2",{className:"text-3xl font-bold mb-6",children:[i.title," - ",t("reports.analytics")]}),l&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-md p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:t("reports.totalSessions")}),e.jsx("p",{className:"text-3xl font-bold text-blue-600",children:l.sessions})]}),e.jsx(jt,{className:"text-blue-600",size:40})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-md p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:t("reports.totalParticipants")}),e.jsx("p",{className:"text-3xl font-bold text-green-600",children:l.totalParticipants})]}),e.jsx(Oe,{className:"text-green-600",size:40})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-md p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:t("reports.averageScore")}),e.jsx("p",{className:"text-3xl font-bold text-blue-700",children:l.averageScore})]}),e.jsx(it,{className:"text-blue-700",size:40})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-md p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:t("reports.overallAccuracy")}),e.jsxs("p",{className:"text-3xl font-bold text-orange-600",children:[l.overallAccuracy,"%"]})]}),e.jsx(Cs,{className:"text-orange-600",size:40})]})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-md p-6 mb-6",children:[e.jsx("h3",{className:"text-2xl font-bold mb-4",children:t("reports.questionPerformance")}),e.jsx("div",{className:"space-y-4",children:l.questionAnalytics.map((T,B)=>{var se;return e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-start cursor-pointer",onClick:()=>z(b===B?null:B),children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsxs("span",{className:"text-lg font-semibold",children:[t("reports.questionLabel"),B+1,":"]}),e.jsx("span",{className:"text-gray-800",children:T.question_text})]}),e.jsxs("div",{className:"flex gap-4 text-sm",children:[e.jsx("span",{className:"text-gray-600",children:t("reports.answeredTimes",{count:T.totalAnswers})}),e.jsx("span",{className:`font-semibold ${T.accuracy>80?"text-green-600":T.accuracy>50?"text-yellow-600":"text-red-600"}`,children:t("reports.accuracy",{percent:T.accuracy})}),e.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-semibold ${T.difficultyKey==="difficultyEasy"?"bg-green-100 text-green-800":T.difficultyKey==="difficultyMedium"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:t(`reports.${T.difficultyKey}`)})]})]}),b===B?e.jsx(ct,{size:20}):e.jsx(et,{size:20})]}),b===B&&e.jsxs("div",{className:"mt-4 pt-4 border-t",children:[e.jsx("h4",{className:"font-semibold mb-3",children:t("reports.answerDistribution")}),e.jsx("div",{className:"space-y-2",children:(se=T.options)==null?void 0:se.map((de,q)=>{const Y=T.optionCounts[q]||0,oe=T.totalAnswers>0?(Y/T.totalAnswers*100).toFixed(1):0,re=de.is_correct;return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-24 px-2 py-1 rounded text-sm font-medium text-center ${re?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:re?t("reports.correct"):t("reports.option",{number:q+1})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm mb-1",children:de.text}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-4",children:e.jsx("div",{className:`h-4 rounded-full ${re?"bg-green-500":"bg-blue-500"}`,style:{width:`${oe}%`}})}),e.jsxs("span",{className:"text-sm font-medium w-16 text-right",children:[Y," (",oe,"%)"]})]})]})]},q)})}),T.mostCommonWrongAnswer&&e.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(fr,{className:"text-red-600 mt-0.5",size:20}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-red-800",children:t("reports.mostCommonMistake")}),e.jsx("p",{className:"text-sm text-red-700",children:t("reports.studentsSelected",{count:T.mostCommonWrongAnswer.count,text:T.mostCommonWrongAnswer.text})})]})]})})]})]},T.id)})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-md p-6",children:[e.jsx("h3",{className:"text-2xl font-bold mb-4",children:t("reports.studentPerformance")}),l.studentPerformance.length===0?e.jsx("p",{className:"text-gray-600 text-center py-8",children:t("reports.noStudentData")}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-100 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:t("reports.rank")}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:t("reports.student")}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:t("reports.email")}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:t("reports.score")}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:t("reports.questions")}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:t("reports.accuracyHeader")})]})}),e.jsx("tbody",{children:l.studentPerformance.map((T,B)=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`text-lg font-bold ${B===0?"text-yellow-600":B===1?"text-gray-400":B===2?"text-orange-600":"text-gray-600"}`,children:B===0?"🥇":B===1?"🥈":B===2?"🥉":`#${B+1}`})}),e.jsx("td",{className:"px-6 py-4 font-medium",children:T.name}),e.jsx("td",{className:"px-6 py-4 text-gray-600",children:T.email}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-lg font-bold text-green-600",children:T.score})}),e.jsxs("td",{className:"px-6 py-4 text-gray-600",children:[T.correctAnswers,"/",T.questionsAnswered]}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("span",{className:`font-semibold ${T.accuracy>80?"text-green-600":T.accuracy>50?"text-yellow-600":"text-red-600"}`,children:[T.accuracy,"%"]})})]},T.id))})]})})]})]})]}):e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-6",children:t("reports.quizReports")}),s.length===0?e.jsxs("div",{className:"bg-white rounded-xl shadow-md text-center py-12",children:[e.jsx("p",{className:"text-gray-600 mb-4",children:t("reports.noQuizzesFound")}),e.jsx("button",{onClick:()=>n("create-quiz"),className:"bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700",children:t("reports.createQuiz")})]}):e.jsx("div",{className:"bg-white rounded-xl shadow-md overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-100 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left w-12",children:e.jsx("input",{type:"checkbox",checked:k.length===s.length&&s.length>0,onChange:J,className:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"})}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:t("reports.tableHeaderQuizTitle")}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:t("reports.tableHeaderDateTime")}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:t("reports.tableHeaderMode")}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:t("reports.tableHeaderPlayers")}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700 w-12"})]})}),e.jsx("tbody",{children:s.map(T=>e.jsxs("tr",{className:"border-b hover:bg-blue-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-4",children:e.jsx("input",{type:"checkbox",checked:k.includes(T.id),onChange:()=>G(T.id),className:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500",onClick:B=>B.stopPropagation()})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("button",{onClick:()=>F(T),className:"font-bold text-gray-900 hover:text-blue-600 text-left",children:T.title})}),e.jsx("td",{className:"px-6 py-4 text-gray-600 text-sm",children:T.latestSession?new Date(T.latestSession.created_at).toLocaleString():new Date(T.created_at).toLocaleString()}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold ${T.mode==="Team"||T.mode==="team"?"bg-blue-50 text-blue-800":"bg-green-100 text-green-800"}`,children:T.mode==="Team"||T.mode==="team"?t("reports.teamMode"):t("reports.individual")})}),e.jsxs("td",{className:"px-6 py-4 text-gray-600",children:[T.completedCount," ",T.completedCount!==1?t("reports.sessions"):t("reports.session")]}),e.jsxs("td",{className:"px-6 py-4 relative",children:[e.jsx("button",{onClick:B=>{B.stopPropagation(),w(S===T.id?null:T.id)},className:"p-1 hover:bg-gray-200 rounded transition-colors",children:e.jsx(kr,{size:20,className:"text-gray-600"})}),S===T.id&&e.jsxs("div",{className:"absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-xl border border-gray-200 z-10",children:[e.jsxs("button",{onClick:B=>{B.stopPropagation(),F(T),w(null)},className:"w-full px-4 py-2 text-left text-sm hover:bg-gray-100 flex items-center gap-2",children:[e.jsx(Ft,{size:16}),t("reports.actionView")]}),e.jsxs("button",{onClick:B=>{B.stopPropagation(),X(T),w(null)},className:"w-full px-4 py-2 text-left text-sm hover:bg-gray-100 flex items-center gap-2",children:[e.jsx(wr,{size:16}),t("reports.actionExport")]}),e.jsxs("button",{onClick:B=>{B.stopPropagation(),ie(T)},className:"w-full px-4 py-2 text-left text-sm hover:bg-gray-100 text-red-600 flex items-center gap-2",children:[e.jsx(He,{size:16}),t("reports.actionDelete")]})]})]})]},T.id))})]})})]})]})]}),e.jsx(Ie,{isOpen:O.isOpen,title:O.title,message:O.message,type:O.type,onClose:()=>A({...O,isOpen:!1})}),e.jsx(Le,{isOpen:C.isOpen,title:C.title,message:C.message,onConfirm:C.onConfirm,onCancel:()=>Q({...C,isOpen:!1}),confirmStyle:"danger"})]})}function ea({setView:n,studentId:r,appState:t}){const{t:s}=qe(),[a,i]=c.useState(null),[o,l]=c.useState(null),[d,u]=c.useState(!0),[g,m]=c.useState(null);return c.useEffect(()=>{r&&(async()=>{try{const{data:b,error:z}=await N.from("users").select("*").eq("id",r).single();if(z)throw z;i(b);const{data:k,error:f}=await N.from("session_participants").select(`
            score,
            quiz_sessions (
              created_at,
              quizzes (
                title
              )
            ),
            quiz_answers (
              is_correct
            )
          `).eq("user_id",r);if(f)throw f;const S=k.map(C=>{const Q=C.quiz_answers.length,M=C.quiz_answers.filter($=>$.is_correct).length,R=Q>0?M/Q*100:0;return{title:C.quiz_sessions.quizzes.title,date:new Date(C.quiz_sessions.created_at).toLocaleDateString(),score:C.score,accuracy:R.toFixed(1)}}),w=S.length,O=w>0?(S.reduce((C,Q)=>C+Q.score,0)/w).toFixed(0):0,A=w>0?(S.reduce((C,Q)=>C+parseFloat(Q.accuracy),0)/w).toFixed(1):0;l({quizzesTaken:S,totalQuizzes:w,averageScore:O,averageAccuracy:A})}catch(b){m(b.message)}finally{u(!1)}})()},[r]),d?e.jsx("div",{className:"p-6",children:s("loading")}):g?e.jsxs("div",{className:"p-6",children:[s("error"),": ",g]}):e.jsxs("div",{className:"flex min-h-screen bg-gray-50",children:[e.jsx(Ee,{currentView:"reports",setView:n,appState:t}),e.jsx("div",{className:"flex-1 ml-64",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("button",{onClick:()=>n("reports"),className:"text-blue-600 hover:underline mb-4",children:["← ",s("back_to_reports")]}),e.jsx("h1",{className:"text-3xl font-bold mb-2",children:a==null?void 0:a.name}),e.jsx("p",{className:"text-gray-600 mb-6",children:a==null?void 0:a.email}),o&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-md p-6",children:[e.jsx("p",{className:"text-sm text-gray-600",children:s("studentReport.totalQuizzes")}),e.jsx("p",{className:"text-3xl font-bold text-blue-600",children:o.totalQuizzes})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-md p-6",children:[e.jsx("p",{className:"text-sm text-gray-600",children:s("studentReport.averageScore")}),e.jsx("p",{className:"text-3xl font-bold text-blue-700",children:o.averageScore})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-md p-6",children:[e.jsx("p",{className:"text-sm text-gray-600",children:s("studentReport.averageAccuracy")}),e.jsxs("p",{className:"text-3xl font-bold text-orange-600",children:[o.averageAccuracy,"%"]})]})]}),e.jsx("h2",{className:"text-2xl font-bold mb-4",children:s("studentReport.quizHistory")}),e.jsx("div",{className:"bg-white rounded-xl shadow-md overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-100 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:s("studentReport.quizTitle")}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:s("studentReport.dateTaken")}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:s("studentReport.score")}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:s("studentReport.accuracy")})]})}),e.jsx("tbody",{children:o.quizzesTaken.map((h,b)=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 font-medium",children:h.title}),e.jsx("td",{className:"px-6 py-4 text-gray-600",children:h.date}),e.jsx("td",{className:"px-6 py-4 text-green-600 font-semibold",children:h.score}),e.jsxs("td",{className:"px-6 py-4 font-semibold",children:[h.accuracy,"%"]})]},b))})]})})]})]})})]})}function ta({setView:n,appState:r}){const{t}=qe(),[s,a]=c.useState([]),[i,o]=c.useState(!0),[l,d]=c.useState(null),[u,g]=c.useState(""),[m,h]=c.useState("created_at"),[b,z]=c.useState({}),[k,f]=c.useState({isOpen:!1,title:"",message:"",type:"info"}),[S,w]=c.useState({isOpen:!1,title:"",message:"",onConfirm:null});c.useEffect(()=>{(async()=>{const _=await O();await A(_)})()},[]);const O=async()=>{try{const{data:v,error:_}=await N.from("themes").select("id, name, background_image_url, primary_color, secondary_color, text_color");if(_)throw _;const D={};return(v||[]).forEach(F=>{D[F.id]=F}),z(D),D}catch(v){return console.error("Error fetching themes:",v.message),{}}},A=async(v=b)=>{try{const{data:_}=await N.auth.getUser();if(!(_!=null&&_.user)){d(t("errors.notAuthenticated"));return}const{data:D,error:F}=await N.from("quizzes").select(`
          id,
          title,
          theme_id,
          background_image_url,
          created_at,
          created_by,
          users!quizzes_created_by_fkey(name, email),
          questions(id)
        `).eq("is_public",!0).order("created_at",{ascending:!1});if(F)throw F;const G=(D||[]).map(J=>{var X,ie,T;return{...J,questionCount:((X=J.questions)==null?void 0:X.length)||0,themeDetails:v[J.theme_id]||null,creatorName:((ie=J.users)==null?void 0:ie.name)||((T=J.users)==null?void 0:T.email)||"Unknown",isOwnQuiz:J.created_by===_.user.id}});a(G)}catch(_){d(_.message)}finally{o(!1)}},C=v=>{w({isOpen:!0,title:t("publicQuizzes.importQuiz"),message:t("publicQuizzes.importQuizConfirm"),onConfirm:async()=>{w({...S,isOpen:!1}),await Q(v)}})},Q=async v=>{try{const{data:_,error:D}=await N.from("quizzes").select("*").eq("id",v).single();if(D)throw D;const{data:F,error:G}=await N.from("questions").select("*").eq("quiz_id",v);if(G)throw G;const{data:J,error:X}=await N.from("quizzes").insert([{title:`${_.title} (Imported)`,theme_id:_.theme_id||null,category_id:_.category_id,created_by:r.currentUser.id,background_image_url:_.background_image_url||null,randomize_questions:_.randomize_questions,randomize_answers:_.randomize_answers,is_template:!1,is_public:!1,folder_id:null}]).select().single();if(X)throw X;if(F&&F.length>0){const ie=F.map(B=>({quiz_id:J.id,question_text:B.question_text,question_type:B.question_type,time_limit:B.time_limit,points:B.points,options:B.options,image_url:B.image_url,video_url:B.video_url,gif_url:B.gif_url,order_index:B.order_index})),{error:T}=await N.from("questions").insert(ie);if(T)throw T}f({isOpen:!0,title:t("common.success"),message:t("publicQuizzes.importSuccess"),type:"success"})}catch(_){f({isOpen:!0,title:t("common.error"),message:t("publicQuizzes.importError")+": "+_.message,type:"error"})}},M=()=>{let v=s;return u&&(v=v.filter(_=>_.title.toLowerCase().includes(u.toLowerCase())||_.creatorName.toLowerCase().includes(u.toLowerCase()))),m==="created_at"?v.sort((_,D)=>new Date(D.created_at)-new Date(_.created_at)):m==="title"?v.sort((_,D)=>_.title.localeCompare(D.title)):m==="creator"&&v.sort((_,D)=>_.creatorName.localeCompare(D.creatorName)),v},R=v=>{if(!v)return t("theme.defaultTheme");const D=`theme.${v.toLowerCase()}`,F=t(D);return F===D?v:F},$=v=>{const _=v.themeDetails||b[v.theme_id]||null,D=v.background_image_url;if(_!=null&&_.background_image_url)return{label:R(_.name),style:{backgroundImage:`url(${_.background_image_url})`,backgroundSize:"cover",backgroundPosition:"center"},textColor:_.text_color||"#FFFFFF",overlay:!0,isCustom:!1};if(_&&(_.primary_color||_.secondary_color)){const F=_.primary_color||"#7C3AED",G=_.secondary_color||F;return{label:R(_.name),style:{background:`linear-gradient(135deg, ${F}, ${G})`},textColor:_.text_color||"#FFFFFF",overlay:!1,isCustom:!1}}return D?{label:t("theme.customTheme"),style:{backgroundImage:`url(${D})`,backgroundSize:"cover",backgroundPosition:"center"},textColor:"#FFFFFF",overlay:!0,isCustom:!0}:{label:t("theme.defaultTheme"),style:{background:"linear-gradient(135deg, #7C3AED, #2563EB)"},textColor:"#FFFFFF",overlay:!1,isCustom:!1}},E=v=>{const _=$(v);return e.jsxs("div",{className:"bg-white rounded-lg shadow-md hover:shadow-xl transition-all duration-200 overflow-hidden border border-gray-200",children:[e.jsxs("div",{className:"relative h-32",children:[e.jsx("div",{className:"absolute inset-0",style:_.style}),_.overlay&&e.jsx("div",{className:"absolute inset-0 bg-black/35"}),e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx(tt,{size:20,className:"text-white drop-shadow"})}),e.jsx("div",{className:"absolute bottom-2 left-3 right-3",children:e.jsx("span",{className:"text-sm font-semibold drop-shadow",style:{color:_.textColor},children:_.label})})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-2 line-clamp-2",children:v.title}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600 mb-2",children:[e.jsx(qs,{size:14}),e.jsx("span",{children:v.creatorName})]}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ws,{size:14}),e.jsx("span",{children:new Date(v.created_at).toLocaleDateString()})]}),e.jsx("span",{children:"•"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(zr,{size:14}),e.jsxs("span",{children:[v.questionCount," ",v.questionCount===1?t("quiz.question"):t("quiz.questions")]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 pt-3 border-t border-gray-100",children:[e.jsxs("button",{onClick:()=>n("preview-quiz",v.id),className:"flex-1 bg-blue-600 text-white px-3 py-2 rounded-md hover:bg-blue-700 transition text-sm font-medium flex items-center justify-center gap-1.5",title:t("actions.preview"),children:[e.jsx(Ft,{size:14}),t("actions.preview")]}),!v.isOwnQuiz&&e.jsxs("button",{onClick:()=>C(v.id),className:"flex-1 bg-blue-700 text-white px-3 py-2 rounded-md hover:bg-blue-800 transition text-sm font-medium flex items-center justify-center gap-1.5",title:t("publicQuizzes.import"),children:[e.jsx(ot,{size:14}),t("publicQuizzes.import")]}),v.isOwnQuiz&&e.jsx("div",{className:"flex-1 bg-gray-100 text-gray-600 px-3 py-2 rounded-md text-sm font-medium text-center",children:t("publicQuizzes.yourQuiz")})]})]})]},v.id)};return e.jsxs("div",{className:"flex min-h-screen bg-gray-50",children:[e.jsx(Ee,{currentView:"public-quizzes",setView:n,appState:r}),e.jsxs("div",{className:"flex-1 ml-64",children:[e.jsx("nav",{className:"bg-white shadow-sm border-b border-gray-200 px-6 py-4",children:e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(tt,{size:28,className:"text-blue-700"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-blue-700",children:t("nav.publicQuizzes")}),e.jsx("p",{className:"text-sm text-gray-600",children:t("publicQuizzes.description")})]})]})})}),e.jsx("div",{className:"bg-white border-b border-gray-200 px-6 py-4 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(Ge,{size:18,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:t("publicQuizzes.searchPlaceholder"),value:u,onChange:v=>g(v.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-transparent"})]}),e.jsxs("select",{value:m,onChange:v=>h(v.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500 text-sm",children:[e.jsx("option",{value:"created_at",children:t("manager.sortNewest")}),e.jsx("option",{value:"title",children:t("manager.sortAZ")}),e.jsx("option",{value:"creator",children:t("publicQuizzes.sortByCreator")})]})]})}),e.jsxs("div",{className:"p-6",children:[i&&e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx("p",{className:"text-gray-600",children:t("common.loading")})}),l&&e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsxs("p",{className:"text-red-600",children:[t("common.error"),": ",l]})}),!i&&!l&&s.length===0&&e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-12 text-center max-w-md",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-50 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(tt,{size:32,className:"text-blue-700"})}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:t("publicQuizzes.noPublicQuizzes")}),e.jsx("p",{className:"text-gray-600",children:t("publicQuizzes.noPublicQuizzesDescription")})]})}),!i&&!l&&s.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:t("publicQuizzes.availableQuizzes")}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[M().length," ",M().length!==1?t("quiz.quizzes"):t("quiz.quiz"),u&&` ${t("manager.matchingSearch",{query:u})}`]})]}),M().length===0?e.jsxs("div",{className:"text-center py-16",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(Ge,{size:32,className:"text-gray-400"})}),e.jsx("p",{className:"text-gray-600",children:t("manager.noQuizzesFound",{query:u})})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:M().map(v=>E(v))})]})]})]}),e.jsx(Ie,{isOpen:k.isOpen,title:k.title,message:k.message,type:k.type,onClose:()=>f({...k,isOpen:!1})}),e.jsx(Le,{isOpen:S.isOpen,title:S.title,message:S.message,onConfirm:S.onConfirm,onCancel:()=>w({...S,isOpen:!1}),confirmStyle:"primary"})]})}function sa({sessionId:n,appState:r,setView:t}){var we,xe,L;const{t:s}=qe(),[a,i]=c.useState(null),[o,l]=c.useState(null),[d,u]=c.useState(null),[g,m]=c.useState(null),[h,b]=c.useState(null),[z,k]=c.useState([]),f=c.useRef([]),S=c.useRef(null),[w,O]=c.useState(null),[A,C]=c.useState(!1),[Q,M]=c.useState(0),[R,$]=c.useState(!0),[E,v]=c.useState(null),[_,D]=c.useState(!1),[F,G]=c.useState(!1),[J,X]=c.useState(5),[ie,T]=c.useState(!1),[B,se]=c.useState({isOpen:!1,title:"",message:"",type:"info"}),[de,q]=c.useState({isOpen:!1,title:"",message:"",onConfirm:null});c.useEffect(()=>{n&&Y()},[n]),c.useEffect(()=>{if(!n)return;console.log("[StudentQuiz] Setting up realtime and polling");const I=oe(),Z=setInterval(async()=>{console.log("[StudentQuiz] Polling for session updates (fallback)");try{const{data:K,error:ne}=await N.from("quiz_sessions").select("*").eq("id",n).single();if(!ne&&K&&(console.log("[StudentQuiz] Polled session status:",K.status),console.log("[StudentQuiz] Current local status:",a==null?void 0:a.status),a&&(K.status!==a.status||K.current_question_index!==S.current)))if(console.log("[StudentQuiz] Status/question changed via polling"),K.current_question_index!==S.current&&(S.current=K.current_question_index),K.status==="active"&&K.current_question_index===0)console.log("[StudentQuiz] Quiz starting (via polling) - showing countdown"),i(K),T(!0),X(5);else if(K.status==="question_active"){const le=f.current[K.current_question_index];le&&(console.log("[StudentQuiz] Showing question (via polling):",le.question_text),i(K),T(!1),b(le),M(le.time_limit),C(!1),O(null),D(!1),G(!1))}else K.status==="showing_results"?(console.log("[StudentQuiz] Showing results (via polling)"),i(K),D(!0)):K.status==="completed"&&(console.log("[StudentQuiz] Quiz completed (via polling)"),i(K))}catch(K){console.error("[StudentQuiz] Error polling session:",K)}},2e3);return()=>{console.log("[StudentQuiz] Cleaning up realtime and polling"),I(),clearInterval(Z)}},[n]),c.useEffect(()=>{f.current=z},[z]);const Y=async()=>{try{const{data:I,error:Z}=await N.from("quiz_sessions").select("*").eq("id",n);if(Z)throw Z;const K=I&&I.length>0?I[0]:null;if(!K)throw new Error(s("errors.quizSessionNotFound"));i(K),console.log("=== LOADING QUIZ ==="),console.log("Session quiz_id:",K.quiz_id);const{data:ne,error:ye}=await N.from("quizzes").select("*").eq("id",K.quiz_id);if(console.log("Quiz query results:",ne),console.log("Quiz query error:",ye),ye)throw console.error("Quiz query failed:",ye),new Error(`${s("errors.errorLoadingQuiz")}: ${ye.message}`);const le=ne&&ne.length>0?ne[0]:null;if(!le)throw console.error("No quiz found with ID:",K.quiz_id),console.error("Query returned:",ne),new Error(`${s("errors.quizNotFound")} (ID: ${K.quiz_id}). ${s("errors.quizMayBeDeleted")}`);if(console.log("✅ Quiz loaded successfully:",le.title),l(le),le.theme_id){const{data:ve,error:U}=await N.from("themes").select("*").eq("id",le.theme_id);if(!U&&ve&&ve.length>0){const V=ve[0];console.log("Theme data loaded:",V),u(V)}else console.log("Theme fetch error or no theme found:",U),u(null)}else console.log("No theme_id on quiz"),u(null);const{data:ze,error:_e}=await N.from("questions").select("*").eq("quiz_id",K.quiz_id).order("order_index",{ascending:!0});if(_e)throw _e;let je=ze;K.question_order&&(je=K.question_order.map(ve=>ze.find(U=>U.id===ve)).filter(Boolean)),k(je),console.log("Checking if user is already a participant...");const{data:be,error:ke}=await N.from("session_participants").select("*").eq("session_id",n).eq("user_id",r.currentUser.id).maybeSingle();if(ke&&console.log("Error checking participant:",ke),be)m(be);else{const{data:ve,error:U}=await N.from("session_participants").insert([{session_id:n,user_id:r.currentUser.id,score:0}]).select().single();if(U)throw U;m(ve)}if(S.current=K.current_question_index,K.status==="question_active"&&je.length>0){const ve=je[K.current_question_index];ve&&(b(ve),M(ve.time_limit))}$(!1)}catch(I){v(I.message),$(!1)}},oe=()=>{console.log("[StudentQuiz] Setting up realtime subscriptions for session:",n);const I=N.channel(`student-session-${n}`).on("postgres_changes",{event:"UPDATE",schema:"public",table:"quiz_sessions",filter:`id=eq.${n}`},Z=>{console.log("[StudentQuiz] Session update detected:",Z),console.log("[StudentQuiz] Event type:",Z.eventType),console.log("[StudentQuiz] New session data:",Z.new),console.log("[StudentQuiz] Old session data:",Z.old);const K=Z.new;if(i(K),console.log("[StudentQuiz] Updated session status:",K.status),console.log("[StudentQuiz] Current question index:",K.current_question_index),K.status==="active"&&K.current_question_index===0)console.log("[StudentQuiz] Quiz starting - showing countdown"),T(!0),X(5);else if(K.status==="question_active"){const ne=f.current;console.log("[StudentQuiz] Question active, available questions:",ne.length);const ye=ne[K.current_question_index];ye?(console.log("[StudentQuiz] Showing question:",ye.question_text),T(!1),b(ye),M(ye.time_limit),C(!1),O(null),D(!1),G(!1)):(console.error("[StudentQuiz] Question not found at index:",K.current_question_index),console.error("[StudentQuiz] Available questions:",ne.length))}else K.status==="showing_results"&&(console.log("[StudentQuiz] Showing results"),D(!0))}).subscribe(Z=>{console.log("[StudentQuiz] Subscription status:",Z),Z==="SUBSCRIBED"?console.log("[StudentQuiz] Successfully subscribed to session updates"):Z==="CHANNEL_ERROR"&&console.error("[StudentQuiz] Error subscribing to session channel")});return()=>{console.log("[StudentQuiz] Cleaning up realtime subscriptions"),I.unsubscribe()}};c.useEffect(()=>{if(ie&&J>0){const I=setTimeout(()=>{X(J-1)},1e3);return()=>clearTimeout(I)}else ie&&J===0&&T(!1)},[ie,J]),c.useEffect(()=>{if((a==null?void 0:a.status)==="question_active"&&Q>0&&!A){const I=setInterval(()=>{M(Z=>Z<=1?(clearInterval(I),0):Z-1)},1e3);return()=>clearInterval(I)}},[a==null?void 0:a.status,Q,A]);const re=async I=>{if(!(A||!h||!g)){O(I),C(!0);try{const Z=h.options[I].is_correct;G(Z);const K=Math.floor(Q/h.time_limit*100),ne=Z?h.points+K:0,{error:ye}=await N.from("quiz_answers").insert([{session_id:n,participant_id:g.id,question_id:h.id,selected_option_index:I,is_correct:Z,points_earned:ne,time_taken:h.time_limit-Q}]);if(ye)throw ye;const{error:le}=await N.from("session_participants").update({score:g.score+ne}).eq("id",g.id);if(le)throw le;m({...g,score:g.score+ne})}catch(Z){se({isOpen:!0,title:s("common.error"),message:s("errors.errorSubmittingAnswer")+": "+Z.message,type:"error"})}}},me=(()=>(console.log("Getting background style, theme:",d),d!=null&&d.background_image_url?(console.log("Using theme background image:",d.background_image_url),{backgroundImage:`url(${d.background_image_url})`,backgroundSize:"cover",backgroundPosition:"center",backgroundAttachment:"fixed"}):d?(console.log("Using theme gradient colors:",d.primary_color,d.secondary_color),{background:`linear-gradient(135deg, ${d.primary_color}, ${d.secondary_color})`}):o!=null&&o.background_image_url?(console.log("Using quiz background image:",o.background_image_url),{backgroundImage:`url(${o.background_image_url})`,backgroundSize:"cover",backgroundPosition:"center",backgroundAttachment:"fixed"}):(console.log("No theme or custom background found, using fallback"),{background:"linear-gradient(135deg, #7C3AED, #2563EB)"})))(),pe=(d==null?void 0:d.text_color)||"#FFFFFF";if(R)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",style:me,children:e.jsx("p",{className:"text-2xl",style:{color:pe},children:s("student.joiningQuiz")})});if(E)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-xl text-red-600 mb-4",children:[s("common.error"),": ",E]}),e.jsx("button",{onClick:()=>t("student-dashboard"),className:"bg-blue-700 text-white px-6 py-3 rounded-lg hover:bg-blue-800",children:s("student.backToDashboard")})]})});if(ie)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",style:me,children:e.jsx("div",{className:"text-center",children:e.jsxs("div",{className:"bg-white/95 backdrop-blur-sm rounded-2xl shadow-2xl p-12 max-w-md",children:[e.jsx("h1",{className:"text-4xl font-bold text-gray-800 mb-8",children:o==null?void 0:o.title}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-gray-600 mb-4",children:s("student.startingIn")}),e.jsx("div",{className:"text-6xl md:text-8xl font-bold animate-pulse",style:{color:(d==null?void 0:d.primary_color)||"#7C3AED"},children:J})]}),e.jsx("p",{className:"text-sm text-gray-500 mt-6",children:s("student.getReadyQuizStarting")})]})})});if(a.status==="waiting")return e.jsx("div",{className:"min-h-screen flex items-center justify-center",style:me,children:e.jsxs("div",{className:"bg-white/95 backdrop-blur-sm rounded-2xl shadow-2xl p-12 text-center max-w-md",children:[e.jsx("h2",{className:"text-3xl font-bold mb-4",children:s("student.youreIn")}),e.jsx("p",{className:"text-gray-600 mb-6",children:s("student.waitingForTeacherToStart")}),e.jsx("div",{className:"animate-pulse text-6xl mb-4",children:"⏳"}),e.jsx("p",{className:"text-lg font-semibold",style:{color:(d==null?void 0:d.primary_color)||"#7C3AED"},children:o.title})]})});if(a.status==="question_active"&&h){const I=[{bg:"bg-red-500",hover:"hover:bg-red-600",ring:"ring-red-400",icon:gt},{bg:"bg-blue-600",hover:"hover:bg-blue-700",ring:"ring-blue-400",icon:xt},{bg:"bg-orange-500",hover:"hover:bg-orange-600",ring:"ring-orange-400",icon:ht},{bg:"bg-green-500",hover:"hover:bg-green-600",ring:"ring-green-400",icon:mt}];return e.jsx("div",{className:"min-h-screen",style:me,children:e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("div",{className:"bg-white/95 backdrop-blur-sm rounded-xl shadow-lg p-4 mb-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ze,{size:24,className:"text-blue-700"}),e.jsxs("span",{className:"text-3xl font-bold text-blue-700",children:[Q,"s"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-gray-600",children:s("session.yourScore")}),e.jsx("p",{className:"text-2xl font-bold text-blue-700",children:(g==null?void 0:g.score)||0})]})]})}),e.jsxs("div",{className:"bg-white/95 backdrop-blur-sm rounded-2xl shadow-2xl p-6 mb-4",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsxs("p",{className:"text-gray-600 mb-2",children:[s("quiz.question")," ",a.current_question_index+1," ",s("student.of")," ",z.length]}),e.jsx("h2",{className:"text-3xl font-bold mb-4",children:h.question_text}),h.image_url&&e.jsx("img",{src:h.image_url,alt:"Question",className:"max-w-md mx-auto rounded-lg shadow-lg mb-4"}),h.video_url&&e.jsx(pt,{src:h.video_url,className:"max-w-md mx-auto rounded-lg shadow-lg mb-4",reloadKey:h.id}),h.gif_url&&e.jsx("img",{src:h.gif_url,alt:"GIF",className:"max-w-md mx-auto rounded-lg shadow-lg mb-4"})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 md:gap-4",children:(we=h.options)==null?void 0:we.map((Z,K)=>{const ne=I[K],ye=ne.icon;return e.jsxs("button",{onClick:()=>re(K),disabled:A||Q===0,className:`${ne.bg} ${!A&&Q>0?ne.hover:""} ${w===K?`ring-4 ${ne.ring}`:""} text-white p-3 sm:p-4 md:p-6 lg:p-8 rounded-lg text-sm sm:text-base md:text-xl lg:text-2xl font-bold transition-all disabled:opacity-60 disabled:cursor-not-allowed flex flex-col sm:flex-row items-center justify-center gap-2 sm:gap-3 relative`,children:[e.jsx(ye,{size:28,className:"shrink-0",fill:"white"}),e.jsx("span",{className:"text-center",children:Z.text})]},K)})}),A&&e.jsxs("div",{className:`mt-6 p-4 rounded-xl text-center ${F?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:[e.jsx("p",{className:"text-2xl font-bold",children:F?`✓ ${s("session.correctAnswer")}`:`✗ ${s("student.incorrect")}`}),e.jsx("p",{className:"text-lg",children:F?`+${h.points} ${s("quiz.points")}!`:s("student.betterLuckNextTime")}),e.jsx("p",{className:"text-sm mt-2 opacity-75",children:"Waiting for other players..."})]}),!A&&Q===0&&e.jsxs("div",{className:"mt-6 p-4 rounded-xl text-center bg-gray-100 text-gray-800",children:[e.jsx("p",{className:"text-2xl font-bold",children:s("session.timeUp")}),e.jsx("p",{className:"text-lg",children:s("student.waitingForResults")})]})]})]})})}return a.status==="showing_results"&&h?e.jsx("div",{className:"min-h-screen flex items-center justify-center",style:me,children:e.jsxs("div",{className:"bg-white/95 backdrop-blur-sm rounded-2xl shadow-2xl p-12 text-center max-w-md",children:[e.jsx("div",{className:"mb-6",children:F?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-6xl mb-4",children:"🎉"}),e.jsx("h2",{className:"text-4xl font-bold text-green-600 mb-2",children:s("session.correctAnswer")})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-6xl mb-4",children:"😔"}),e.jsx("h2",{className:"text-4xl font-bold text-red-600 mb-2",children:s("student.incorrect")})]})}),_&&e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"text-gray-600 mb-2",children:s("student.theCorrectAnswerWas")}),e.jsx("p",{className:"text-xl font-bold text-green-600",children:(L=(xe=h.options)==null?void 0:xe.find(I=>I.is_correct))==null?void 0:L.text})]}),e.jsxs("div",{className:"bg-blue-50 rounded-xl p-6",children:[e.jsx("p",{className:"text-gray-600 mb-1",children:s("session.yourScore")}),e.jsx("p",{className:"text-4xl font-bold text-blue-700",children:(g==null?void 0:g.score)||0})]}),e.jsx("p",{className:"text-gray-600 mt-6",children:s("student.waitingForNextQuestion")})]})}):a.status==="completed"?e.jsx("div",{className:"min-h-screen flex items-center justify-center",style:me,children:e.jsxs("div",{className:"bg-white/95 backdrop-blur-sm rounded-2xl shadow-2xl p-12 text-center max-w-md",children:[e.jsx($e,{className:"mx-auto mb-6 text-yellow-500",size:80}),e.jsx("h2",{className:"text-4xl font-bold mb-6",children:s("student.quizComplete")}),e.jsxs("div",{className:"bg-blue-50 rounded-xl p-8 mb-6",children:[e.jsx("p",{className:"text-gray-600 mb-2",children:s("student.finalScore")}),e.jsx("p",{className:"text-5xl font-bold text-blue-700",children:(g==null?void 0:g.score)||0}),e.jsx("p",{className:"text-gray-600 mt-2",children:s("quiz.points")})]}),e.jsx("p",{className:"text-gray-600 mb-6",children:s("student.greatJob")}),e.jsx("button",{onClick:()=>t("student-dashboard"),className:"bg-blue-700 text-white px-8 py-3 rounded-lg hover:bg-blue-800 text-xl font-semibold",children:s("student.backToDashboard")})]})}):e.jsxs(e.Fragment,{children:[e.jsx(Ie,{isOpen:B.isOpen,title:B.title,message:B.message,type:B.type,onClose:()=>se({...B,isOpen:!1})}),e.jsx(Le,{isOpen:de.isOpen,title:de.title,message:de.message,onConfirm:de.onConfirm,onCancel:()=>q({...de,isOpen:!1}),confirmStyle:"danger"})]})}const ra=["https://api.dicebear.com/7.x/avataaars/svg?seed=Avatar1","https://api.dicebear.com/7.x/avataaars/svg?seed=Avatar2","https://api.dicebear.com/7.x/avataaars/svg?seed=Avatar3","https://api.dicebear.com/7.x/avataaars/svg?seed=Avatar4","https://api.dicebear.com/7.x/avataaars/svg?seed=Avatar5","https://api.dicebear.com/7.x/lorelei/svg?seed=Avatar6","https://api.dicebear.com/7.x/lorelei/svg?seed=Avatar7","https://api.dicebear.com/7.x/lorelei/svg?seed=Avatar8","https://api.dicebear.com/7.x/lorelei/svg?seed=Avatar9","https://api.dicebear.com/7.x/lorelei/svg?seed=Avatar10","https://api.dicebear.com/7.x/personas/svg?seed=Avatar11","https://api.dicebear.com/7.x/personas/svg?seed=Avatar12","https://api.dicebear.com/7.x/personas/svg?seed=Avatar13","https://api.dicebear.com/7.x/personas/svg?seed=Avatar14","https://api.dicebear.com/7.x/personas/svg?seed=Avatar15","https://api.dicebear.com/7.x/pixel-art/svg?seed=Avatar16","https://api.dicebear.com/7.x/pixel-art/svg?seed=Avatar17","https://api.dicebear.com/7.x/pixel-art/svg?seed=Avatar18","https://api.dicebear.com/7.x/pixel-art/svg?seed=Avatar19","https://api.dicebear.com/7.x/pixel-art/svg?seed=Avatar20","https://api.dicebear.com/7.x/big-ears/svg?seed=Avatar21","https://api.dicebear.com/7.x/big-ears/svg?seed=Avatar22","https://api.dicebear.com/7.x/big-ears/svg?seed=Avatar23","https://api.dicebear.com/7.x/big-ears/svg?seed=Avatar24","https://api.dicebear.com/7.x/big-ears/svg?seed=Avatar25","https://api.dicebear.com/7.x/bottts/svg?seed=Avatar26","https://api.dicebear.com/7.x/bottts/svg?seed=Avatar27","https://api.dicebear.com/7.x/bottts/svg?seed=Avatar28","https://api.dicebear.com/7.x/bottts/svg?seed=Avatar29","https://api.dicebear.com/7.x/bottts/svg?seed=Avatar30"];function aa({setView:n,appState:r,setAppState:t}){var w,O,A,C,Q,M,R,$,E;const{t:s}=qe(),[a,i]=c.useState("profile"),[o,l]=c.useState(!1),[d,u]=c.useState({type:"",text:""}),[g,m]=c.useState(!1),[h,b]=c.useState({name:((w=r.currentUser)==null?void 0:w.name)||"",email:((O=r.currentUser)==null?void 0:O.email)||"",avatar_url:((A=r.currentUser)==null?void 0:A.avatar_url)||""}),[z,k]=c.useState({currentPassword:"",newPassword:"",confirmPassword:""});c.useEffect(()=>{var _,D,F;b({name:((_=r.currentUser)==null?void 0:_.name)||"",email:((D=r.currentUser)==null?void 0:D.email)||"",avatar_url:((F=r.currentUser)==null?void 0:F.avatar_url)||""}),(async()=>{var J,X,ie;const{data:{user:G}}=await N.auth.getUser();if(G){const T=((J=G.app_metadata)==null?void 0:J.provider)==="google"||((ie=(X=G.app_metadata)==null?void 0:X.providers)==null?void 0:ie.includes("google"));m(T)}})()},[r.currentUser]);const f=async v=>{v.preventDefault(),l(!0),u({type:"",text:""});try{const{error:_}=await N.from("users").update({name:h.name,email:h.email,avatar_url:h.avatar_url}).eq("id",r.currentUser.id);if(_)throw _;t(D=>({...D,currentUser:{...D.currentUser,name:h.name,email:h.email,avatar_url:h.avatar_url}})),u({type:"success",text:s("settings.profileUpdated")})}catch(_){u({type:"error",text:_.message})}finally{l(!1)}},S=async v=>{if(v.preventDefault(),l(!0),u({type:"",text:""}),z.newPassword!==z.confirmPassword){u({type:"error",text:s("settings.passwordsDoNotMatch")}),l(!1);return}if(z.newPassword.length<6){u({type:"error",text:s("settings.passwordTooShort")}),l(!1);return}try{const{error:_}=await N.auth.updateUser({password:z.newPassword});if(_)throw _;u({type:"success",text:s("settings.passwordChanged")}),k({currentPassword:"",newPassword:"",confirmPassword:""})}catch(_){u({type:"error",text:_.message})}finally{l(!1)}};return e.jsxs("div",{className:"flex min-h-screen bg-gray-50",children:[e.jsx(Ee,{currentView:"settings",setView:n,appState:r}),e.jsxs("div",{className:"flex-1 md:ml-64 ml-0",children:[e.jsx("nav",{className:"bg-white shadow-sm border-b border-gray-200 px-4 md:px-6 py-3 md:py-4",children:e.jsx("h1",{className:"text-xl md:text-2xl font-bold text-blue-700",children:s("settings.settings")})}),e.jsxs("div",{className:"container mx-auto p-4 md:p-6 max-w-4xl",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-md mb-4 md:mb-6",children:[e.jsxs("div",{className:"flex border-b",children:[e.jsxs("button",{onClick:()=>i("profile"),className:`${g?"w-full":"flex-1"} px-3 md:px-6 py-3 md:py-4 text-center text-sm md:text-base font-medium transition-colors ${a==="profile"?"text-blue-700 border-b-2 border-blue-700":"text-gray-600 hover:text-blue-700"}`,children:[e.jsx(qs,{className:"inline-block mr-1 md:mr-2",size:18}),e.jsx("span",{className:"hidden sm:inline",children:s("settings.profile")}),e.jsx("span",{className:"sm:hidden",children:"Profile"})]}),!g&&e.jsxs("button",{onClick:()=>i("password"),className:`flex-1 px-3 md:px-6 py-3 md:py-4 text-center text-sm md:text-base font-medium transition-colors ${a==="password"?"text-blue-700 border-b-2 border-blue-700":"text-gray-600 hover:text-blue-700"}`,children:[e.jsx(Ht,{className:"inline-block mr-1 md:mr-2",size:18}),e.jsx("span",{className:"hidden sm:inline",children:s("settings.password")}),e.jsx("span",{className:"sm:hidden",children:"Password"})]})]}),d.text&&e.jsx("div",{className:`mx-4 md:mx-6 mt-4 md:mt-6 p-3 md:p-4 rounded-lg text-sm md:text-base ${d.type==="success"?"bg-green-50 text-green-800":"bg-red-50 text-red-800"}`,children:d.text}),a==="profile"&&e.jsxs("form",{onSubmit:f,className:"p-4 md:p-6 space-y-4 md:space-y-6",children:[g&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsxs("strong",{children:[s("common.note"),":"]})," You are signed in with Google. Your password is managed by Google and cannot be changed here."]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:s("settings.name")}),e.jsx("input",{type:"text",required:!0,placeholder:"Enter your full name",title:"Full Name",value:h.name,onChange:v=>b({...h,name:v.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:s("settings.email")}),e.jsx("input",{type:"email",required:!0,placeholder:"your.email@example.com",title:"Email Address",value:h.email,onChange:v=>b({...h,email:v.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:[e.jsx(yr,{className:"inline-block mr-2",size:18}),"Select Avatar"]}),e.jsx("div",{className:"grid grid-cols-4 sm:grid-cols-5 md:grid-cols-6 lg:grid-cols-8 gap-2 md:gap-4 mb-4 md:mb-6 p-3 md:p-4 bg-gray-50 rounded-lg max-h-80 overflow-y-auto",children:ra.map((v,_)=>e.jsxs("button",{type:"button",title:`Select avatar ${_+1}`,onClick:()=>b({...h,avatar_url:v}),className:`relative w-full aspect-square rounded-lg overflow-hidden border-2 transition-all active:scale-95 md:hover:scale-110 ${h.avatar_url===v?"border-blue-700 shadow-lg":"border-gray-300 hover:border-cyan-400"}`,children:[e.jsx("img",{src:v,alt:`Avatar option ${_+1}`,className:"w-full h-full object-cover"}),h.avatar_url===v&&e.jsx("div",{className:"absolute inset-0 bg-blue-700 bg-opacity-20 flex items-center justify-center",children:e.jsx(wt,{className:"text-blue-700 bg-white rounded-full p-1",size:20})})]},_))}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Or enter custom avatar URL"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("input",{type:"url",placeholder:s("settings.avatarUrlPlaceholder"),value:h.avatar_url,onChange:v=>b({...h,avatar_url:v.target.value}),className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent"}),h.avatar_url&&e.jsx("img",{src:h.avatar_url,alt:"Avatar preview",className:"w-10 h-10 rounded-full object-cover border border-gray-300",onError:v=>v.target.style.display="none"})]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:s("settings.avatarUrlHelp")})]})]}),e.jsxs("button",{type:"submit",disabled:o,className:"w-full bg-blue-700 text-white px-6 py-3 rounded-lg hover:bg-blue-800 disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center justify-center gap-2 transition-colors",children:[e.jsx(Me,{size:20}),s(o?"settings.saving":"settings.saveChanges")]})]}),a==="password"&&e.jsxs("form",{onSubmit:S,className:"p-4 md:p-6 space-y-4 md:space-y-6",children:[e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsxs("strong",{children:[s("common.note"),":"]})," ",s("settings.passwordNote")]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:s("settings.newPassword")}),e.jsx("input",{type:"password",required:!0,minLength:6,value:z.newPassword,onChange:v=>k({...z,newPassword:v.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent",placeholder:s("settings.newPasswordPlaceholder")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:s("settings.confirmNewPassword")}),e.jsx("input",{type:"password",required:!0,minLength:6,value:z.confirmPassword,onChange:v=>k({...z,confirmPassword:v.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent",placeholder:s("settings.confirmPasswordPlaceholder")})]}),e.jsxs("button",{type:"submit",disabled:o,className:"w-full bg-blue-700 text-white px-6 py-3 rounded-lg hover:bg-blue-800 disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center justify-center gap-2 transition-colors",children:[e.jsx(Ht,{size:20}),s(o?"settings.updating":"settings.changePassword")]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 md:p-6",children:[e.jsx("h3",{className:"text-base md:text-lg font-semibold text-gray-800 mb-3 md:mb-4",children:s("settings.accountInformation")}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-100",children:[e.jsx("span",{className:"text-gray-600",children:s("settings.role")}),e.jsx("span",{className:"font-medium capitalize text-blue-700",children:(C=r.currentUser)==null?void 0:C.role})]}),e.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-100",children:[e.jsx("span",{className:"text-gray-600",children:s("settings.accountStatus")}),e.jsx("span",{className:`font-medium px-3 py-1 rounded-full text-xs ${(Q=r.currentUser)!=null&&Q.verified&&((M=r.currentUser)!=null&&M.approved)?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"}`,children:(R=r.currentUser)!=null&&R.verified&&(($=r.currentUser)!=null&&$.approved)?s("settings.active"):s("settings.pendingApproval")})]}),((E=r.currentUser)==null?void 0:E.student_id)&&e.jsxs("div",{className:"flex justify-between items-center py-2",children:[e.jsx("span",{className:"text-gray-600",children:s("settings.studentId")}),e.jsx("span",{className:"font-medium text-gray-800",children:r.currentUser.student_id})]})]})]})]})]})]})}function na(){c.useEffect(()=>{try{["quizapp_view","quizapp_selectedQuizId","quizapp_selectedSessionId"].forEach(S=>{const w=sessionStorage.getItem(S);(w==="undefined"||w==="null")&&(console.log("[Session Persistence] Clearing corrupted storage key:",S),sessionStorage.removeItem(S))})}catch(f){console.error("[Session Persistence] Error clearing corrupted storage:",f)}},[]);const[n,r]=c.useState({users:[],quizzes:[],categories:[],currentUser:null,pendingVerifications:[],activeSessions:[]}),[t,s]=c.useState(()=>{try{const f=sessionStorage.getItem("quizapp_view");if(console.log("[Session Persistence] Initializing view from sessionStorage:",f),f&&f!=="undefined"&&f!=="null")return f}catch(f){console.error("[Session Persistence] Error reading view from sessionStorage:",f),sessionStorage.removeItem("quizapp_view")}return"login"}),[a,i]=c.useState(()=>{try{const f=sessionStorage.getItem("quizapp_selectedQuizId");if(console.log("[Session Persistence] Initializing selectedQuizId:",f),f&&f!=="undefined"&&f!=="null")return JSON.parse(f)}catch(f){console.error("[Session Persistence] Error reading selectedQuizId from sessionStorage:",f),sessionStorage.removeItem("quizapp_selectedQuizId")}return null}),[o,l]=c.useState(()=>{try{const f=sessionStorage.getItem("quizapp_selectedSessionId");if(console.log("[Session Persistence] Initializing selectedSessionId:",f),f&&f!=="undefined"&&f!=="null")return JSON.parse(f)}catch(f){console.error("[Session Persistence] Error reading selectedSessionId from sessionStorage:",f),sessionStorage.removeItem("quizapp_selectedSessionId")}return null}),[d,u]=c.useState(null),[g,m]=c.useState({}),[h,b]=c.useState(""),[z,k]=c.useState("");return c.useEffect(()=>{console.log("[Session Persistence] Saving view to sessionStorage:",t);try{t&&t!=="undefined"?sessionStorage.setItem("quizapp_view",t):sessionStorage.removeItem("quizapp_view")}catch(f){console.error("[Session Persistence] Error saving view:",f)}},[t]),c.useEffect(()=>{console.log("[Session Persistence] Saving selectedQuizId:",a);try{a!=null?sessionStorage.setItem("quizapp_selectedQuizId",JSON.stringify(a)):sessionStorage.removeItem("quizapp_selectedQuizId")}catch(f){console.error("[Session Persistence] Error saving selectedQuizId:",f)}},[a]),c.useEffect(()=>{console.log("[Session Persistence] Saving selectedSessionId:",o);try{o!=null?sessionStorage.setItem("quizapp_selectedSessionId",JSON.stringify(o)):sessionStorage.removeItem("quizapp_selectedSessionId")}catch(f){console.error("[Session Persistence] Error saving selectedSessionId:",f)}},[o]),c.useEffect(()=>{let f=!1;const S=A=>{const C=sessionStorage.getItem("quizapp_view"),Q=["teacher-control","student-quiz","edit-quiz","preview-quiz","manage-students","manage-quizzes","reports","settings","teacher-dashboard","student-dashboard","superadmin-dashboard","create-quiz","complete-profile","student-report","public-quizzes"];if(console.log("[routeByRole] Current view state:",t),console.log("[routeByRole] Saved view from storage:",C),console.log("[routeByRole] User role:",A),t&&Q.includes(t)||C&&Q.includes(C)){console.log("[routeByRole] Preserving current view, not redirecting");return}console.log("[routeByRole] No active view found, routing to dashboard"),s(A==="teacher"?"teacher-dashboard":A==="superadmin"?"superadmin-dashboard":A==="student"?"student-dashboard":"login")};(async()=>{var J,X;console.log("Loading initial session...");const{data:A,error:C}=await N.auth.getSession();if(C){console.error("Session error:",C),b(`Session error: ${C.message}`),r(ie=>({...ie,currentUser:null})),sessionStorage.removeItem("quizapp_view"),sessionStorage.removeItem("quizapp_selectedQuizId"),sessionStorage.removeItem("quizapp_selectedSessionId"),s("login");return}if(!(A!=null&&A.session)){console.log("No active session found"),r(ie=>({...ie,currentUser:null})),sessionStorage.removeItem("quizapp_view"),sessionStorage.removeItem("quizapp_selectedQuizId"),sessionStorage.removeItem("quizapp_selectedSessionId"),s("login");return}const Q=A.session,M=((J=Q.user)==null?void 0:J.app_metadata)||{},R=Array.isArray(M.providers)?M.providers:[],$=M.provider,E=R.includes("google")||$==="google",v=Q.user.id;console.log("Session found for user:",v);const{data:_,error:D}=await N.from("users").select("id, email, name, role, approved, verified, teacher_code, teacher_id, teacher_invite_code, avatar_url").eq("id",v).maybeSingle();if(f)return;if(D){console.error("Profile fetch error:",D),(X=D.message)!=null&&X.includes("teacher_invite_code")?b("Database schema is missing the teacher_invite_code column. Run add-teacher-invite-code-column.sql in Supabase."):b(`Failed to load profile: ${D.message}`),s("login");return}if(!_){console.warn("No profile found for user:",v),b("User profile not found. Please contact support."),s("login");return}console.log("Profile loaded:",_.email,"Role:",_.role);const F=_.teacher_invite_code||_.teacher_id||_.role==="teacher"&&_.teacher_code;if(E&&(!_.role||!F)){r(ie=>({...ie,currentUser:_})),s("complete-profile");return}if(_.role!=="superadmin"){if(!_.approved){console.warn("User not approved:",_.email),b("Your account is awaiting approval. Please wait for a teacher or admin to approve your account."),await N.auth.signOut(),s("login");return}if(!_.verified){console.warn("User email not verified:",_.email),b("Please verify your email before logging in. Check your inbox for a verification link."),await N.auth.signOut(),s("login");return}}r(ie=>({...ie,currentUser:_})),S(_.role)})();const{data:O}=N.auth.onAuthStateChange((A,C)=>{var Q;console.log("Auth state changed:",A,(Q=C==null?void 0:C.user)==null?void 0:Q.email),C?(async()=>{var $,E,v,_;const{data:M,error:R}=await N.from("users").select("id, role, email, name, approved, verified, teacher_code, teacher_id, teacher_invite_code, avatar_url").eq("id",C.user.id).maybeSingle();if(R){console.error("Profile fetch error on auth change:",R),($=R.message)!=null&&$.includes("teacher_invite_code")?b("Database schema is missing the teacher_invite_code column. Run add-teacher-invite-code-column.sql in Supabase."):b(`Failed to load profile: ${R.message}`),s("login");return}if(M){console.log("[onAuthStateChange] Profile loaded:",M.email,"Event:",A);const D=((E=C.user)==null?void 0:E.app_metadata)||{},F=Array.isArray(D.providers)?D.providers:[],G=D.provider,J=F.includes("google")||G==="google";if(C.user.email_confirmed_at!==null&&!M.verified){console.log("[onAuthStateChange] Email verified in Supabase, updating users table");const{error:q}=await N.from("users").update({verified:!0}).eq("id",C.user.id);q?console.error("Failed to update verified status:",q):(console.log("✅ User verified status synced to database"),M.verified=!0,k("Email verified successfully!"))}const ie=M.teacher_invite_code||M.teacher_id||M.role==="teacher"&&M.teacher_code;if(J&&(!M.role||!ie)){console.log("[onAuthStateChange] Profile incomplete, redirecting to completion flow"),r(q=>({...q,currentUser:M})),s("complete-profile");return}if(M.role!=="superadmin"){if(!M.approved){console.warn("[onAuthStateChange] User not approved:",M.email),b("Your account is awaiting approval. Please wait for a teacher or admin to approve your account."),await N.auth.signOut(),s("login");return}if(!M.verified){console.warn("[onAuthStateChange] User email not verified:",M.email),b("Please verify your email before logging in. Check your inbox for a verification link."),await N.auth.signOut(),s("login");return}}r(q=>({...q,currentUser:M}));const B=sessionStorage.getItem("quizapp_view"),se=["teacher-control","student-quiz","edit-quiz","preview-quiz","manage-students","manage-quizzes","reports","settings","teacher-dashboard","student-dashboard","superadmin-dashboard","create-quiz","complete-profile","student-report","public-quizzes"];console.log("[onAuthStateChange] Current view:",t),console.log("[onAuthStateChange] Saved view:",B),console.log("[onAuthStateChange] Event type:",A);const de=t&&se.includes(t)||B&&se.includes(B);A==="SIGNED_IN"&&!de?(console.log("[onAuthStateChange] Fresh sign-in detected, routing to dashboard"),M.role==="teacher"?s("teacher-dashboard"):M.role==="superadmin"?s("superadmin-dashboard"):s("student-dashboard")):console.log("[onAuthStateChange] Preserving current view (event:",A,", hasActiveView:",de,")")}else{console.log("No profile found for OAuth user:",C.user.id),console.log("User metadata:",C.user.user_metadata);const D=C.user.email,F=((v=C.user.user_metadata)==null?void 0:v.full_name)||((_=C.user.user_metadata)==null?void 0:_.name)||D.split("@")[0];console.log("Creating profile for new OAuth user:",D);const{data:G,error:J}=await N.from("users").insert([{id:C.user.id,email:D,name:F,role:null,teacher_invite_code:null,teacher_id:null,verified:!0,approved:!1}]).select().single();if(J){console.error("Failed to create profile for OAuth user:",J),b(`Failed to create user profile: ${J.message}. Please contact support.`),await N.auth.signOut(),s("login");return}console.log("Profile created successfully for OAuth user"),r(X=>({...X,currentUser:G})),k("Welcome! Almost done — please complete your profile."),s("complete-profile")}})():(r(M=>({...M,currentUser:null})),sessionStorage.removeItem("quizapp_view"),sessionStorage.removeItem("quizapp_selectedQuizId"),sessionStorage.removeItem("quizapp_selectedSessionId"),s("login"))});return()=>{var A,C;f=!0,(C=(A=O==null?void 0:O.subscription)==null?void 0:A.unsubscribe)==null||C.call(A)}},[]),t==="login"?e.jsx(Jt,{appState:n,setAppState:r,setView:s,setError:b,setSuccess:k}):t==="register"?e.jsx(Dr,{appState:n,setAppState:r,setView:s,formData:g,setFormData:m,error:h,setError:b,success:z,setSuccess:k}):t==="verify"?e.jsx(Or,{setView:s,setError:b,setSuccess:k}):t==="complete-profile"?e.jsx(Lr,{user:n.currentUser,setAppState:r,setView:s,setError:b,setSuccess:k}):t==="student-dashboard"?e.jsx($r,{appState:n,setAppState:r,setView:(f,S)=>{s(f),l(S)},error:h,setError:b}):t==="student-quiz"?e.jsx(sa,{sessionId:o,appState:n,setView:s}):t==="teacher-dashboard"?e.jsx(Ur,{appState:n,setAppState:r,setView:s}):t==="superadmin-dashboard"?e.jsx(Br,{appState:n,setAppState:r,setView:s}):t==="create-quiz"?e.jsx(Vr,{setView:s,appState:n}):t==="edit-quiz"?e.jsx(Kr,{setView:s,quizId:a,appState:n}):t==="preview-quiz"?e.jsx(Gr,{quizId:a,setView:f=>{s(f),f==="manage-quizzes"&&i(null)},returnView:"manage-quizzes"}):t==="teacher-control"?e.jsx(Jr,{sessionId:o,setView:s}):t==="manage-quizzes"?e.jsx(Yr,{setView:(f,S)=>{f==="edit-quiz"&&i(S),f==="preview-quiz"&&i(S),f==="teacher-control"&&l(S),s(f)},appState:n}):t==="manage-students"?e.jsx(Zr,{setView:s,appState:n}):t==="reports"?e.jsx(Xr,{setView:(f,S)=>{S!=null&&S.studentId&&u(S.studentId),s(f)},appState:n}):t==="student-report"?e.jsx(ea,{setView:s,studentId:d,appState:n}):t==="public-quizzes"?e.jsx(ta,{setView:(f,S)=>{f==="preview-quiz"&&i(S),s(f)},appState:n}):t==="settings"?e.jsx(aa,{setView:s,appState:n,setAppState:r}):e.jsx(Jt,{appState:n,setAppState:r,setView:s,setError:b,setSuccess:k})}const ue=n=>typeof n=="string",Xe=()=>{let n,r;const t=new Promise((s,a)=>{n=s,r=a});return t.resolve=n,t.reject=r,t},Zt=n=>n==null?"":""+n,ia=(n,r,t)=>{n.forEach(s=>{r[s]&&(t[s]=r[s])})},oa=/###/g,Xt=n=>n&&n.indexOf("###")>-1?n.replace(oa,"."):n,es=n=>!n||ue(n),st=(n,r,t)=>{const s=ue(r)?r.split("."):r;let a=0;for(;a<s.length-1;){if(es(n))return{};const i=Xt(s[a]);!n[i]&&t&&(n[i]=new t),Object.prototype.hasOwnProperty.call(n,i)?n=n[i]:n={},++a}return es(n)?{}:{obj:n,k:Xt(s[a])}},ts=(n,r,t)=>{const{obj:s,k:a}=st(n,r,Object);if(s!==void 0||r.length===1){s[a]=t;return}let i=r[r.length-1],o=r.slice(0,r.length-1),l=st(n,o,Object);for(;l.obj===void 0&&o.length;)i=`${o[o.length-1]}.${i}`,o=o.slice(0,o.length-1),l=st(n,o,Object),l!=null&&l.obj&&typeof l.obj[`${l.k}.${i}`]<"u"&&(l.obj=void 0);l.obj[`${l.k}.${i}`]=t},la=(n,r,t,s)=>{const{obj:a,k:i}=st(n,r,Object);a[i]=a[i]||[],a[i].push(t)},ft=(n,r)=>{const{obj:t,k:s}=st(n,r);if(t&&Object.prototype.hasOwnProperty.call(t,s))return t[s]},ca=(n,r,t)=>{const s=ft(n,t);return s!==void 0?s:ft(r,t)},Es=(n,r,t)=>{for(const s in r)s!=="__proto__"&&s!=="constructor"&&(s in n?ue(n[s])||n[s]instanceof String||ue(r[s])||r[s]instanceof String?t&&(n[s]=r[s]):Es(n[s],r[s],t):n[s]=r[s]);return n},Be=n=>n.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var da={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};const ua=n=>ue(n)?n.replace(/[&<>"'\/]/g,r=>da[r]):n;class ma{constructor(r){this.capacity=r,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(r){const t=this.regExpMap.get(r);if(t!==void 0)return t;const s=new RegExp(r);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(r,s),this.regExpQueue.push(r),s}}const ha=[" ",",","?","!",";"],ga=new ma(20),xa=(n,r,t)=>{r=r||"",t=t||"";const s=ha.filter(o=>r.indexOf(o)<0&&t.indexOf(o)<0);if(s.length===0)return!0;const a=ga.getRegExp(`(${s.map(o=>o==="?"?"\\?":o).join("|")})`);let i=!a.test(n);if(!i){const o=n.indexOf(t);o>0&&!a.test(n.substring(0,o))&&(i=!0)}return i},At=(n,r,t=".")=>{if(!n)return;if(n[r])return Object.prototype.hasOwnProperty.call(n,r)?n[r]:void 0;const s=r.split(t);let a=n;for(let i=0;i<s.length;){if(!a||typeof a!="object")return;let o,l="";for(let d=i;d<s.length;++d)if(d!==i&&(l+=t),l+=s[d],o=a[l],o!==void 0){if(["string","number","boolean"].indexOf(typeof o)>-1&&d<s.length-1)continue;i+=d-i+1;break}a=o}return a},at=n=>n==null?void 0:n.replace("_","-"),pa={type:"logger",log(n){this.output("log",n)},warn(n){this.output("warn",n)},error(n){this.output("error",n)},output(n,r){var t,s;(s=(t=console==null?void 0:console[n])==null?void 0:t.apply)==null||s.call(t,console,r)}};class bt{constructor(r,t={}){this.init(r,t)}init(r,t={}){this.prefix=t.prefix||"i18next:",this.logger=r||pa,this.options=t,this.debug=t.debug}log(...r){return this.forward(r,"log","",!0)}warn(...r){return this.forward(r,"warn","",!0)}error(...r){return this.forward(r,"error","")}deprecate(...r){return this.forward(r,"warn","WARNING DEPRECATED: ",!0)}forward(r,t,s,a){return a&&!this.debug?null:(ue(r[0])&&(r[0]=`${s}${this.prefix} ${r[0]}`),this.logger[t](r))}create(r){return new bt(this.logger,{prefix:`${this.prefix}:${r}:`,...this.options})}clone(r){return r=r||this.options,r.prefix=r.prefix||this.prefix,new bt(this.logger,r)}}var De=new bt;class Nt{constructor(){this.observers={}}on(r,t){return r.split(" ").forEach(s=>{this.observers[s]||(this.observers[s]=new Map);const a=this.observers[s].get(t)||0;this.observers[s].set(t,a+1)}),this}off(r,t){if(this.observers[r]){if(!t){delete this.observers[r];return}this.observers[r].delete(t)}}emit(r,...t){this.observers[r]&&Array.from(this.observers[r].entries()).forEach(([a,i])=>{for(let o=0;o<i;o++)a(...t)}),this.observers["*"]&&Array.from(this.observers["*"].entries()).forEach(([a,i])=>{for(let o=0;o<i;o++)a.apply(a,[r,...t])})}}class ss extends Nt{constructor(r,t={ns:["translation"],defaultNS:"translation"}){super(),this.data=r||{},this.options=t,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.options.ignoreJSONStructure===void 0&&(this.options.ignoreJSONStructure=!0)}addNamespaces(r){this.options.ns.indexOf(r)<0&&this.options.ns.push(r)}removeNamespaces(r){const t=this.options.ns.indexOf(r);t>-1&&this.options.ns.splice(t,1)}getResource(r,t,s,a={}){var u,g;const i=a.keySeparator!==void 0?a.keySeparator:this.options.keySeparator,o=a.ignoreJSONStructure!==void 0?a.ignoreJSONStructure:this.options.ignoreJSONStructure;let l;r.indexOf(".")>-1?l=r.split("."):(l=[r,t],s&&(Array.isArray(s)?l.push(...s):ue(s)&&i?l.push(...s.split(i)):l.push(s)));const d=ft(this.data,l);return!d&&!t&&!s&&r.indexOf(".")>-1&&(r=l[0],t=l[1],s=l.slice(2).join(".")),d||!o||!ue(s)?d:At((g=(u=this.data)==null?void 0:u[r])==null?void 0:g[t],s,i)}addResource(r,t,s,a,i={silent:!1}){const o=i.keySeparator!==void 0?i.keySeparator:this.options.keySeparator;let l=[r,t];s&&(l=l.concat(o?s.split(o):s)),r.indexOf(".")>-1&&(l=r.split("."),a=t,t=l[1]),this.addNamespaces(t),ts(this.data,l,a),i.silent||this.emit("added",r,t,s,a)}addResources(r,t,s,a={silent:!1}){for(const i in s)(ue(s[i])||Array.isArray(s[i]))&&this.addResource(r,t,i,s[i],{silent:!0});a.silent||this.emit("added",r,t,s)}addResourceBundle(r,t,s,a,i,o={silent:!1,skipCopy:!1}){let l=[r,t];r.indexOf(".")>-1&&(l=r.split("."),a=s,s=t,t=l[1]),this.addNamespaces(t);let d=ft(this.data,l)||{};o.skipCopy||(s=JSON.parse(JSON.stringify(s))),a?Es(d,s,i):d={...d,...s},ts(this.data,l,d),o.silent||this.emit("added",r,t,s)}removeResourceBundle(r,t){this.hasResourceBundle(r,t)&&delete this.data[r][t],this.removeNamespaces(t),this.emit("removed",r,t)}hasResourceBundle(r,t){return this.getResource(r,t)!==void 0}getResourceBundle(r,t){return t||(t=this.options.defaultNS),this.getResource(r,t)}getDataByLanguage(r){return this.data[r]}hasLanguageSomeTranslations(r){const t=this.getDataByLanguage(r);return!!(t&&Object.keys(t)||[]).find(a=>t[a]&&Object.keys(t[a]).length>0)}toJSON(){return this.data}}var Fs={processors:{},addPostProcessor(n){this.processors[n.name]=n},handle(n,r,t,s,a){return n.forEach(i=>{var o;r=((o=this.processors[i])==null?void 0:o.process(r,t,s,a))??r}),r}};const Ds=Symbol("i18next/PATH_KEY");function fa(){const n=[],r=Object.create(null);let t;return r.get=(s,a)=>{var i;return(i=t==null?void 0:t.revoke)==null||i.call(t),a===Ds?n:(n.push(a),t=Proxy.revocable(s,r),t.proxy)},Proxy.revocable(Object.create(null),r).proxy}function Et(n,r){const{[Ds]:t}=n(fa());return t.join((r==null?void 0:r.keySeparator)??".")}const rs={},as=n=>!ue(n)&&typeof n!="boolean"&&typeof n!="number";class yt extends Nt{constructor(r,t={}){super(),ia(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],r,this),this.options=t,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.logger=De.create("translator")}changeLanguage(r){r&&(this.language=r)}exists(r,t={interpolation:{}}){const s={...t};if(r==null)return!1;const a=this.resolve(r,s);return(a==null?void 0:a.res)!==void 0}extractFromKey(r,t){let s=t.nsSeparator!==void 0?t.nsSeparator:this.options.nsSeparator;s===void 0&&(s=":");const a=t.keySeparator!==void 0?t.keySeparator:this.options.keySeparator;let i=t.ns||this.options.defaultNS||[];const o=s&&r.indexOf(s)>-1,l=!this.options.userDefinedKeySeparator&&!t.keySeparator&&!this.options.userDefinedNsSeparator&&!t.nsSeparator&&!xa(r,s,a);if(o&&!l){const d=r.match(this.interpolator.nestingRegexp);if(d&&d.length>0)return{key:r,namespaces:ue(i)?[i]:i};const u=r.split(s);(s!==a||s===a&&this.options.ns.indexOf(u[0])>-1)&&(i=u.shift()),r=u.join(a)}return{key:r,namespaces:ue(i)?[i]:i}}translate(r,t,s){let a=typeof t=="object"?{...t}:t;if(typeof a!="object"&&this.options.overloadTranslationOptionHandler&&(a=this.options.overloadTranslationOptionHandler(arguments)),typeof a=="object"&&(a={...a}),a||(a={}),r==null)return"";typeof r=="function"&&(r=Et(r,{...this.options,...a})),Array.isArray(r)||(r=[String(r)]);const i=a.returnDetails!==void 0?a.returnDetails:this.options.returnDetails,o=a.keySeparator!==void 0?a.keySeparator:this.options.keySeparator,{key:l,namespaces:d}=this.extractFromKey(r[r.length-1],a),u=d[d.length-1];let g=a.nsSeparator!==void 0?a.nsSeparator:this.options.nsSeparator;g===void 0&&(g=":");const m=a.lng||this.language,h=a.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if((m==null?void 0:m.toLowerCase())==="cimode")return h?i?{res:`${u}${g}${l}`,usedKey:l,exactUsedKey:l,usedLng:m,usedNS:u,usedParams:this.getUsedParamsDetails(a)}:`${u}${g}${l}`:i?{res:l,usedKey:l,exactUsedKey:l,usedLng:m,usedNS:u,usedParams:this.getUsedParamsDetails(a)}:l;const b=this.resolve(r,a);let z=b==null?void 0:b.res;const k=(b==null?void 0:b.usedKey)||l,f=(b==null?void 0:b.exactUsedKey)||l,S=["[object Number]","[object Function]","[object RegExp]"],w=a.joinArrays!==void 0?a.joinArrays:this.options.joinArrays,O=!this.i18nFormat||this.i18nFormat.handleAsObject,A=a.count!==void 0&&!ue(a.count),C=yt.hasDefaultValue(a),Q=A?this.pluralResolver.getSuffix(m,a.count,a):"",M=a.ordinal&&A?this.pluralResolver.getSuffix(m,a.count,{ordinal:!1}):"",R=A&&!a.ordinal&&a.count===0,$=R&&a[`defaultValue${this.options.pluralSeparator}zero`]||a[`defaultValue${Q}`]||a[`defaultValue${M}`]||a.defaultValue;let E=z;O&&!z&&C&&(E=$);const v=as(E),_=Object.prototype.toString.apply(E);if(O&&E&&v&&S.indexOf(_)<0&&!(ue(w)&&Array.isArray(E))){if(!a.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const D=this.options.returnedObjectHandler?this.options.returnedObjectHandler(k,E,{...a,ns:d}):`key '${l} (${this.language})' returned an object instead of string.`;return i?(b.res=D,b.usedParams=this.getUsedParamsDetails(a),b):D}if(o){const D=Array.isArray(E),F=D?[]:{},G=D?f:k;for(const J in E)if(Object.prototype.hasOwnProperty.call(E,J)){const X=`${G}${o}${J}`;C&&!z?F[J]=this.translate(X,{...a,defaultValue:as($)?$[J]:void 0,joinArrays:!1,ns:d}):F[J]=this.translate(X,{...a,joinArrays:!1,ns:d}),F[J]===X&&(F[J]=E[J])}z=F}}else if(O&&ue(w)&&Array.isArray(z))z=z.join(w),z&&(z=this.extendTranslation(z,r,a,s));else{let D=!1,F=!1;!this.isValidLookup(z)&&C&&(D=!0,z=$),this.isValidLookup(z)||(F=!0,z=l);const J=(a.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&F?void 0:z,X=C&&$!==z&&this.options.updateMissing;if(F||D||X){if(this.logger.log(X?"updateKey":"missingKey",m,u,l,X?$:z),o){const se=this.resolve(l,{...a,keySeparator:!1});se&&se.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let ie=[];const T=this.languageUtils.getFallbackCodes(this.options.fallbackLng,a.lng||this.language);if(this.options.saveMissingTo==="fallback"&&T&&T[0])for(let se=0;se<T.length;se++)ie.push(T[se]);else this.options.saveMissingTo==="all"?ie=this.languageUtils.toResolveHierarchy(a.lng||this.language):ie.push(a.lng||this.language);const B=(se,de,q)=>{var oe;const Y=C&&q!==z?q:J;this.options.missingKeyHandler?this.options.missingKeyHandler(se,u,de,Y,X,a):(oe=this.backendConnector)!=null&&oe.saveMissing&&this.backendConnector.saveMissing(se,u,de,Y,X,a),this.emit("missingKey",se,u,de,z)};this.options.saveMissing&&(this.options.saveMissingPlurals&&A?ie.forEach(se=>{const de=this.pluralResolver.getSuffixes(se,a);R&&a[`defaultValue${this.options.pluralSeparator}zero`]&&de.indexOf(`${this.options.pluralSeparator}zero`)<0&&de.push(`${this.options.pluralSeparator}zero`),de.forEach(q=>{B([se],l+q,a[`defaultValue${q}`]||$)})}):B(ie,l,$))}z=this.extendTranslation(z,r,a,b,s),F&&z===l&&this.options.appendNamespaceToMissingKey&&(z=`${u}${g}${l}`),(F||D)&&this.options.parseMissingKeyHandler&&(z=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${u}${g}${l}`:l,D?z:void 0,a))}return i?(b.res=z,b.usedParams=this.getUsedParamsDetails(a),b):z}extendTranslation(r,t,s,a,i){var d,u;if((d=this.i18nFormat)!=null&&d.parse)r=this.i18nFormat.parse(r,{...this.options.interpolation.defaultVariables,...s},s.lng||this.language||a.usedLng,a.usedNS,a.usedKey,{resolved:a});else if(!s.skipInterpolation){s.interpolation&&this.interpolator.init({...s,interpolation:{...this.options.interpolation,...s.interpolation}});const g=ue(r)&&(((u=s==null?void 0:s.interpolation)==null?void 0:u.skipOnVariables)!==void 0?s.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let m;if(g){const b=r.match(this.interpolator.nestingRegexp);m=b&&b.length}let h=s.replace&&!ue(s.replace)?s.replace:s;if(this.options.interpolation.defaultVariables&&(h={...this.options.interpolation.defaultVariables,...h}),r=this.interpolator.interpolate(r,h,s.lng||this.language||a.usedLng,s),g){const b=r.match(this.interpolator.nestingRegexp),z=b&&b.length;m<z&&(s.nest=!1)}!s.lng&&a&&a.res&&(s.lng=this.language||a.usedLng),s.nest!==!1&&(r=this.interpolator.nest(r,(...b)=>(i==null?void 0:i[0])===b[0]&&!s.context?(this.logger.warn(`It seems you are nesting recursively key: ${b[0]} in key: ${t[0]}`),null):this.translate(...b,t),s)),s.interpolation&&this.interpolator.reset()}const o=s.postProcess||this.options.postProcess,l=ue(o)?[o]:o;return r!=null&&(l!=null&&l.length)&&s.applyPostProcessor!==!1&&(r=Fs.handle(l,r,t,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...a,usedParams:this.getUsedParamsDetails(s)},...s}:s,this)),r}resolve(r,t={}){let s,a,i,o,l;return ue(r)&&(r=[r]),r.forEach(d=>{if(this.isValidLookup(s))return;const u=this.extractFromKey(d,t),g=u.key;a=g;let m=u.namespaces;this.options.fallbackNS&&(m=m.concat(this.options.fallbackNS));const h=t.count!==void 0&&!ue(t.count),b=h&&!t.ordinal&&t.count===0,z=t.context!==void 0&&(ue(t.context)||typeof t.context=="number")&&t.context!=="",k=t.lngs?t.lngs:this.languageUtils.toResolveHierarchy(t.lng||this.language,t.fallbackLng);m.forEach(f=>{var S,w;this.isValidLookup(s)||(l=f,!rs[`${k[0]}-${f}`]&&((S=this.utils)!=null&&S.hasLoadedNamespace)&&!((w=this.utils)!=null&&w.hasLoadedNamespace(l))&&(rs[`${k[0]}-${f}`]=!0,this.logger.warn(`key "${a}" for languages "${k.join(", ")}" won't get resolved as namespace "${l}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),k.forEach(O=>{var Q;if(this.isValidLookup(s))return;o=O;const A=[g];if((Q=this.i18nFormat)!=null&&Q.addLookupKeys)this.i18nFormat.addLookupKeys(A,g,O,f,t);else{let M;h&&(M=this.pluralResolver.getSuffix(O,t.count,t));const R=`${this.options.pluralSeparator}zero`,$=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(h&&(t.ordinal&&M.indexOf($)===0&&A.push(g+M.replace($,this.options.pluralSeparator)),A.push(g+M),b&&A.push(g+R)),z){const E=`${g}${this.options.contextSeparator||"_"}${t.context}`;A.push(E),h&&(t.ordinal&&M.indexOf($)===0&&A.push(E+M.replace($,this.options.pluralSeparator)),A.push(E+M),b&&A.push(E+R))}}let C;for(;C=A.pop();)this.isValidLookup(s)||(i=C,s=this.getResource(O,f,C,t))}))})}),{res:s,usedKey:a,exactUsedKey:i,usedLng:o,usedNS:l}}isValidLookup(r){return r!==void 0&&!(!this.options.returnNull&&r===null)&&!(!this.options.returnEmptyString&&r==="")}getResource(r,t,s,a={}){var i;return(i=this.i18nFormat)!=null&&i.getResource?this.i18nFormat.getResource(r,t,s,a):this.resourceStore.getResource(r,t,s,a)}getUsedParamsDetails(r={}){const t=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],s=r.replace&&!ue(r.replace);let a=s?r.replace:r;if(s&&typeof r.count<"u"&&(a.count=r.count),this.options.interpolation.defaultVariables&&(a={...this.options.interpolation.defaultVariables,...a}),!s){a={...a};for(const i of t)delete a[i]}return a}static hasDefaultValue(r){const t="defaultValue";for(const s in r)if(Object.prototype.hasOwnProperty.call(r,s)&&t===s.substring(0,t.length)&&r[s]!==void 0)return!0;return!1}}class ns{constructor(r){this.options=r,this.supportedLngs=this.options.supportedLngs||!1,this.logger=De.create("languageUtils")}getScriptPartFromCode(r){if(r=at(r),!r||r.indexOf("-")<0)return null;const t=r.split("-");return t.length===2||(t.pop(),t[t.length-1].toLowerCase()==="x")?null:this.formatLanguageCode(t.join("-"))}getLanguagePartFromCode(r){if(r=at(r),!r||r.indexOf("-")<0)return r;const t=r.split("-");return this.formatLanguageCode(t[0])}formatLanguageCode(r){if(ue(r)&&r.indexOf("-")>-1){let t;try{t=Intl.getCanonicalLocales(r)[0]}catch{}return t&&this.options.lowerCaseLng&&(t=t.toLowerCase()),t||(this.options.lowerCaseLng?r.toLowerCase():r)}return this.options.cleanCode||this.options.lowerCaseLng?r.toLowerCase():r}isSupportedCode(r){return(this.options.load==="languageOnly"||this.options.nonExplicitSupportedLngs)&&(r=this.getLanguagePartFromCode(r)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(r)>-1}getBestMatchFromCodes(r){if(!r)return null;let t;return r.forEach(s=>{if(t)return;const a=this.formatLanguageCode(s);(!this.options.supportedLngs||this.isSupportedCode(a))&&(t=a)}),!t&&this.options.supportedLngs&&r.forEach(s=>{if(t)return;const a=this.getScriptPartFromCode(s);if(this.isSupportedCode(a))return t=a;const i=this.getLanguagePartFromCode(s);if(this.isSupportedCode(i))return t=i;t=this.options.supportedLngs.find(o=>{if(o===i)return o;if(!(o.indexOf("-")<0&&i.indexOf("-")<0)&&(o.indexOf("-")>0&&i.indexOf("-")<0&&o.substring(0,o.indexOf("-"))===i||o.indexOf(i)===0&&i.length>1))return o})}),t||(t=this.getFallbackCodes(this.options.fallbackLng)[0]),t}getFallbackCodes(r,t){if(!r)return[];if(typeof r=="function"&&(r=r(t)),ue(r)&&(r=[r]),Array.isArray(r))return r;if(!t)return r.default||[];let s=r[t];return s||(s=r[this.getScriptPartFromCode(t)]),s||(s=r[this.formatLanguageCode(t)]),s||(s=r[this.getLanguagePartFromCode(t)]),s||(s=r.default),s||[]}toResolveHierarchy(r,t){const s=this.getFallbackCodes((t===!1?[]:t)||this.options.fallbackLng||[],r),a=[],i=o=>{o&&(this.isSupportedCode(o)?a.push(o):this.logger.warn(`rejecting language code not found in supportedLngs: ${o}`))};return ue(r)&&(r.indexOf("-")>-1||r.indexOf("_")>-1)?(this.options.load!=="languageOnly"&&i(this.formatLanguageCode(r)),this.options.load!=="languageOnly"&&this.options.load!=="currentOnly"&&i(this.getScriptPartFromCode(r)),this.options.load!=="currentOnly"&&i(this.getLanguagePartFromCode(r))):ue(r)&&i(this.formatLanguageCode(r)),s.forEach(o=>{a.indexOf(o)<0&&i(this.formatLanguageCode(o))}),a}}const is={zero:0,one:1,two:2,few:3,many:4,other:5},os={select:n=>n===1?"one":"other",resolvedOptions:()=>({pluralCategories:["one","other"]})};class ba{constructor(r,t={}){this.languageUtils=r,this.options=t,this.logger=De.create("pluralResolver"),this.pluralRulesCache={}}addRule(r,t){this.rules[r]=t}clearCache(){this.pluralRulesCache={}}getRule(r,t={}){const s=at(r==="dev"?"en":r),a=t.ordinal?"ordinal":"cardinal",i=JSON.stringify({cleanedCode:s,type:a});if(i in this.pluralRulesCache)return this.pluralRulesCache[i];let o;try{o=new Intl.PluralRules(s,{type:a})}catch{if(!Intl)return this.logger.error("No Intl support, please use an Intl polyfill!"),os;if(!r.match(/-|_/))return os;const d=this.languageUtils.getLanguagePartFromCode(r);o=this.getRule(d,t)}return this.pluralRulesCache[i]=o,o}needsPlural(r,t={}){let s=this.getRule(r,t);return s||(s=this.getRule("dev",t)),(s==null?void 0:s.resolvedOptions().pluralCategories.length)>1}getPluralFormsOfKey(r,t,s={}){return this.getSuffixes(r,s).map(a=>`${t}${a}`)}getSuffixes(r,t={}){let s=this.getRule(r,t);return s||(s=this.getRule("dev",t)),s?s.resolvedOptions().pluralCategories.sort((a,i)=>is[a]-is[i]).map(a=>`${this.options.prepend}${t.ordinal?`ordinal${this.options.prepend}`:""}${a}`):[]}getSuffix(r,t,s={}){const a=this.getRule(r,s);return a?`${this.options.prepend}${s.ordinal?`ordinal${this.options.prepend}`:""}${a.select(t)}`:(this.logger.warn(`no plural rule found for: ${r}`),this.getSuffix("dev",t,s))}}const ls=(n,r,t,s=".",a=!0)=>{let i=ca(n,r,t);return!i&&a&&ue(t)&&(i=At(n,t,s),i===void 0&&(i=At(r,t,s))),i},Ct=n=>n.replace(/\$/g,"$$$$");class ya{constructor(r={}){var t;this.logger=De.create("interpolator"),this.options=r,this.format=((t=r==null?void 0:r.interpolation)==null?void 0:t.format)||(s=>s),this.init(r)}init(r={}){r.interpolation||(r.interpolation={escapeValue:!0});const{escape:t,escapeValue:s,useRawValueToEscape:a,prefix:i,prefixEscaped:o,suffix:l,suffixEscaped:d,formatSeparator:u,unescapeSuffix:g,unescapePrefix:m,nestingPrefix:h,nestingPrefixEscaped:b,nestingSuffix:z,nestingSuffixEscaped:k,nestingOptionsSeparator:f,maxReplaces:S,alwaysFormat:w}=r.interpolation;this.escape=t!==void 0?t:ua,this.escapeValue=s!==void 0?s:!0,this.useRawValueToEscape=a!==void 0?a:!1,this.prefix=i?Be(i):o||"{{",this.suffix=l?Be(l):d||"}}",this.formatSeparator=u||",",this.unescapePrefix=g?"":m||"-",this.unescapeSuffix=this.unescapePrefix?"":g||"",this.nestingPrefix=h?Be(h):b||Be("$t("),this.nestingSuffix=z?Be(z):k||Be(")"),this.nestingOptionsSeparator=f||",",this.maxReplaces=S||1e3,this.alwaysFormat=w!==void 0?w:!1,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const r=(t,s)=>(t==null?void 0:t.source)===s?(t.lastIndex=0,t):new RegExp(s,"g");this.regexp=r(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=r(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=r(this.nestingRegexp,`${this.nestingPrefix}((?:[^()"']+|"[^"]*"|'[^']*'|\\((?:[^()]|"[^"]*"|'[^']*')*\\))*?)${this.nestingSuffix}`)}interpolate(r,t,s,a){var b;let i,o,l;const d=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},u=z=>{if(z.indexOf(this.formatSeparator)<0){const w=ls(t,d,z,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(w,void 0,s,{...a,...t,interpolationkey:z}):w}const k=z.split(this.formatSeparator),f=k.shift().trim(),S=k.join(this.formatSeparator).trim();return this.format(ls(t,d,f,this.options.keySeparator,this.options.ignoreJSONStructure),S,s,{...a,...t,interpolationkey:f})};this.resetRegExp();const g=(a==null?void 0:a.missingInterpolationHandler)||this.options.missingInterpolationHandler,m=((b=a==null?void 0:a.interpolation)==null?void 0:b.skipOnVariables)!==void 0?a.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:z=>Ct(z)},{regex:this.regexp,safeValue:z=>this.escapeValue?Ct(this.escape(z)):Ct(z)}].forEach(z=>{for(l=0;i=z.regex.exec(r);){const k=i[1].trim();if(o=u(k),o===void 0)if(typeof g=="function"){const S=g(r,i,a);o=ue(S)?S:""}else if(a&&Object.prototype.hasOwnProperty.call(a,k))o="";else if(m){o=i[0];continue}else this.logger.warn(`missed to pass in variable ${k} for interpolating ${r}`),o="";else!ue(o)&&!this.useRawValueToEscape&&(o=Zt(o));const f=z.safeValue(o);if(r=r.replace(i[0],f),m?(z.regex.lastIndex+=o.length,z.regex.lastIndex-=i[0].length):z.regex.lastIndex=0,l++,l>=this.maxReplaces)break}}),r}nest(r,t,s={}){let a,i,o;const l=(d,u)=>{const g=this.nestingOptionsSeparator;if(d.indexOf(g)<0)return d;const m=d.split(new RegExp(`${g}[ ]*{`));let h=`{${m[1]}`;d=m[0],h=this.interpolate(h,o);const b=h.match(/'/g),z=h.match(/"/g);(((b==null?void 0:b.length)??0)%2===0&&!z||z.length%2!==0)&&(h=h.replace(/'/g,'"'));try{o=JSON.parse(h),u&&(o={...u,...o})}catch(k){return this.logger.warn(`failed parsing options string in nesting for key ${d}`,k),`${d}${g}${h}`}return o.defaultValue&&o.defaultValue.indexOf(this.prefix)>-1&&delete o.defaultValue,d};for(;a=this.nestingRegexp.exec(r);){let d=[];o={...s},o=o.replace&&!ue(o.replace)?o.replace:o,o.applyPostProcessor=!1,delete o.defaultValue;const u=/{.*}/.test(a[1])?a[1].lastIndexOf("}")+1:a[1].indexOf(this.formatSeparator);if(u!==-1&&(d=a[1].slice(u).split(this.formatSeparator).map(g=>g.trim()).filter(Boolean),a[1]=a[1].slice(0,u)),i=t(l.call(this,a[1].trim(),o),o),i&&a[0]===r&&!ue(i))return i;ue(i)||(i=Zt(i)),i||(this.logger.warn(`missed to resolve ${a[1]} for nesting ${r}`),i=""),d.length&&(i=d.reduce((g,m)=>this.format(g,m,s.lng,{...s,interpolationkey:a[1].trim()}),i.trim())),r=r.replace(a[0],i),this.regexp.lastIndex=0}return r}}const va=n=>{let r=n.toLowerCase().trim();const t={};if(n.indexOf("(")>-1){const s=n.split("(");r=s[0].toLowerCase().trim();const a=s[1].substring(0,s[1].length-1);r==="currency"&&a.indexOf(":")<0?t.currency||(t.currency=a.trim()):r==="relativetime"&&a.indexOf(":")<0?t.range||(t.range=a.trim()):a.split(";").forEach(o=>{if(o){const[l,...d]=o.split(":"),u=d.join(":").trim().replace(/^'+|'+$/g,""),g=l.trim();t[g]||(t[g]=u),u==="false"&&(t[g]=!1),u==="true"&&(t[g]=!0),isNaN(u)||(t[g]=parseInt(u,10))}})}return{formatName:r,formatOptions:t}},cs=n=>{const r={};return(t,s,a)=>{let i=a;a&&a.interpolationkey&&a.formatParams&&a.formatParams[a.interpolationkey]&&a[a.interpolationkey]&&(i={...i,[a.interpolationkey]:void 0});const o=s+JSON.stringify(i);let l=r[o];return l||(l=n(at(s),a),r[o]=l),l(t)}},ja=n=>(r,t,s)=>n(at(t),s)(r);class wa{constructor(r={}){this.logger=De.create("formatter"),this.options=r,this.init(r)}init(r,t={interpolation:{}}){this.formatSeparator=t.interpolation.formatSeparator||",";const s=t.cacheInBuiltFormats?cs:ja;this.formats={number:s((a,i)=>{const o=new Intl.NumberFormat(a,{...i});return l=>o.format(l)}),currency:s((a,i)=>{const o=new Intl.NumberFormat(a,{...i,style:"currency"});return l=>o.format(l)}),datetime:s((a,i)=>{const o=new Intl.DateTimeFormat(a,{...i});return l=>o.format(l)}),relativetime:s((a,i)=>{const o=new Intl.RelativeTimeFormat(a,{...i});return l=>o.format(l,i.range||"day")}),list:s((a,i)=>{const o=new Intl.ListFormat(a,{...i});return l=>o.format(l)})}}add(r,t){this.formats[r.toLowerCase().trim()]=t}addCached(r,t){this.formats[r.toLowerCase().trim()]=cs(t)}format(r,t,s,a={}){const i=t.split(this.formatSeparator);if(i.length>1&&i[0].indexOf("(")>1&&i[0].indexOf(")")<0&&i.find(l=>l.indexOf(")")>-1)){const l=i.findIndex(d=>d.indexOf(")")>-1);i[0]=[i[0],...i.splice(1,l)].join(this.formatSeparator)}return i.reduce((l,d)=>{var m;const{formatName:u,formatOptions:g}=va(d);if(this.formats[u]){let h=l;try{const b=((m=a==null?void 0:a.formatParams)==null?void 0:m[a.interpolationkey])||{},z=b.locale||b.lng||a.locale||a.lng||s;h=this.formats[u](l,z,{...g,...a,...b})}catch(b){this.logger.warn(b)}return h}else this.logger.warn(`there was no format function for ${u}`);return l},r)}}const Na=(n,r)=>{n.pending[r]!==void 0&&(delete n.pending[r],n.pendingCount--)};class za extends Nt{constructor(r,t,s,a={}){var i,o;super(),this.backend=r,this.store=t,this.services=s,this.languageUtils=s.languageUtils,this.options=a,this.logger=De.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=a.maxParallelReads||10,this.readingCalls=0,this.maxRetries=a.maxRetries>=0?a.maxRetries:5,this.retryTimeout=a.retryTimeout>=1?a.retryTimeout:350,this.state={},this.queue=[],(o=(i=this.backend)==null?void 0:i.init)==null||o.call(i,s,a.backend,a)}queueLoad(r,t,s,a){const i={},o={},l={},d={};return r.forEach(u=>{let g=!0;t.forEach(m=>{const h=`${u}|${m}`;!s.reload&&this.store.hasResourceBundle(u,m)?this.state[h]=2:this.state[h]<0||(this.state[h]===1?o[h]===void 0&&(o[h]=!0):(this.state[h]=1,g=!1,o[h]===void 0&&(o[h]=!0),i[h]===void 0&&(i[h]=!0),d[m]===void 0&&(d[m]=!0)))}),g||(l[u]=!0)}),(Object.keys(i).length||Object.keys(o).length)&&this.queue.push({pending:o,pendingCount:Object.keys(o).length,loaded:{},errors:[],callback:a}),{toLoad:Object.keys(i),pending:Object.keys(o),toLoadLanguages:Object.keys(l),toLoadNamespaces:Object.keys(d)}}loaded(r,t,s){const a=r.split("|"),i=a[0],o=a[1];t&&this.emit("failedLoading",i,o,t),!t&&s&&this.store.addResourceBundle(i,o,s,void 0,void 0,{skipCopy:!0}),this.state[r]=t?-1:2,t&&s&&(this.state[r]=0);const l={};this.queue.forEach(d=>{la(d.loaded,[i],o),Na(d,r),t&&d.errors.push(t),d.pendingCount===0&&!d.done&&(Object.keys(d.loaded).forEach(u=>{l[u]||(l[u]={});const g=d.loaded[u];g.length&&g.forEach(m=>{l[u][m]===void 0&&(l[u][m]=!0)})}),d.done=!0,d.errors.length?d.callback(d.errors):d.callback())}),this.emit("loaded",l),this.queue=this.queue.filter(d=>!d.done)}read(r,t,s,a=0,i=this.retryTimeout,o){if(!r.length)return o(null,{});if(this.readingCalls>=this.maxParallelReads){this.waitingReads.push({lng:r,ns:t,fcName:s,tried:a,wait:i,callback:o});return}this.readingCalls++;const l=(u,g)=>{if(this.readingCalls--,this.waitingReads.length>0){const m=this.waitingReads.shift();this.read(m.lng,m.ns,m.fcName,m.tried,m.wait,m.callback)}if(u&&g&&a<this.maxRetries){setTimeout(()=>{this.read.call(this,r,t,s,a+1,i*2,o)},i);return}o(u,g)},d=this.backend[s].bind(this.backend);if(d.length===2){try{const u=d(r,t);u&&typeof u.then=="function"?u.then(g=>l(null,g)).catch(l):l(null,u)}catch(u){l(u)}return}return d(r,t,l)}prepareLoading(r,t,s={},a){if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),a&&a();ue(r)&&(r=this.languageUtils.toResolveHierarchy(r)),ue(t)&&(t=[t]);const i=this.queueLoad(r,t,s,a);if(!i.toLoad.length)return i.pending.length||a(),null;i.toLoad.forEach(o=>{this.loadOne(o)})}load(r,t,s){this.prepareLoading(r,t,{},s)}reload(r,t,s){this.prepareLoading(r,t,{reload:!0},s)}loadOne(r,t=""){const s=r.split("|"),a=s[0],i=s[1];this.read(a,i,"read",void 0,void 0,(o,l)=>{o&&this.logger.warn(`${t}loading namespace ${i} for language ${a} failed`,o),!o&&l&&this.logger.log(`${t}loaded namespace ${i} for language ${a}`,l),this.loaded(r,o,l)})}saveMissing(r,t,s,a,i,o={},l=()=>{}){var d,u,g,m,h;if((u=(d=this.services)==null?void 0:d.utils)!=null&&u.hasLoadedNamespace&&!((m=(g=this.services)==null?void 0:g.utils)!=null&&m.hasLoadedNamespace(t))){this.logger.warn(`did not save key "${s}" as the namespace "${t}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!");return}if(!(s==null||s==="")){if((h=this.backend)!=null&&h.create){const b={...o,isUpdate:i},z=this.backend.create.bind(this.backend);if(z.length<6)try{let k;z.length===5?k=z(r,t,s,a,b):k=z(r,t,s,a),k&&typeof k.then=="function"?k.then(f=>l(null,f)).catch(l):l(null,k)}catch(k){l(k)}else z(r,t,s,a,l,b)}!r||!r[0]||this.store.addResource(r[0],t,s,a)}}}const ds=()=>({debug:!1,initAsync:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:n=>{let r={};if(typeof n[1]=="object"&&(r=n[1]),ue(n[1])&&(r.defaultValue=n[1]),ue(n[2])&&(r.tDescription=n[2]),typeof n[2]=="object"||typeof n[3]=="object"){const t=n[3]||n[2];Object.keys(t).forEach(s=>{r[s]=t[s]})}return r},interpolation:{escapeValue:!0,format:n=>n,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0},cacheInBuiltFormats:!0}),us=n=>{var r,t;return ue(n.ns)&&(n.ns=[n.ns]),ue(n.fallbackLng)&&(n.fallbackLng=[n.fallbackLng]),ue(n.fallbackNS)&&(n.fallbackNS=[n.fallbackNS]),((t=(r=n.supportedLngs)==null?void 0:r.indexOf)==null?void 0:t.call(r,"cimode"))<0&&(n.supportedLngs=n.supportedLngs.concat(["cimode"])),typeof n.initImmediate=="boolean"&&(n.initAsync=n.initImmediate),n},lt=()=>{},Sa=n=>{Object.getOwnPropertyNames(Object.getPrototypeOf(n)).forEach(t=>{typeof n[t]=="function"&&(n[t]=n[t].bind(n))})};class nt extends Nt{constructor(r={},t){if(super(),this.options=us(r),this.services={},this.logger=De,this.modules={external:[]},Sa(this),t&&!this.isInitialized&&!r.isClone){if(!this.options.initAsync)return this.init(r,t),this;setTimeout(()=>{this.init(r,t)},0)}}init(r={},t){this.isInitializing=!0,typeof r=="function"&&(t=r,r={}),r.defaultNS==null&&r.ns&&(ue(r.ns)?r.defaultNS=r.ns:r.ns.indexOf("translation")<0&&(r.defaultNS=r.ns[0]));const s=ds();this.options={...s,...this.options,...us(r)},this.options.interpolation={...s.interpolation,...this.options.interpolation},r.keySeparator!==void 0&&(this.options.userDefinedKeySeparator=r.keySeparator),r.nsSeparator!==void 0&&(this.options.userDefinedNsSeparator=r.nsSeparator);const a=u=>u?typeof u=="function"?new u:u:null;if(!this.options.isClone){this.modules.logger?De.init(a(this.modules.logger),this.options):De.init(null,this.options);let u;this.modules.formatter?u=this.modules.formatter:u=wa;const g=new ns(this.options);this.store=new ss(this.options.resources,this.options);const m=this.services;m.logger=De,m.resourceStore=this.store,m.languageUtils=g,m.pluralResolver=new ba(g,{prepend:this.options.pluralSeparator,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),this.options.interpolation.format&&this.options.interpolation.format!==s.interpolation.format&&this.logger.deprecate("init: you are still using the legacy format function, please use the new approach: https://www.i18next.com/translation-function/formatting"),u&&(!this.options.interpolation.format||this.options.interpolation.format===s.interpolation.format)&&(m.formatter=a(u),m.formatter.init&&m.formatter.init(m,this.options),this.options.interpolation.format=m.formatter.format.bind(m.formatter)),m.interpolator=new ya(this.options),m.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},m.backendConnector=new za(a(this.modules.backend),m.resourceStore,m,this.options),m.backendConnector.on("*",(b,...z)=>{this.emit(b,...z)}),this.modules.languageDetector&&(m.languageDetector=a(this.modules.languageDetector),m.languageDetector.init&&m.languageDetector.init(m,this.options.detection,this.options)),this.modules.i18nFormat&&(m.i18nFormat=a(this.modules.i18nFormat),m.i18nFormat.init&&m.i18nFormat.init(this)),this.translator=new yt(this.services,this.options),this.translator.on("*",(b,...z)=>{this.emit(b,...z)}),this.modules.external.forEach(b=>{b.init&&b.init(this)})}if(this.format=this.options.interpolation.format,t||(t=lt),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){const u=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);u.length>0&&u[0]!=="dev"&&(this.options.lng=u[0])}!this.services.languageDetector&&!this.options.lng&&this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(u=>{this[u]=(...g)=>this.store[u](...g)}),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(u=>{this[u]=(...g)=>(this.store[u](...g),this)});const l=Xe(),d=()=>{const u=(g,m)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),l.resolve(m),t(g,m)};if(this.languages&&!this.isInitialized)return u(null,this.t.bind(this));this.changeLanguage(this.options.lng,u)};return this.options.resources||!this.options.initAsync?d():setTimeout(d,0),l}loadResources(r,t=lt){var i,o;let s=t;const a=ue(r)?r:this.language;if(typeof r=="function"&&(s=r),!this.options.resources||this.options.partialBundledLanguages){if((a==null?void 0:a.toLowerCase())==="cimode"&&(!this.options.preload||this.options.preload.length===0))return s();const l=[],d=u=>{if(!u||u==="cimode")return;this.services.languageUtils.toResolveHierarchy(u).forEach(m=>{m!=="cimode"&&l.indexOf(m)<0&&l.push(m)})};a?d(a):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(g=>d(g)),(o=(i=this.options.preload)==null?void 0:i.forEach)==null||o.call(i,u=>d(u)),this.services.backendConnector.load(l,this.options.ns,u=>{!u&&!this.resolvedLanguage&&this.language&&this.setResolvedLanguage(this.language),s(u)})}else s(null)}reloadResources(r,t,s){const a=Xe();return typeof r=="function"&&(s=r,r=void 0),typeof t=="function"&&(s=t,t=void 0),r||(r=this.languages),t||(t=this.options.ns),s||(s=lt),this.services.backendConnector.reload(r,t,i=>{a.resolve(),s(i)}),a}use(r){if(!r)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!r.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return r.type==="backend"&&(this.modules.backend=r),(r.type==="logger"||r.log&&r.warn&&r.error)&&(this.modules.logger=r),r.type==="languageDetector"&&(this.modules.languageDetector=r),r.type==="i18nFormat"&&(this.modules.i18nFormat=r),r.type==="postProcessor"&&Fs.addPostProcessor(r),r.type==="formatter"&&(this.modules.formatter=r),r.type==="3rdParty"&&this.modules.external.push(r),this}setResolvedLanguage(r){if(!(!r||!this.languages)&&!(["cimode","dev"].indexOf(r)>-1)){for(let t=0;t<this.languages.length;t++){const s=this.languages[t];if(!(["cimode","dev"].indexOf(s)>-1)&&this.store.hasLanguageSomeTranslations(s)){this.resolvedLanguage=s;break}}!this.resolvedLanguage&&this.languages.indexOf(r)<0&&this.store.hasLanguageSomeTranslations(r)&&(this.resolvedLanguage=r,this.languages.unshift(r))}}changeLanguage(r,t){this.isLanguageChangingTo=r;const s=Xe();this.emit("languageChanging",r);const a=l=>{this.language=l,this.languages=this.services.languageUtils.toResolveHierarchy(l),this.resolvedLanguage=void 0,this.setResolvedLanguage(l)},i=(l,d)=>{d?this.isLanguageChangingTo===r&&(a(d),this.translator.changeLanguage(d),this.isLanguageChangingTo=void 0,this.emit("languageChanged",d),this.logger.log("languageChanged",d)):this.isLanguageChangingTo=void 0,s.resolve((...u)=>this.t(...u)),t&&t(l,(...u)=>this.t(...u))},o=l=>{var g,m;!r&&!l&&this.services.languageDetector&&(l=[]);const d=ue(l)?l:l&&l[0],u=this.store.hasLanguageSomeTranslations(d)?d:this.services.languageUtils.getBestMatchFromCodes(ue(l)?[l]:l);u&&(this.language||a(u),this.translator.language||this.translator.changeLanguage(u),(m=(g=this.services.languageDetector)==null?void 0:g.cacheUserLanguage)==null||m.call(g,u)),this.loadResources(u,h=>{i(h,u)})};return!r&&this.services.languageDetector&&!this.services.languageDetector.async?o(this.services.languageDetector.detect()):!r&&this.services.languageDetector&&this.services.languageDetector.async?this.services.languageDetector.detect.length===0?this.services.languageDetector.detect().then(o):this.services.languageDetector.detect(o):o(r),s}getFixedT(r,t,s){const a=(i,o,...l)=>{let d;typeof o!="object"?d=this.options.overloadTranslationOptionHandler([i,o].concat(l)):d={...o},d.lng=d.lng||a.lng,d.lngs=d.lngs||a.lngs,d.ns=d.ns||a.ns,d.keyPrefix!==""&&(d.keyPrefix=d.keyPrefix||s||a.keyPrefix);const u=this.options.keySeparator||".";let g;return d.keyPrefix&&Array.isArray(i)?g=i.map(m=>(typeof m=="function"&&(m=Et(m,{...this.options,...o})),`${d.keyPrefix}${u}${m}`)):(typeof i=="function"&&(i=Et(i,{...this.options,...o})),g=d.keyPrefix?`${d.keyPrefix}${u}${i}`:i),this.t(g,d)};return ue(r)?a.lng=r:a.lngs=r,a.ns=t,a.keyPrefix=s,a}t(...r){var t;return(t=this.translator)==null?void 0:t.translate(...r)}exists(...r){var t;return(t=this.translator)==null?void 0:t.exists(...r)}setDefaultNamespace(r){this.options.defaultNS=r}hasLoadedNamespace(r,t={}){if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const s=t.lng||this.resolvedLanguage||this.languages[0],a=this.options?this.options.fallbackLng:!1,i=this.languages[this.languages.length-1];if(s.toLowerCase()==="cimode")return!0;const o=(l,d)=>{const u=this.services.backendConnector.state[`${l}|${d}`];return u===-1||u===0||u===2};if(t.precheck){const l=t.precheck(this,o);if(l!==void 0)return l}return!!(this.hasResourceBundle(s,r)||!this.services.backendConnector.backend||this.options.resources&&!this.options.partialBundledLanguages||o(s,r)&&(!a||o(i,r)))}loadNamespaces(r,t){const s=Xe();return this.options.ns?(ue(r)&&(r=[r]),r.forEach(a=>{this.options.ns.indexOf(a)<0&&this.options.ns.push(a)}),this.loadResources(a=>{s.resolve(),t&&t(a)}),s):(t&&t(),Promise.resolve())}loadLanguages(r,t){const s=Xe();ue(r)&&(r=[r]);const a=this.options.preload||[],i=r.filter(o=>a.indexOf(o)<0&&this.services.languageUtils.isSupportedCode(o));return i.length?(this.options.preload=a.concat(i),this.loadResources(o=>{s.resolve(),t&&t(o)}),s):(t&&t(),Promise.resolve())}dir(r){var a,i;if(r||(r=this.resolvedLanguage||(((a=this.languages)==null?void 0:a.length)>0?this.languages[0]:this.language)),!r)return"rtl";try{const o=new Intl.Locale(r);if(o&&o.getTextInfo){const l=o.getTextInfo();if(l&&l.direction)return l.direction}}catch{}const t=["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"],s=((i=this.services)==null?void 0:i.languageUtils)||new ns(ds());return r.toLowerCase().indexOf("-latn")>1?"ltr":t.indexOf(s.getLanguagePartFromCode(r))>-1||r.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(r={},t){return new nt(r,t)}cloneInstance(r={},t=lt){const s=r.forkResourceStore;s&&delete r.forkResourceStore;const a={...this.options,...r,isClone:!0},i=new nt(a);if((r.debug!==void 0||r.prefix!==void 0)&&(i.logger=i.logger.clone(r)),["store","services","language"].forEach(l=>{i[l]=this[l]}),i.services={...this.services},i.services.utils={hasLoadedNamespace:i.hasLoadedNamespace.bind(i)},s){const l=Object.keys(this.store.data).reduce((d,u)=>(d[u]={...this.store.data[u]},d[u]=Object.keys(d[u]).reduce((g,m)=>(g[m]={...d[u][m]},g),d[u]),d),{});i.store=new ss(l,a),i.services.resourceStore=i.store}return i.translator=new yt(i.services,a),i.translator.on("*",(l,...d)=>{i.emit(l,...d)}),i.init(a,t),i.translator.options=a,i.translator.backendConnector.services.utils={hasLoadedNamespace:i.hasLoadedNamespace.bind(i)},i}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const Pe=nt.createInstance();Pe.createInstance=nt.createInstance;Pe.createInstance;Pe.dir;Pe.init;Pe.loadResources;Pe.reloadResources;Pe.use;Pe.changeLanguage;Pe.getFixedT;Pe.t;Pe.exists;Pe.setDefaultNamespace;Pe.hasLoadedNamespace;Pe.loadNamespaces;Pe.loadLanguages;const{slice:Ca,forEach:_a}=[];function ka(n){return _a.call(Ca.call(arguments,1),r=>{if(r)for(const t in r)n[t]===void 0&&(n[t]=r[t])}),n}function qa(n){return typeof n!="string"?!1:[/<\s*script.*?>/i,/<\s*\/\s*script\s*>/i,/<\s*img.*?on\w+\s*=/i,/<\s*\w+\s*on\w+\s*=.*?>/i,/javascript\s*:/i,/vbscript\s*:/i,/expression\s*\(/i,/eval\s*\(/i,/alert\s*\(/i,/document\.cookie/i,/document\.write\s*\(/i,/window\.location/i,/innerHTML/i].some(t=>t.test(n))}const ms=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/,Pa=function(n,r){const s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{path:"/"},a=encodeURIComponent(r);let i=`${n}=${a}`;if(s.maxAge>0){const o=s.maxAge-0;if(Number.isNaN(o))throw new Error("maxAge should be a Number");i+=`; Max-Age=${Math.floor(o)}`}if(s.domain){if(!ms.test(s.domain))throw new TypeError("option domain is invalid");i+=`; Domain=${s.domain}`}if(s.path){if(!ms.test(s.path))throw new TypeError("option path is invalid");i+=`; Path=${s.path}`}if(s.expires){if(typeof s.expires.toUTCString!="function")throw new TypeError("option expires is invalid");i+=`; Expires=${s.expires.toUTCString()}`}if(s.httpOnly&&(i+="; HttpOnly"),s.secure&&(i+="; Secure"),s.sameSite)switch(typeof s.sameSite=="string"?s.sameSite.toLowerCase():s.sameSite){case!0:i+="; SameSite=Strict";break;case"lax":i+="; SameSite=Lax";break;case"strict":i+="; SameSite=Strict";break;case"none":i+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return s.partitioned&&(i+="; Partitioned"),i},hs={create(n,r,t,s){let a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{path:"/",sameSite:"strict"};t&&(a.expires=new Date,a.expires.setTime(a.expires.getTime()+t*60*1e3)),s&&(a.domain=s),document.cookie=Pa(n,r,a)},read(n){const r=`${n}=`,t=document.cookie.split(";");for(let s=0;s<t.length;s++){let a=t[s];for(;a.charAt(0)===" ";)a=a.substring(1,a.length);if(a.indexOf(r)===0)return a.substring(r.length,a.length)}return null},remove(n,r){this.create(n,"",-1,r)}};var Ta={name:"cookie",lookup(n){let{lookupCookie:r}=n;if(r&&typeof document<"u")return hs.read(r)||void 0},cacheUserLanguage(n,r){let{lookupCookie:t,cookieMinutes:s,cookieDomain:a,cookieOptions:i}=r;t&&typeof document<"u"&&hs.create(t,n,s,a,i)}},Qa={name:"querystring",lookup(n){var s;let{lookupQuerystring:r}=n,t;if(typeof window<"u"){let{search:a}=window.location;!window.location.search&&((s=window.location.hash)==null?void 0:s.indexOf("?"))>-1&&(a=window.location.hash.substring(window.location.hash.indexOf("?")));const o=a.substring(1).split("&");for(let l=0;l<o.length;l++){const d=o[l].indexOf("=");d>0&&o[l].substring(0,d)===r&&(t=o[l].substring(d+1))}}return t}},Aa={name:"hash",lookup(n){var a;let{lookupHash:r,lookupFromHashIndex:t}=n,s;if(typeof window<"u"){const{hash:i}=window.location;if(i&&i.length>2){const o=i.substring(1);if(r){const l=o.split("&");for(let d=0;d<l.length;d++){const u=l[d].indexOf("=");u>0&&l[d].substring(0,u)===r&&(s=l[d].substring(u+1))}}if(s)return s;if(!s&&t>-1){const l=i.match(/\/([a-zA-Z-]*)/g);return Array.isArray(l)?(a=l[typeof t=="number"?t:0])==null?void 0:a.replace("/",""):void 0}}}return s}};let Ve=null;const gs=()=>{if(Ve!==null)return Ve;try{if(Ve=typeof window<"u"&&window.localStorage!==null,!Ve)return!1;const n="i18next.translate.boo";window.localStorage.setItem(n,"foo"),window.localStorage.removeItem(n)}catch{Ve=!1}return Ve};var Ea={name:"localStorage",lookup(n){let{lookupLocalStorage:r}=n;if(r&&gs())return window.localStorage.getItem(r)||void 0},cacheUserLanguage(n,r){let{lookupLocalStorage:t}=r;t&&gs()&&window.localStorage.setItem(t,n)}};let Ke=null;const xs=()=>{if(Ke!==null)return Ke;try{if(Ke=typeof window<"u"&&window.sessionStorage!==null,!Ke)return!1;const n="i18next.translate.boo";window.sessionStorage.setItem(n,"foo"),window.sessionStorage.removeItem(n)}catch{Ke=!1}return Ke};var Fa={name:"sessionStorage",lookup(n){let{lookupSessionStorage:r}=n;if(r&&xs())return window.sessionStorage.getItem(r)||void 0},cacheUserLanguage(n,r){let{lookupSessionStorage:t}=r;t&&xs()&&window.sessionStorage.setItem(t,n)}},Da={name:"navigator",lookup(n){const r=[];if(typeof navigator<"u"){const{languages:t,userLanguage:s,language:a}=navigator;if(t)for(let i=0;i<t.length;i++)r.push(t[i]);s&&r.push(s),a&&r.push(a)}return r.length>0?r:void 0}},Oa={name:"htmlTag",lookup(n){let{htmlTag:r}=n,t;const s=r||(typeof document<"u"?document.documentElement:null);return s&&typeof s.getAttribute=="function"&&(t=s.getAttribute("lang")),t}},La={name:"path",lookup(n){var a;let{lookupFromPathIndex:r}=n;if(typeof window>"u")return;const t=window.location.pathname.match(/\/([a-zA-Z-]*)/g);return Array.isArray(t)?(a=t[typeof r=="number"?r:0])==null?void 0:a.replace("/",""):void 0}},Ia={name:"subdomain",lookup(n){var a,i;let{lookupFromSubdomainIndex:r}=n;const t=typeof r=="number"?r+1:1,s=typeof window<"u"&&((i=(a=window.location)==null?void 0:a.hostname)==null?void 0:i.match(/^(\w{2,5})\.(([a-z0-9-]{1,63}\.[a-z]{2,6})|localhost)/i));if(s)return s[t]}};let Os=!1;try{document.cookie,Os=!0}catch{}const Ls=["querystring","cookie","localStorage","sessionStorage","navigator","htmlTag"];Os||Ls.splice(1,1);const Ma=()=>({order:Ls,lookupQuerystring:"lng",lookupCookie:"i18next",lookupLocalStorage:"i18nextLng",lookupSessionStorage:"i18nextLng",caches:["localStorage"],excludeCacheFor:["cimode"],convertDetectedLanguage:n=>n});class Is{constructor(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.type="languageDetector",this.detectors={},this.init(r,t)}init(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{languageUtils:{}},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.services=r,this.options=ka(t,this.options||{},Ma()),typeof this.options.convertDetectedLanguage=="string"&&this.options.convertDetectedLanguage.indexOf("15897")>-1&&(this.options.convertDetectedLanguage=a=>a.replace("-","_")),this.options.lookupFromUrlIndex&&(this.options.lookupFromPathIndex=this.options.lookupFromUrlIndex),this.i18nOptions=s,this.addDetector(Ta),this.addDetector(Qa),this.addDetector(Ea),this.addDetector(Fa),this.addDetector(Da),this.addDetector(Oa),this.addDetector(La),this.addDetector(Ia),this.addDetector(Aa)}addDetector(r){return this.detectors[r.name]=r,this}detect(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.options.order,t=[];return r.forEach(s=>{if(this.detectors[s]){let a=this.detectors[s].lookup(this.options);a&&typeof a=="string"&&(a=[a]),a&&(t=t.concat(a))}}),t=t.filter(s=>s!=null&&!qa(s)).map(s=>this.options.convertDetectedLanguage(s)),this.services&&this.services.languageUtils&&this.services.languageUtils.getBestMatchFromCodes?t:t.length>0?t[0]:null}cacheUserLanguage(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.options.caches;t&&(this.options.excludeCacheFor&&this.options.excludeCacheFor.indexOf(r)>-1||t.forEach(s=>{this.detectors[s]&&this.detectors[s].cacheUserLanguage(r,this.options)}))}}Is.type="languageDetector";const Ra={cancel:"Cancel",save:"Save",delete:"Delete",edit:"Edit",create:"Create",back:"Back",back_to_reports:"Back to Reports",next:"Next",previous:"Previous",submit:"Submit",close:"Close",confirm:"Confirm",search:"Search",filter:"Filter",sort:"Sort",loading:"Loading...",error:"Error",success:"Success",yes:"Yes",no:"No",all:"All",none:"None",or:"or",and:"and",note:"Note",uploading:"Uploading...",saving:"Saving...",noDataAvailable:"No data available",view:"View"},$a={dashboard:"Dashboard",createQuiz:"Create Quiz",manageQuizzes:"Manage Quizzes",themes:"Themes",categories:"Categories",reports:"Reports",publicQuizzes:"Public Quizzes",settings:"Settings",logout:"Logout",home:"Home"},Ua={login:"Login",signup:"Sign Up",email:"Email",password:"Password",confirmPassword:"Confirm Password",forgotPassword:"Forgot Password?",rememberMe:"Remember Me",alreadyHaveAccount:"Already have an account?",dontHaveAccount:"Don't have an account?",loginAsTeacher:"Login as Teacher",loginAsStudent:"Login as Student",teacherLogin:"Teacher Login",studentLogin:"Student Login",loginToQuizMaster:"Login to QuizMaster",registerForQuizMaster:"Register for QuizMaster",register:"Register",emailPlaceholder:"you@example.com",signingIn:"Signing in...",invalidCredentials:"Invalid credentials",orContinueWith:"Or continue with",signInWithGoogle:"Sign in with Google",fullName:"Full Name",student:"Student",teacher:"Teacher",studentId:"Student ID",teacherCodePlaceholder:"Teacher Code (e.g., ABCD-1234)",teacherCodeHelp:"Enter the invitation code provided by your teacher",almostDone:"Almost done!",completeProfileBelow:"Please complete your profile below.",pendingApprovalMessage:"Your account is pending approval. Complete your profile so your teacher can approve you faster.",enterTeacherCode:"Enter your Teacher Invitation Code",teacherCodeExample:"e.g. ABCD-1234",studentsMustEnterCode:"Students must enter the invitation code provided by their teacher.",selectYourRole:"Select your role",selectRole:"Select role",teachersNoCodeNeeded:"Teachers can continue without an invitation code.",saving:"Saving...",checkingVerification:"Checking verification status...",checkYourEmail:"Check Your Email",verificationLinkSent:"We've sent you a verification link. Click the link in the email to verify your account and complete registration.",verificationEmailResent:"Verification email resent! Check your inbox.",whatToDoNext:"What to do next:",checkEmailInbox:"Check your email inbox",lookForEmail:"Look for an email from QuizMaster",clickVerificationLink:"Click the verification link",returnToLogin:"Return here to login",resendVerificationEmail:"Resend Verification Email",backToLogin:"Back to Login",didntReceiveEmail:`Didn't receive the email? Check your spam folder or click "Resend" above.`},Ha={quiz:"Quiz",quizzes:"Quizzes",question:"Question",questions:"Questions",answer:"Answer",answers:"Answers",title:"Title",description:"Description",timeLimit:"Time Limit",points:"Points",category:"Category",theme:"Theme",difficulty:"Difficulty",startQuiz:"Start Quiz",previewQuiz:"Preview Quiz",editQuiz:"Edit Quiz",deleteQuiz:"Delete Quiz",duplicateQuiz:"Duplicate Quiz",noQuizzes:"No quizzes yet",noQuestions:"No questions yet",addQuestion:"Add Question",questionText:"Question Text",questionType:"Question Type",multipleChoice:"Multiple Choice",trueFalse:"True/False",shortAnswer:"Short Answer",correctAnswer:"Correct Answer",option:"Option",addOption:"Add Option",randomizeQuestions:"Randomize Questions",randomizeAnswers:"Randomize Answers",isPublic:"Public Quiz",isTemplate:"Template",questionCount:"{{count}} question",questionCount_plural:"{{count}} questions",addNewQuestion:"Add New Question",saveQuestion:"Save Question",correct:"Correct",enterQuestion:"Enter question text",mediaOptional:"Media (Optional)",image:"Image",video:"Video",gif:"GIF",loadingQuiz:"Loading quiz...",backToQuizzes:"Back to Quizzes",untitledQuiz:"Untitled Quiz",totalPoints:"Total Points",enterQuizTitle:"Enter quiz title",quizSettings:"Quiz Settings",startBuildingQuiz:"Start building your quiz by adding questions.",addFirstQuestion:"Add First Question",editQuestion:"Edit Question",duplicateQuestion:"Duplicate Question",deleteQuestion:"Delete Question",noAnswerText:"No answer text",questionTextRequired:"Question text is required.",markCorrectAnswer:"Please mark at least one answer as correct.",errorSavingQuestion:"Error saving question",errorDeletingQuestion:"Error deleting question",errorUploadingFile:"Error uploading file",errorDuplicatingQuestion:"Error duplicating question",errorReorderingQuestions:"Error reordering questions",quizTitleRequired:"Quiz title is required.",confirmDeleteQuestion:"Are you sure you want to delete this question?",copySuffix:"(Copy)"},Ba={folder:"Folder",folders:"Folders",newFolder:"New Folder",createFolder:"Create Folder",renameFolder:"Rename Folder",deleteFolder:"Delete Folder",folderName:"Folder Name",moveToFolder:"Move to Folder",unfiledQuizzes:"Unfiled Quizzes",allQuizzes:"All Quizzes",createSubfolder:"Create Subfolder",addSubfolder:"Add Subfolder",noFolders:"No folders yet. You can organize quizzes into folders from the Manage Quizzes page.",noFolder:"No Folder (Top Level)",noFoldersMessage:"No folders yet. Create one from the Manage Quizzes page."},Va={quizManager:"Quiz Manager",quizzesAndFolders:"{{quizCount}} {{quizText}} • {{folderCount}} {{folderText}}",searchQuizzes:"Search quizzes...",sortNewest:"Sort: Newest",sortAZ:"Sort: A-Z",selected:"{{count}} selected",move:"Move",selectAll:"Select All",clear:"Clear",noQuizzesInFolder:"No quizzes in this folder",noQuizzesFound:'No quizzes found matching "{{query}}"',matchingSearch:'matching "{{query}}"',getStarted:"Get started by creating your first quiz!",createYourFirstQuiz:"Create Your First Quiz",deleteFolderConfirm:"Are you sure? Quizzes in this folder will be moved to the root level.",deleteQuizConfirm:"Are you sure you want to delete this quiz?",deleteQuizzesConfirm:"Delete {{count}} selected quizzes?",cannotMoveIntoItself:"Cannot move a folder into itself",cannotMoveIntoSubfolder:"Cannot move a folder into its own subfolder"},Ka={pin:"PIN",waitingForPlayers:"Waiting for Players",playersJoined:"Players Joined",startGame:"Start Game",nextQuestion:"Next Question",showResults:"Show Results",endQuiz:"End Quiz",currentQuestion:"Current Question",leaderboard:"Leaderboard",player:"Player",players:"Players",score:"Score",rank:"Rank",joinGame:"Join Game",enterPin:"Enter PIN",enterName:"Enter Name",nickname:"Nickname",waiting:"Waiting",gameStarting:"Game Starting",correctAnswer:"Correct!",wrongAnswer:"Wrong!",timeUp:"Time's Up!",yourScore:"Your Score",finalResults:"Final Results"},Wa={teacherDashboard:"Teacher Dashboard",teacherControl:"Teacher Control",myQuizzes:"My Quizzes",recentActivity:"Recent Activity",statistics:"Statistics",students:"Students",approveStudent:"Approve Student",rejectStudent:"Reject Student",pendingApproval:"Pending Approval",approved:"Approved",rejected:"Rejected",generatingTeacherCode:"Generating your teacher code...",yourTeacherInvitationCode:"Your Teacher Invitation Code",shareCodeWithStudents:"Share this code with your students so they can register under your account",copied:"Copied!",copyCode:"Copy Code",manageStudents:"Manage Students",manageQuizzesDescription:"Create, edit, and organize quizzes for your classes.",manageStudentsDescription:"View and manage student accounts, approvals, and progress.",reportsDescription:"View quiz performance and student progress reports."},Ja={studentDashboard:"Student Dashboard",studentView:"Student View",myResults:"My Results",joinQuiz:"Join Quiz",quizHistory:"Quiz History",waitingForApproval:"Waiting for Approval",yourAnswers:"Your Answers",joiningQuiz:"Joining quiz...",backToDashboard:"Back to Dashboard",startingIn:"Starting in...",getReadyQuizStarting:"Get ready! The quiz will begin shortly.",youreIn:"You're in!",waitingForTeacherToStart:"Waiting for the teacher to start the quiz...",of:"of",incorrect:"Incorrect",betterLuckNextTime:"Better luck next time!",waitingForResults:"Waiting for results...",theCorrectAnswerWas:"The correct answer was:",waitingForNextQuestion:"Waiting for next question...",quizComplete:"Quiz Complete!",finalScore:"Final Score",greatJob:"Great job!",accountAwaitingApproval:"Your account is awaiting approval. Please wait for your teacher to approve you before joining quizzes.",enterValid6DigitPIN:"Please enter a valid 6-digit PIN",enterPinFromTeacher:"Enter the PIN from your teacher",joining:"Joining...",waitingForTeacherApprovalMessage:"Waiting for teacher approval. You will be able to join quizzes once approved.",awaitingApproval:"Awaiting Approval",teamToolsUnlockMessage:"Team tools unlock once your teacher approves your account. Please check back later or contact your teacher if you need access.",createTeam:"Create Team",formTeamWithClassmates:"Form a team with your classmates",teamName:"Team Name",enterYourTeamName:"Enter your team name",selectTeammates:"Select Teammates",chooseAtLeastOne:"Choose at least one",loadingClassmates:"Loading classmates...",noOtherStudentsInClass:"No other students found in your class",members:"members",includingYou:"including you",creatingTeam:"Creating Team...",teamCreated:"Team Created!",joinTeamQuiz:"Join Team Quiz",joinAsTeam:"Join as Team",pleaseEnterTeamName:"Please enter a team name",pleaseSelectOneTeammate:"Please select at least one teammate",welcome:"Welcome, {{name}}!",awaitingTeacherApproval:"Awaiting Teacher Approval",approvalMessage:"You can browse your dashboard, but quiz participation and team creation are disabled until your teacher approves your account.",enterPinToJoinIndividually:"Enter a PIN to join a quiz individually",disabledUntilApproved:"Disabled until your teacher approves your account",viewMyResults:"View My Results",seeQuizHistoryAndScores:"See your quiz history and scores",comingSoon:"Coming Soon"},Ga={themes:"Themes",themeName:"Theme Name",backgroundColor:"Background Color",primaryColor:"Primary Color",secondaryColor:"Secondary Color",textColor:"Text Color",backgroundImage:"Background Image",uploadImage:"Upload Image",removeImage:"Remove Image",customTheme:"Custom Theme",defaultTheme:"Default Theme",preview:"Preview",custom:"Custom",nature:"Nature",autumn:"Autumn",winter:"Winter",spring:"Spring",summer:"Summer",games:"Games",math:"Math",science:"Science",history:"History",geography:"Geography",space:"Space",ocean:"Ocean",forest:"Forest",desert:"Desert",mountains:"Mountains",sunset:"Sunset",sunrise:"Sunrise",night:"Night",abstract:"Abstract",minimal:"Minimal",colorful:"Colorful",dark:"Dark",light:"Light"},Ya={notAuthenticated:"Not authenticated",noQuestions:"This quiz has no questions. Please add questions before starting.",errorCreatingFolder:"Error creating folder",errorRenamingFolder:"Error renaming folder",errorDeletingFolder:"Error deleting folder",errorMovingQuiz:"Error moving quiz",errorMovingQuizzes:"Error moving quizzes",errorDeletingQuiz:"Error deleting quiz",errorDeletingQuizzes:"Error deleting quizzes",errorDuplicatingQuiz:"Error duplicating quiz",errorStartingQuiz:"Error starting quiz",errorMovingItem:"Error moving item",errorLoadingQuiz:"Error loading quiz",errorSavingQuiz:"Error saving quiz",quizSessionNotFound:"Quiz session not found",quizNotFound:"Quiz not found",quizMayBeDeleted:"The quiz may have been deleted or you may not have permission to view it.",errorSubmittingAnswer:"Error submitting answer",permissionDeniedEnsureApproved:"Permission denied. Please ensure you're logged in and approved by your teacher.",invalidPinQuizNotFound:"Invalid PIN - Quiz not found. Please check the PIN and try again.",quizAlreadyEnded:"This quiz has already ended",databaseMigrationIncomplete:"Database migration incomplete: Please contact your administrator.",failedToJoinQuiz:"Failed to join quiz",errorJoiningQuiz:"Error joining quiz",couldNotFindTeacher:"Could not find your teacher. Please contact support.",failedToLoadClassmates:"Failed to load classmates",failedToCreateTeam:"Failed to create team"},Za={quizDuplicatedSuccess:"Quiz duplicated successfully!",quizCreatedSuccess:"Quiz created successfully!",quizUpdatedSuccess:"Quiz updated successfully!",quizDeletedSuccess:"Quiz deleted successfully!",folderCreatedSuccess:"Folder created successfully!",folderDeletedSuccess:"Folder deleted successfully!",changesSaved:"Changes saved",noChanges:"No changes to save"},Xa={start:"Start",preview:"Preview",duplicate:"Duplicate",archive:"Archive",export:"Export",import:"Import"},en={description:"Discover and import quizzes shared by other teachers",searchPlaceholder:"Search quizzes or creators...",sortByCreator:"Sort: Creator",noPublicQuizzes:"No Public Quizzes Yet",noPublicQuizzesDescription:"No teachers have shared public quizzes yet. You can make your own quizzes public from the Create Quiz or Edit Quiz page.",availableQuizzes:"Available Public Quizzes",import:"Import",importQuiz:"Import Quiz",importQuizConfirm:"This will create a copy of this quiz in your account. Do you want to continue?",importSuccess:"Quiz imported successfully! You can find it in 'My Quizzes'.",importError:"Error importing quiz",yourQuiz:"Your Quiz"},tn={seconds:"seconds",minutes:"minutes",hours:"hours",days:"days"},sn={settings:"Settings",profile:"Profile",password:"Password",name:"Name",email:"Email",avatarUrl:"Avatar URL (Optional)",avatarUrlPlaceholder:"https://example.com/avatar.jpg",avatarUrlHelp:"Enter a URL to an image or upload to an image hosting service",saving:"Saving...",saveChanges:"Save Changes",profileUpdated:"Profile updated successfully!",passwordNote:"You can update your password directly without entering your current password. Supabase will handle the authentication.",newPassword:"New Password",newPasswordPlaceholder:"At least 6 characters",confirmNewPassword:"Confirm New Password",confirmPasswordPlaceholder:"Re-enter new password",updating:"Updating...",changePassword:"Change Password",passwordsDoNotMatch:"New passwords do not match!",passwordTooShort:"Password must be at least 6 characters!",passwordChanged:"Password changed successfully!",accountInformation:"Account Information",role:"Role:",accountStatus:"Account Status:",active:"Active",pendingApproval:"Pending Approval",studentId:"Student ID:"},rn={title:"Quiz Reports & Analytics",loadingReports:"Loading reports...",backToDashboard:"Back to Dashboard",studentPerformanceGlobal:"Student Performance Overview",loadingStudentPerformance:"Loading student performance...",noStudentDataAvailable:"No student data available yet.",quizzesParticipated:"Quizzes Participated",averageAccuracy:"Average Accuracy",quizReports:"Quiz Reports",noQuizzesFound:"No quizzes found. Create a quiz to see reports.",createQuiz:"Create Quiz",tableHeaderQuizTitle:"Quiz Title",tableHeaderDateTime:"Date/Time",tableHeaderMode:"Mode",tableHeaderPlayers:"Players",teamMode:"Team mode",individual:"Individual",session:"session",sessions:"sessions",actionView:"View",actionExport:"Export",actionDelete:"Delete",backToQuizList:"← Back to Quiz List",analytics:"Analytics",totalSessions:"Total Sessions",totalParticipants:"Total Participants",averageScore:"Average Score",overallAccuracy:"Overall Accuracy",questionPerformance:"Question Performance",questionLabel:"Q",answeredTimes:"Answered: {{count}} times",accuracy:"Accuracy: {{percent}}%",difficultyEasy:"Easy",difficultyMedium:"Medium",difficultyHard:"Hard",answerDistribution:"Answer Distribution:",correct:"✓ Correct",option:"Option {{number}}",mostCommonMistake:"Most Common Mistake:",studentsSelected:'{{count}} students selected: "{{text}}"',studentPerformance:"Student Performance",noStudentData:"No student data available yet.",rank:"Rank",student:"Student",email:"Email",score:"Score",questions:"Questions",accuracyHeader:"Accuracy",exportTitle:"Export",exportMessage:'Export functionality for "{{title}}" will be implemented',deleteQuizTitle:"Delete Quiz",deleteQuizMessage:'Are you sure you want to delete "{{title}}"? This action cannot be undone.',errorTitle:"Error",errorDeletingQuiz:"Error deleting quiz: "},an={totalQuizzes:"Total Quizzes",averageScore:"Average Score",averageAccuracy:"Average Accuracy",quizHistory:"Quiz History",quizTitle:"Quiz Title",dateTaken:"Date Taken",score:"Score",accuracy:"Accuracy"},nn={title:"Manage Students",loadingStudents:"Loading students...",backToDashboard:"Back to Dashboard",teacherCodeNote:"Only students who registered with your teacher code are shown here.",totalStudents:"Total Students",approved:"Approved",pendingApproval:"Pending Approval",unverifiedEmail:"Unverified Email",searchPlaceholder:"Search by name or email...",filterAll:"All",filterApproved:"Approved",filterPending:"Pending",filterUnverified:"Unverified",tableHeaderName:"Name",tableHeaderEmail:"Email",tableHeaderStudentId:"Student ID",tableHeaderStatus:"Status",tableHeaderJoined:"Joined",tableHeaderActions:"Actions",noStudentsFound:"No students found",statusApproved:"Approved",statusPending:"Pending",statusUnverified:"Unverified",actionView:"View",actionApprove:"Approve",actionRevoke:"Revoke",actionDelete:"Delete",studentDetails:"Student Details",personalInformation:"Personal Information",name:"Name",email:"Email",studentNumber:"Student Number",notApplicable:"N/A",status:"Status",statusApprovedDetail:"Approved",statusPendingDetail:"Pending Approval",emailVerified:"Email Verified",yes:"Yes",no:"No",joined:"Joined",performanceOverview:"Performance Overview",quizzesTaken:"Quizzes Taken",totalScore:"Total Score",accuracy:"Accuracy",recentQuizActivity:"Recent Quiz Activity",unknownQuiz:"Unknown Quiz",points:"points",approveStudent:"Approve Student",revokeApproval:"Revoke Approval",deleteStudent:"Delete Student",successTitle:"Success",studentApprovedSuccess:"Student approved successfully!",errorTitle:"Error",errorApprovingStudent:"Error approving student. Check console for details.",rejectStudentTitle:"Reject Student",rejectStudentMessage:"Are you sure you want to reject this student?",errorRejectingStudent:"Error rejecting student: ",deleteStudentTitle:"Delete Student",deleteStudentMessage:"Are you sure you want to delete this student? This action cannot be undone.",errorDeletingStudent:"Error deleting student: ",permissionDenied:"Permission denied. Please ensure the student belongs to you and you have teacher permissions.",createStudentButton:"Create Student",createStudentTitle:"Create Student Account",createStudentDescription:"Provision a new student account that is automatically associated with your teacher profile.",createStudentNameLabel:"Student Name",createStudentNamePlaceholder:"Enter student name",createStudentEmailLabel:"Email",createStudentEmailPlaceholder:"student@example.com",createStudentIdLabel:"Student ID (optional)",createStudentIdPlaceholder:"e.g. STU-1001",createStudentPasswordLabel:"Temporary Password",createStudentPasswordPlaceholder:"Enter a temporary password",createStudentConfirmPasswordLabel:"Confirm Temporary Password",createStudentConfirmPasswordPlaceholder:"Re-enter the temporary password",createStudentPasswordHint:"Share this password with the student so they can sign in and change it later.",createStudentSubmit:"Create Student",creatingStudent:"Creating...",createStudentSuccess:"Student account created successfully!",createStudentCredentials:"Share these credentials with your student:",createStudentCredentialsEmail:"Email",createStudentCredentialsPassword:"Temporary Password",createStudentNameRequired:"Student name is required.",createStudentEmailRequired:"Student email is required.",createStudentPasswordLength:"Password must be at least 6 characters long.",createStudentPasswordMismatch:"Passwords do not match.",createStudentEmailExists:"An account with this email already exists.",createStudentNoUser:"Unable to create the account. Please try again.",createStudentGenericError:"Failed to create the student account. Please try again."},on={common:Ra,nav:$a,auth:Ua,quiz:Ha,folder:Ba,manager:Va,session:Ka,teacher:Wa,student:Ja,theme:Ga,errors:Ya,messages:Za,actions:Xa,publicQuizzes:en,time:tn,settings:sn,reports:rn,studentReport:an,manageStudents:nn},ln={cancel:"キャンセル",save:"保存",delete:"削除",edit:"編集",create:"作成",back:"戻る",back_to_reports:"レポートに戻る",next:"次へ",previous:"前へ",submit:"送信",close:"閉じる",confirm:"確認",search:"検索",filter:"フィルター",sort:"並び替え",loading:"読み込み中...",error:"エラー",success:"成功",yes:"はい",no:"いいえ",all:"すべて",none:"なし",or:"または",and:"と",note:"注意",uploading:"アップロード中...",saving:"保存中...",noDataAvailable:"データがありません",view:"表示"},cn={dashboard:"ダッシュボード",createQuiz:"クイズを作成",manageQuizzes:"クイズ管理",themes:"テーマ",categories:"カテゴリー",reports:"レポート",publicQuizzes:"公開クイズ",settings:"設定",logout:"ログアウト",home:"ホーム"},dn={login:"ログイン",signup:"新規登録",email:"メールアドレス",password:"パスワード",confirmPassword:"パスワード確認",forgotPassword:"パスワードをお忘れですか？",rememberMe:"ログイン状態を保持",alreadyHaveAccount:"アカウントをお持ちの方",dontHaveAccount:"アカウントをお持ちでない方",loginAsTeacher:"教師としてログイン",loginAsStudent:"学生としてログイン",teacherLogin:"教師ログイン",studentLogin:"学生ログイン",loginToQuizMaster:"QuizMasterにログイン",registerForQuizMaster:"QuizMasterに登録",register:"登録",emailPlaceholder:"you@example.com",signingIn:"サインイン中...",invalidCredentials:"無効な認証情報",orContinueWith:"または続行する",signInWithGoogle:"Googleでサインイン",fullName:"氏名",student:"学生",teacher:"教師",studentId:"学生ID",teacherCodePlaceholder:"教師コード（例：ABCD-1234）",teacherCodeHelp:"教師から提供された招待コードを入力してください",almostDone:"もう少しです！",completeProfileBelow:"以下のプロフィールを完成させてください。",pendingApprovalMessage:"アカウントは承認待ちです。教師が早く承認できるようにプロフィールを完成させてください。",enterTeacherCode:"教師招待コードを入力",teacherCodeExample:"例：ABCD-1234",studentsMustEnterCode:"学生は教師から提供された招待コードを入力する必要があります。",selectYourRole:"役割を選択",selectRole:"役割を選択",teachersNoCodeNeeded:"教師は招待コードなしで続行できます。",saving:"保存中...",checkingVerification:"確認ステータスを確認中...",checkYourEmail:"メールを確認してください",verificationLinkSent:"確認リンクを送信しました。メール内のリンクをクリックしてアカウントを確認し、登録を完了してください。",verificationEmailResent:"確認メールを再送信しました！受信トレイを確認してください。",whatToDoNext:"次のステップ：",checkEmailInbox:"メールの受信トレイを確認",lookForEmail:"QuizMasterからのメールを探す",clickVerificationLink:"確認リンクをクリック",returnToLogin:"ここに戻ってログイン",resendVerificationEmail:"確認メールを再送信",backToLogin:"ログインに戻る",didntReceiveEmail:"メールが届きませんでしたか？迷惑メールフォルダを確認するか、上の「再送信」をクリックしてください。"},un={quiz:"クイズ",quizzes:"クイズ",question:"問題",questions:"問題",answer:"回答",answers:"回答",title:"タイトル",description:"説明",timeLimit:"制限時間",points:"ポイント",category:"カテゴリー",theme:"テーマ",difficulty:"難易度",startQuiz:"クイズを開始",previewQuiz:"プレビュー",editQuiz:"クイズを編集",deleteQuiz:"クイズを削除",duplicateQuiz:"クイズを複製",noQuizzes:"クイズがまだありません",noQuestions:"問題がまだありません",addQuestion:"問題を追加",questionText:"問題文",questionType:"問題タイプ",multipleChoice:"多肢選択式",trueFalse:"正誤問題",shortAnswer:"短答式",correctAnswer:"正解",option:"選択肢",addOption:"選択肢を追加",randomizeQuestions:"問題をランダム化",randomizeAnswers:"回答をランダム化",isPublic:"公開クイズ",isTemplate:"テンプレート",questionCount:"{{count}}問",questionCount_plural:"{{count}}問",addNewQuestion:"新しい問題を追加",saveQuestion:"問題を保存",correct:"正解",enterQuestion:"問題文を入力",mediaOptional:"メディア（任意）",image:"画像",video:"動画",gif:"GIF",loadingQuiz:"クイズを読み込み中...",backToQuizzes:"クイズに戻る",untitledQuiz:"無題のクイズ",totalPoints:"合計ポイント",enterQuizTitle:"クイズのタイトルを入力",quizSettings:"クイズ設定",startBuildingQuiz:"問題を追加してクイズを作成してください。",addFirstQuestion:"最初の問題を追加",editQuestion:"問題を編集",duplicateQuestion:"問題を複製",deleteQuestion:"問題を削除",noAnswerText:"回答テキストなし",questionTextRequired:"問題文は必須です。",markCorrectAnswer:"少なくとも1つの回答を正解としてマークしてください。",errorSavingQuestion:"問題の保存中にエラーが発生しました",errorDeletingQuestion:"問題の削除中にエラーが発生しました",errorUploadingFile:"ファイルのアップロード中にエラーが発生しました",errorDuplicatingQuestion:"問題の複製中にエラーが発生しました",errorReorderingQuestions:"問題の並び替え中にエラーが発生しました",quizTitleRequired:"クイズのタイトルは必須です。",confirmDeleteQuestion:"この問題を削除してもよろしいですか？",copySuffix:"（コピー）"},mn={folder:"フォルダー",folders:"フォルダー",newFolder:"新規フォルダー",createFolder:"フォルダーを作成",renameFolder:"フォルダー名を変更",deleteFolder:"フォルダーを削除",folderName:"フォルダー名",moveToFolder:"フォルダーに移動",unfiledQuizzes:"未整理クイズ",allQuizzes:"すべてのクイズ",createSubfolder:"サブフォルダーを作成",addSubfolder:"サブフォルダーを追加",noFolders:"フォルダーがまだありません。クイズ管理ページからクイズをフォルダーに整理できます。",noFolder:"フォルダーなし（トップレベル）",noFoldersMessage:"フォルダーがまだありません。クイズ管理ページから作成できます。"},hn={quizManager:"クイズ管理",quizzesAndFolders:"{{quizCount}}個の{{quizText}} • {{folderCount}}個の{{folderText}}",searchQuizzes:"クイズを検索...",sortNewest:"並び替え: 新しい順",sortAZ:"並び替え: A-Z順",selected:"{{count}}個選択中",move:"移動",selectAll:"すべて選択",clear:"クリア",noQuizzesInFolder:"このフォルダーにクイズがありません",noQuizzesFound:"「{{query}}」に一致するクイズが見つかりません",matchingSearch:"「{{query}}」に一致",getStarted:"最初のクイズを作成して始めましょう！",createYourFirstQuiz:"最初のクイズを作成",deleteFolderConfirm:"本当によろしいですか？このフォルダー内のクイズはルートレベルに移動されます。",deleteQuizConfirm:"このクイズを削除してもよろしいですか？",deleteQuizzesConfirm:"選択した{{count}}個のクイズを削除しますか？",cannotMoveIntoItself:"フォルダーを自分自身に移動することはできません",cannotMoveIntoSubfolder:"フォルダーを自分のサブフォルダーに移動することはできません"},gn={pin:"PIN",waitingForPlayers:"プレイヤー待機中",playersJoined:"参加プレイヤー",startGame:"ゲーム開始",nextQuestion:"次の問題",showResults:"結果を表示",endQuiz:"クイズ終了",currentQuestion:"現在の問題",leaderboard:"リーダーボード",player:"プレイヤー",players:"プレイヤー",score:"スコア",rank:"順位",joinGame:"ゲームに参加",enterPin:"PINを入力",enterName:"名前を入力",nickname:"ニックネーム",waiting:"待機中",gameStarting:"ゲーム開始",correctAnswer:"正解！",wrongAnswer:"不正解！",timeUp:"時間切れ！",yourScore:"あなたのスコア",finalResults:"最終結果"},xn={teacherDashboard:"教師ダッシュボード",teacherControl:"教師コントロール",myQuizzes:"マイクイズ",recentActivity:"最近のアクティビティ",statistics:"統計",students:"学生",approveStudent:"学生を承認",rejectStudent:"学生を拒否",pendingApproval:"承認待ち",approved:"承認済み",rejected:"拒否済み",generatingTeacherCode:"教師コードを生成中...",yourTeacherInvitationCode:"教師招待コード",shareCodeWithStudents:"このコードを学生と共有して、あなたのアカウントの下に登録できるようにします",copied:"コピーしました！",copyCode:"コードをコピー",manageStudents:"学生管理",manageQuizzesDescription:"クラス用のクイズを作成、編集、整理します。",manageStudentsDescription:"学生アカウント、承認、進捗状況を表示および管理します。",reportsDescription:"クイズのパフォーマンスと学生の進捗レポートを表示します。"},pn={studentDashboard:"学生ダッシュボード",studentView:"学生ビュー",myResults:"マイ結果",joinQuiz:"クイズに参加",quizHistory:"クイズ履歴",waitingForApproval:"承認待ち",yourAnswers:"あなたの回答",joiningQuiz:"クイズに参加中...",backToDashboard:"ダッシュボードに戻る",startingIn:"開始まで...",getReadyQuizStarting:"準備してください！クイズがまもなく始まります。",youreIn:"参加しました！",waitingForTeacherToStart:"教師がクイズを開始するのを待っています...",of:"の",incorrect:"不正解",betterLuckNextTime:"次回頑張りましょう！",waitingForResults:"結果待ち...",theCorrectAnswerWas:"正解は：",waitingForNextQuestion:"次の問題待ち...",quizComplete:"クイズ完了！",finalScore:"最終スコア",greatJob:"素晴らしい！",accountAwaitingApproval:"アカウントは承認待ちです。クイズに参加する前に教師の承認をお待ちください。",enterValid6DigitPIN:"有効な6桁のPINを入力してください",enterPinFromTeacher:"教師から提供されたPINを入力してください",joining:"参加中...",waitingForTeacherApprovalMessage:"教師の承認待ちです。承認されるとクイズに参加できるようになります。",awaitingApproval:"承認待ち",teamToolsUnlockMessage:"チームツールは教師がアカウントを承認すると利用可能になります。後でもう一度確認するか、アクセスが必要な場合は教師に連絡してください。",createTeam:"チームを作成",formTeamWithClassmates:"クラスメートとチームを組む",teamName:"チーム名",enterYourTeamName:"チーム名を入力してください",selectTeammates:"チームメイトを選択",chooseAtLeastOne:"少なくとも1人選択してください",loadingClassmates:"クラスメート読み込み中...",noOtherStudentsInClass:"クラスに他の学生が見つかりません",members:"メンバー",includingYou:"あなたを含む",creatingTeam:"チーム作成中...",teamCreated:"チーム作成完了！",joinTeamQuiz:"チームクイズに参加",joinAsTeam:"チームとして参加",pleaseEnterTeamName:"チーム名を入力してください",pleaseSelectOneTeammate:"少なくとも1人のチームメイトを選択してください",welcome:"ようこそ、{{name}}さん！",awaitingTeacherApproval:"教師の承認待ち",approvalMessage:"ダッシュボードは閲覧できますが、教師がアカウントを承認するまでクイズへの参加とチームの作成は無効になっています。",enterPinToJoinIndividually:"PINを入力して個別にクイズに参加します",disabledUntilApproved:"教師がアカウントを承認するまで無効です",viewMyResults:"マイ結果を表示",seeQuizHistoryAndScores:"クイズ履歴とスコアを確認します",comingSoon:"近日公開"},fn={themes:"テーマ",themeName:"テーマ名",backgroundColor:"背景色",primaryColor:"プライマリカラー",secondaryColor:"セカンダリカラー",textColor:"テキスト色",backgroundImage:"背景画像",uploadImage:"画像をアップロード",removeImage:"画像を削除",customTheme:"カスタムテーマ",defaultTheme:"デフォルトテーマ",preview:"プレビュー",custom:"カスタム",nature:"自然",autumn:"秋",winter:"冬",spring:"春",summer:"夏",games:"ゲーム",math:"数学",science:"科学",history:"歴史",geography:"地理",space:"宇宙",ocean:"海",forest:"森",desert:"砂漠",mountains:"山",sunset:"夕日",sunrise:"日の出",night:"夜",abstract:"抽象",minimal:"ミニマル",colorful:"カラフル",dark:"ダーク",light:"ライト"},bn={notAuthenticated:"認証されていません",noQuestions:"このクイズには問題がありません。開始する前に問題を追加してください。",errorCreatingFolder:"フォルダーの作成中にエラーが発生しました",errorRenamingFolder:"フォルダー名の変更中にエラーが発生しました",errorDeletingFolder:"フォルダーの削除中にエラーが発生しました",errorMovingQuiz:"クイズの移動中にエラーが発生しました",errorMovingQuizzes:"クイズの移動中にエラーが発生しました",errorDeletingQuiz:"クイズの削除中にエラーが発生しました",errorDeletingQuizzes:"クイズの削除中にエラーが発生しました",errorDuplicatingQuiz:"クイズの複製中にエラーが発生しました",errorStartingQuiz:"クイズの開始中にエラーが発生しました",errorMovingItem:"アイテムの移動中にエラーが発生しました",errorLoadingQuiz:"クイズの読み込み中にエラーが発生しました",errorSavingQuiz:"クイズの保存中にエラーが発生しました",quizSessionNotFound:"クイズセッションが見つかりません",quizNotFound:"クイズが見つかりません",quizMayBeDeleted:"クイズが削除されたか、表示する権限がない可能性があります。",errorSubmittingAnswer:"回答の送信中にエラーが発生しました",permissionDeniedEnsureApproved:"アクセスが拒否されました。ログインしていて、教師に承認されていることを確認してください。",invalidPinQuizNotFound:"無効なPIN - クイズが見つかりません。PINを確認してもう一度お試しください。",quizAlreadyEnded:"このクイズは既に終了しています",databaseMigrationIncomplete:"データベース移行が不完全です：管理者に連絡してください。",failedToJoinQuiz:"クイズへの参加に失敗しました",errorJoiningQuiz:"クイズ参加中にエラーが発生しました",couldNotFindTeacher:"教師が見つかりませんでした。サポートにお問い合わせください。",failedToLoadClassmates:"クラスメートの読み込みに失敗しました",failedToCreateTeam:"チームの作成に失敗しました"},yn={quizDuplicatedSuccess:"クイズが正常に複製されました！",quizCreatedSuccess:"クイズが正常に作成されました！",quizUpdatedSuccess:"クイズが正常に更新されました！",quizDeletedSuccess:"クイズが正常に削除されました！",folderCreatedSuccess:"フォルダーが正常に作成されました！",folderDeletedSuccess:"フォルダーが正常に削除されました！",changesSaved:"変更が保存されました",noChanges:"保存する変更はありません"},vn={start:"開始",preview:"プレビュー",duplicate:"複製",archive:"アーカイブ",export:"エクスポート",import:"インポート"},jn={description:"他の教師が共有したクイズを発見してインポート",searchPlaceholder:"クイズまたは作成者を検索...",sortByCreator:"並び替え: 作成者",noPublicQuizzes:"公開クイズがまだありません",noPublicQuizzesDescription:"まだ誰も公開クイズを共有していません。クイズ作成ページまたは編集ページから、自分のクイズを公開できます。",availableQuizzes:"利用可能な公開クイズ",import:"インポート",importQuiz:"クイズをインポート",importQuizConfirm:"このクイズのコピーをあなたのアカウントに作成します。続行しますか？",importSuccess:"クイズが正常にインポートされました！「マイクイズ」で確認できます。",importError:"クイズのインポート中にエラーが発生しました",yourQuiz:"あなたのクイズ"},wn={seconds:"秒",minutes:"分",hours:"時間",days:"日"},Nn={settings:"設定",profile:"プロフィール",password:"パスワード",name:"名前",email:"メールアドレス",avatarUrl:"アバターURL（オプション）",avatarUrlPlaceholder:"https://example.com/avatar.jpg",avatarUrlHelp:"画像のURLを入力するか、画像ホスティングサービスにアップロードしてください",saving:"保存中...",saveChanges:"変更を保存",profileUpdated:"プロフィールが正常に更新されました！",passwordNote:"現在のパスワードを入力せずに直接パスワードを更新できます。Supabaseが認証を処理します。",newPassword:"新しいパスワード",newPasswordPlaceholder:"最低6文字",confirmNewPassword:"新しいパスワードを確認",confirmPasswordPlaceholder:"新しいパスワードを再入力",updating:"更新中...",changePassword:"パスワードを変更",passwordsDoNotMatch:"新しいパスワードが一致しません！",passwordTooShort:"パスワードは最低6文字必要です！",passwordChanged:"パスワードが正常に変更されました！",accountInformation:"アカウント情報",role:"役割：",accountStatus:"アカウントステータス：",active:"アクティブ",pendingApproval:"承認待ち",studentId:"学生ID："},zn={title:"クイズレポート＆分析",loadingReports:"レポートを読み込み中...",backToDashboard:"ダッシュボードに戻る",studentPerformanceGlobal:"学生パフォーマンス概要",loadingStudentPerformance:"学生パフォーマンスを読み込み中...",noStudentDataAvailable:"学生データがまだありません。",quizzesParticipated:"参加クイズ数",averageAccuracy:"平均正解率",quizReports:"クイズレポート",noQuizzesFound:"クイズが見つかりません。レポートを表示するにはクイズを作成してください。",createQuiz:"クイズを作成",tableHeaderQuizTitle:"クイズタイトル",tableHeaderDateTime:"日時",tableHeaderMode:"モード",tableHeaderPlayers:"プレイヤー",teamMode:"チームモード",individual:"個人",session:"セッション",sessions:"セッション",actionView:"表示",actionExport:"エクスポート",actionDelete:"削除",backToQuizList:"← クイズリストに戻る",analytics:"分析",totalSessions:"総セッション数",totalParticipants:"総参加者数",averageScore:"平均スコア",overallAccuracy:"全体的な正解率",questionPerformance:"問題パフォーマンス",questionLabel:"Q",answeredTimes:"回答数：{{count}}回",accuracy:"正解率：{{percent}}%",difficultyEasy:"簡単",difficultyMedium:"中程度",difficultyHard:"難しい",answerDistribution:"回答の分布：",correct:"✓ 正解",option:"選択肢{{number}}",mostCommonMistake:"最もよくある間違い：",studentsSelected:"{{count}}人の学生が選択：「{{text}}」",studentPerformance:"学生パフォーマンス",noStudentData:"学生データがまだありません。",rank:"順位",student:"学生",email:"メールアドレス",score:"スコア",questions:"問題数",accuracyHeader:"正解率",exportTitle:"エクスポート",exportMessage:"「{{title}}」のエクスポート機能は実装予定です",deleteQuizTitle:"クイズを削除",deleteQuizMessage:"「{{title}}」を削除してもよろしいですか？この操作は元に戻せません。",errorTitle:"エラー",errorDeletingQuiz:"クイズの削除中にエラーが発生しました："},Sn={totalQuizzes:"総クイズ数",averageScore:"平均スコア",averageAccuracy:"平均正解率",quizHistory:"クイズ履歴",quizTitle:"クイズタイトル",dateTaken:"受験日",score:"スコア",accuracy:"正解率"},Cn={title:"学生管理",loadingStudents:"学生情報を読み込み中...",backToDashboard:"ダッシュボードに戻る",teacherCodeNote:"教師コードを使用して登録した学生のみがここに表示されます。",totalStudents:"総学生数",approved:"承認済み",pendingApproval:"承認待ち",unverifiedEmail:"未確認メール",searchPlaceholder:"名前またはメールアドレスで検索...",filterAll:"すべて",filterApproved:"承認済み",filterPending:"承認待ち",filterUnverified:"未確認",tableHeaderName:"名前",tableHeaderEmail:"メールアドレス",tableHeaderStudentId:"学生ID",tableHeaderStatus:"ステータス",tableHeaderJoined:"登録日",tableHeaderActions:"操作",noStudentsFound:"学生が見つかりません",statusApproved:"承認済み",statusPending:"承認待ち",statusUnverified:"未確認",actionView:"表示",actionApprove:"承認",actionRevoke:"取り消し",actionDelete:"削除",studentDetails:"学生詳細",personalInformation:"個人情報",name:"名前",email:"メールアドレス",studentNumber:"学生番号",notApplicable:"なし",status:"ステータス",statusApprovedDetail:"承認済み",statusPendingDetail:"承認待ち",emailVerified:"メール確認済み",yes:"はい",no:"いいえ",joined:"登録日",performanceOverview:"パフォーマンス概要",quizzesTaken:"受験クイズ数",totalScore:"合計スコア",accuracy:"正解率",recentQuizActivity:"最近のクイズ活動",unknownQuiz:"不明なクイズ",points:"ポイント",approveStudent:"学生を承認",revokeApproval:"承認を取り消し",deleteStudent:"学生を削除",successTitle:"成功",studentApprovedSuccess:"学生が正常に承認されました！",errorTitle:"エラー",errorApprovingStudent:"学生の承認中にエラーが発生しました。コンソールで詳細を確認してください。",rejectStudentTitle:"学生を拒否",rejectStudentMessage:"この学生を拒否してもよろしいですか？",errorRejectingStudent:"学生の拒否中にエラーが発生しました：",deleteStudentTitle:"学生を削除",deleteStudentMessage:"この学生を削除してもよろしいですか？この操作は元に戻せません。",errorDeletingStudent:"学生の削除中にエラーが発生しました：",permissionDenied:"アクセスが拒否されました。学生があなたに属していること、および教師権限を持っていることを確認してください。",createStudentButton:"学生を作成",createStudentTitle:"学生アカウントを作成",createStudentDescription:"あなたの教師アカウントに紐づく学生アカウントを新規作成します。",createStudentNameLabel:"学生名",createStudentNamePlaceholder:"学生名を入力",createStudentEmailLabel:"メールアドレス",createStudentEmailPlaceholder:"student@example.com",createStudentIdLabel:"学生ID（任意）",createStudentIdPlaceholder:"例: STU-1001",createStudentPasswordLabel:"仮パスワード",createStudentPasswordPlaceholder:"仮パスワードを入力",createStudentConfirmPasswordLabel:"仮パスワード（確認）",createStudentConfirmPasswordPlaceholder:"仮パスワードを再入力",createStudentPasswordHint:"このパスワードを学生に共有し、ログイン後に変更してもらってください。",createStudentSubmit:"学生を作成",creatingStudent:"作成中...",createStudentSuccess:"学生アカウントを作成しました！",createStudentCredentials:"以下の情報を学生に共有してください：",createStudentCredentialsEmail:"メールアドレス",createStudentCredentialsPassword:"仮パスワード",createStudentNameRequired:"学生名は必須です。",createStudentEmailRequired:"学生のメールアドレスは必須です。",createStudentPasswordLength:"パスワードは6文字以上である必要があります。",createStudentPasswordMismatch:"パスワードが一致しません。",createStudentEmailExists:"このメールアドレスのアカウントは既に存在します。",createStudentNoUser:"アカウントを作成できませんでした。もう一度お試しください。",createStudentGenericError:"学生アカウントの作成に失敗しました。もう一度お試しください。"},_n={common:ln,nav:cn,auth:dn,quiz:un,folder:mn,manager:hn,session:gn,teacher:xn,student:pn,theme:fn,errors:bn,messages:yn,actions:vn,publicQuizzes:jn,time:wn,settings:Nn,reports:zn,studentReport:Sn,manageStudents:Cn};Pe.use(Is).use(cr).init({resources:{en:{translation:on},ja:{translation:_n}},fallbackLng:"en",debug:!1,interpolation:{escapeValue:!1},detection:{order:["localStorage","navigator"],caches:["localStorage"]}});_t.createRoot(document.getElementById("root")).render(e.jsx($s.StrictMode,{children:e.jsx(na,{})}));
